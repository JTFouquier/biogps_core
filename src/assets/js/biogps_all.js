Ext.namespace("biogps.utils");if(!Ext.isDefined(Array.prototype.each)){Array.prototype.each=function(d){var c=this.length,b,a=this.length;for(c=0;c<a;c++){if((b=this[c])){d(b)}}}}if(!Ext.isDefined(Array.prototype.walk)){Array.prototype.walk=function(d){var b=[],c=this.length;while(c--){b.push(d(this[c]))}return b.reverse()}}if(!Ext.isDefined(Array.prototype.equals)){Array.prototype.equals=function(b){if(this.length!=b.length){return false}for(var c=0;c<this.length;++c){if(this[c]!==b[c]){return false}}return true}}if(!Ext.isDefined(String.prototype.startsWith)){String.prototype.startsWith=function(b,a){if(a==false){return;(b==this.substring(0,b.length))}else{return(b.toLowerCase()==this.substring(0,b.length).toLowerCase())}}}if(!Ext.isDefined(String.prototype.endsWith)){String.prototype.endsWith=function(b,a){if(a==false){return(b==this.substring(this.length-b.length))}else{return;(b.toLowerCase()==this.substring(this.length-b.length).toLowerCase())}}}biogps.isEmptyObject=function(b){for(var a in b){return false}return true};biogps.Messenger=function(a){Ext.apply(this,a);biogps.Messenger.superclass.constructor.call(this);this.addEvents({genelistrendered:true});this.addEvents({genereportrendered:true})};Ext.extend(biogps.Messenger,Ext.util.Observable,{});biogps.Messenger=new biogps.Messenger();biogps.evtEmptyFn=function(){console.log(arguments)};Ext.BLANK_IMAGE_URL=(function(){if(Ext.isIE8||Ext.isGecko||Ext.isOpera||Ext.isChrome||Ext.isSafari){return"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="}else{return"/assets/img/s.gif"}})();Ext.SSL_SECURE_URL="https://biogps.gnf.org/assets/img/s.gif";biogps.error=function(a){Ext.MessageBox.show({title:"Error",msg:a,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})};biogps.warning=function(a){Ext.MessageBox.show({title:"Warning",msg:a,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING})};biogps.ajaxfailure=function(e,a,b){if(biogps.bequietonfailure){return}biogps.failedajax=[e,a,b];var d=e;if(e&&e.status){d=e}else{if(a.status){d=a}else{if(b.status){d=b}else{d=e}}}var c=a.url;if(!c&&a.argument){c=a.argument.url}var f='Failed to access "'+c+'" with:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error code: '+(d.status?d.status.toString():"None")+"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error message: "+(d.statusText?d.statusText.toString():"None")+"<br>";Ext.MessageBox.alert("Ajax Error",f)};biogps.ajaxfailure2=function(c,a,b){biogps.ajaxfailure(b,a)};biogps.formfailure=function(c,d,b,a){Ext.MessageBox.hide();if(c.result){if(c.result.error){if(typeof(c.result.error)=="string"){d+="<br><br>&nbsp;&nbsp;&nbsp;&nbsp;"+c.result.error}else{if(c.result.error.error_code){d+="<br><br>&nbsp;&nbsp;&nbsp;&nbsp;Error Code: "+c.result.error.error_code;if(c.result.error.error_msg){d+="<br><br>&nbsp;&nbsp;&nbsp;&nbsp;Error Msg: "+c.result.error.error_msg}if(c.result.error.errorreport_id){d+='<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="/utils/errorreport/'+c.result.error.errorreport_id+'" target="_blank">View detailed error report.</a>'}}else{d+="<br><br>&nbsp;&nbsp;&nbsp;&nbsp;"+c.result.error.toString()}}}else{if(c.result.data){if(c.result.data.status){d+="<br><br>&nbsp;&nbsp;&nbsp;&nbsp;Error Code: "+c.result.data.status}}}}else{if(c.response.responseText){Ext.getBody().dom.innerHTML=c.response.responseText;return}else{if(c.response.statusText){d+="<br><br>&nbsp;&nbsp;&nbsp;&nbsp;Reason: "+c.response.statusText}else{d+="<br><br>&nbsp;&nbsp;&nbsp;&nbsp;Reason: timeout."}}}Ext.MessageBox.show({title:"Error",msg:d,buttons:Ext.Msg.OK,fn:b,scope:a,icon:Ext.MessageBox.ERROR})};biogps.callRemoteService=function(d){var b=d.url;var e=d.params||{};var g=d.fn||Ext.emptyFn;var k=d.failure||Ext.emptyFn;var m=d.scope;var a=d.method||"GET";var c=(d.disableCaching==null)?true:d.disableCaching;var j=(d.ignorefailure==null)?false:d.ignorefailure;var i=d.timeout||30000;var h=d.type||"json";if(h=="json"){var f=Ext.data.JsonStore}else{var f=Ext.data.Store}var l=new f({proxy:new Ext.data.HttpProxy({method:a,disableCaching:c,timeout:i,url:b}),baseParams:e,fields:[],autoLoad:true});l.on("load",g,m);if(!j){l.on("exception",function(t,r,s,p,n,q){biogps.ajaxException(t,r,s,p,n,q);k(l)},m)}};biogps.ajaxException=function(a,i,e,j,f,d){biogps.ding=arguments;if(i=="remote"){biogps.error(f.error||"None")}else{var b=j.url;var g=f.status||"None";var h=f.responseText||f.statusText||"None";var c='Failed to access "'+b+'" with:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error code: '+g+"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error message: "+h+"<br>";Ext.MessageBox.alert("Ajax Error",c)}};biogps.setTitle=function(b){var d="";var c="";switch(b){default:break;case"about":d="About";break;case"terms":d="Terms of Use";break;case"help":d="Help";break;case"faq":d="FAQ";break;case"downloads":d="Downloads";break;case"search":break;case"searchresult":d="Search Result";if(biogps.resultpage&&biogps.resultpage.rendered){d="Search Result ({0})";d=String.format(d,biogps.resultpage.totalCount)}else{biogps.Messenger.on("genelistrendered",function(){biogps.setTitle("result");biogps.clearListeners(biogps.Messenger,"genelistrendered")})}break;case"genereport":d="Gene Report";if(biogps.GeneReportMgr&&biogps.GeneReportMgr.rendered){c=biogps.GeneReportMgr.makeTitle()}else{biogps.Messenger.on("genereportrendered",function(){biogps.setTitle("genereport");biogps.clearListeners(biogps.Messenger,"genereportrendered")})}break;case"pluginlibrary":d="Plugin Library";break;case"mystuff":d="My Stuff";break}var e=100;var a="BioGPS";if(d.length==""){d="BioGPS - your Gene Portal System"}else{if(c==""){d+=" | "+a}else{if(c.length>e){c=c.substring(0,97)+"..."}d=c+" | "+d+" | "+a}}document.title=d};function createBox(a,b){return['<div class="msg">','<div class="x-box-mc"><h3>',a,"</h3>",b,"</div>","</div>"].join("")}var msgCt;biogps.showmsg=function(d,c){if(!msgCt){msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}msgCt.alignTo(document,"t-t");var b=String.format.apply(String,Array.prototype.slice.call(arguments,1));var a=Ext.DomHelper.append(msgCt,{html:createBox(d,b)},true);a.slideIn("t").pause(1).ghost("t",{remove:true})};biogps.require_user_logged_in=function(){if(biogps.usrMgr.is_anonymoususer){Ext.MessageBox.alert("Alert","This function is only available for registered users.");return false}else{return true}};biogps.whydisabled=function(b,c){if(b.el){var a=b.el.mask("Why disabled?","whydisabled_msg");new Ext.ToolTip({target:b.el._maskMsg.dom.firstChild,html:c,title:"Why disabled?",autoHide:false,closable:true,draggable:true})}};biogps.clearListeners=function(c,a){if(c.events){var b=c.events[a.toLowerCase()];if(typeof b=="object"){b.clearListeners()}}};biogps.setCookies=function(){var a=new Ext.state.CookieProvider();a.set("test","cookietest");if(!a.readCookies().test){alert("Warning: many features will not work as expected unless you enable cookies. Please enable cookies on your browser and refresh the page again.")}a.clear("test");Ext.state.Manager.setProvider(a)};biogps.initHistory=function(){Ext.History.init();Ext.History.on("change",biogps.dispatcher_by_hash)};biogps.init=function(){biogps.setCookies();coreDispatcher.bindHotKey();biogps.initHistory();Ext.QuickTips.init();if(coreDispatcher.delayedAction){_gaq.push(["_trackEvent","coreDispatcher.delayedExecute","delayedCallback"]);coreDispatcher.delayedAction()}};biogps.mainUI_init=function(){biogps.initInfobar();biogps.usrMgr.init()};biogps.mainUI_postinit=function(){biogps.initLogo()};biogps.getlastsearch=function(){var a=new Ext.data.JsonStore({url:"/service/getlastsearch/",fields:[{name:"symbol"},{name:"id"}],autoLoad:true});a.on("load",function(){var b=a.reader.jsonData;if(isArray(b)&&b.length>0){biogps.genelist_panel.loadGeneList({geneList:a.reader.jsonData})}},this)};_reuse_exist_tab=function(a){var b=Ext.get("welcome");if(b&&b.isVisible()){b.hide()}if(biogps.centerTab.getActiveTab().id==a){return true}var c=biogps.centerTab.getItem(a);if(c&&!c.disabled){biogps.centerTab.suspendEvents();biogps.centerTab.setActiveTab(a);biogps.centerTab.resumeEvents();return true}return false};biogps.dispatcher_by_hash=function(f){var e=Ext.urlDecode(f);if(e){var d=e["goto"];if(d){d=d.toLowerCase()}switch(d){default:var b=Ext.get("welcome");if(b&&!b.isVisible()){b.show()}biogps.setTitle(d);break;case"about":if(!_reuse_exist_tab("infotab_about")){biogps.showInfoPage("about")}biogps.setTitle(d);break;case"terms":if(!_reuse_exist_tab("infotab_terms")){biogps.showInfoPage("terms")}biogps.setTitle(d);break;case"help":if(!_reuse_exist_tab("infotab_help")){biogps.showInfoPage("help")}biogps.setTitle(d);break;case"faq":if(!_reuse_exist_tab("infotab_faq")){biogps.showInfoPage("faq")}biogps.setTitle(d);break;case"downloads":if(!_reuse_exist_tab("infotab_downloads")){biogps.showInfoPage("downloads")}biogps.setTitle(d);break;case"search":var a;var g;if(e.qtype=="keyword"){a="keyword"}else{if(e.qtype=="interval"){a="interval";var i=biogps.GENOMEASSEMBLY[e.genome]||"mouse"}else{a="symbolanno"}}g=e.query;if(g){if(biogps.searchform){if(a=="interval"){biogps.searchform.items.get(0).setActiveTab("searchbyinterval");biogps.searchform.form.setValues({genomeinternal_string:g,genomeassembly:i})}else{g=g.replace(/[\+,|]+/g,"\n");biogps.searchform.items.get(0).setActiveTab("searchbyanno");biogps.searchform.form.setValues({query:g,qtype:a})}biogps.doSearch()}}else{_reuse_exist_tab("search_panel")}biogps.setTitle(d);break;case"searchresult":_reuse_exist_tab("result_panel");biogps.setTitle(d);break;case"genereport":var c=e.id;var h=[];if(c){if(isString(c)){h=c.replace(/[\+|]+/g,",").split(",")}else{if(isArray(c)){h=c}}}if(h.length>0){if(!_reuse_exist_tab("report_panel")||(h.join(",")!=biogps.GeneReportMgr.getGeneidList().join(","))){biogps.renderGeneReport2(h,true)}}else{_reuse_exist_tab("report_panel")}biogps.setTitle(d,h);break;case"pluginlibrary":if(!_reuse_exist_tab("pluginbrowse_panel")){biogps.renderPluginBrowsePanel(false,e);biogps.setTitle(d)}else{biogps.currentLibrary.dispatcher_by_params(e)}break;case"mystuff":if(!_reuse_exist_tab("mystuff_panel")){biogps.renderMyStuffPanel()}biogps.setTitle(d);break}}else{Ext.History.add("goto=welcome")}};biogps.dispatcher=function(){var a=window.location.hash;if(a.length>0&&a.substring(0,1)=="#"){a=a.substring(1);biogps.dispatcher_by_hash(a)}else{Ext.History.add("goto=search")}};biogps.initMsgTicker=function(){var a=Ext.get("center_panel");if(a){var b=Ext.get("msg-ct");b.anchorTo(a.first(),"tr",[-300,0],false,false);var d=0;var g=Ext.get("msg"),c=Ext.get("msg-inner"),f=null;c.addClassOnOver("msg-over");g.on("click",function(){if(f.action){f.action()}else{if(f.url){window.open(f.url)}}});function h(){c.update(f.text);g.slideIn("b")}function e(i){if(isArray(biogps.ticker_msgs)&&biogps.ticker_msgs.length>0){if(!c.hasClass("msg-over")){f=biogps.ticker_msgs[i];if(g.isVisible()){g.slideOut("b",{callback:h})}else{h()}}}}setInterval(function(){d=biogps.ticker_msgs[d+1]?d+1:0;e(d)},5000);e(0)}};biogps.setupUpdator=function(){var a={run:function(){biogps.callRemoteService({url:"/tickermsgs/",fn:function(c){var d=[{text:"Welcome to BioGPS site."}];if(c.reader.jsonData.cnt_user_all){d.push({text:String.format("There are currently {0} registered users.",c.reader.jsonData.cnt_user_all)})}if(c.reader.jsonData.cnt_newuser_lastweek&&c.reader.jsonData.cnt_newuser_lastweek>0){d.push({text:String.format("{0} new users registered in the last week.",c.reader.jsonData.cnt_newuser_lastweek)})}if(c.reader.jsonData.cnt_user_lastweek){d.push({text:String.format("There are {0} users visited BioGPS last week.",c.reader.jsonData.cnt_user_lastweek)})}if(c.reader.jsonData.cnt_plugins){d.push({text:String.format("There are {0} registered plugins in the plugin library.",c.reader.jsonData.cnt_plugins)})}if(c.reader.jsonData.cnt_layouts){d.push({text:String.format("BioGPS users have created {0} custom user layouts.",c.reader.jsonData.cnt_layouts)})}biogps.ticker_msgs=d},ignorefailure:true})},interval:300*1000};var b=new Ext.util.TaskRunner();b.start(a)};biogps.initLogo=function(){var a=Ext.get("biogps-logo");if(a){function c(){if(!biogps.logopanel){var e=a.getLeft();var d=a.getBottom();var f=9;biogps.logopanel=new Ext.Panel({id:"logopanel",layout:"fit",floating:true,renderTo:Ext.getBody(),shadow:false,x:e,y:d,width:172,height:83,html:String.format('<img width="100%" height="100%" src="/assets/img/logos/logo{0}.png" alt="logo" />',Math.ceil(Math.random()*100%f)),listeners:{render:function(g){g.el.fadeIn({duration:0.5})}}})}}function b(){if(biogps.logopanel){biogps.logopanel.el.fadeOut({duration:0.5,callback:function(){if(biogps.logopanel&&biogps.logopanel.destroy){biogps.logopanel.destroy()}biogps.logopanel=null}})}}a.hover(c,b,this)}};biogps.formatPermision=function(a){if(a){if(a.first){a=a.first()}if(a=="GNF Users"){a="gnfusers"}else{if(a=="BioGPS Users"){a="biogpsusers"}else{a="myself"}}}else{a="myself"}return a};biogps.GENOMEASSEMBLY={hg18:"human",mm9:"mouse",rn4:"rat",dm3:"drosophila"};biogps.TAXONOMY_LIST=new Ext.data.SimpleStore({fields:["name","taxid"],data:[["Human",9606],["Mouse",10090],["Rat",10116],["drosophila",7227]]});biogps.PLUGINKEYWORDS_common=[{key:"{{EntrezGene}}",text:"Entrez GeneID"},{key:"{{Symbol}}",text:"Symbol"},{key:"{{EnsemblGene}}",text:"Ensembl GeneID"},{key:"{{Unigene}}",text:"UniGene ID"},{key:"{{Uniprot}}",text:"Uniprot ID"},{key:"{{Refseq_mRNA}}",text:"RefSeq Transcript"},{key:"{{Refseq_protein}}",text:"RefSeq Protein"},{key:"{{PDB}}",text:"PDB ID"}];biogps.PLUGINKEYWORDS_other=[{key:"{{FLYBASE}}",text:"FLYBASE",allowedSpecies:["drosophila"]},{key:"{{assembly}}",text:"Genome Assembly"},{key:"{{genomelocation}}",text:"Genomic Location"},{key:"{{chr}}",text:"Chromosome"},{key:"{{gstart}}",text:"Genomic Start Position"},{key:"{{gend}}",text:"Genomic End Position"},{key:"{{Aliases}}",text:"Aliases"},{key:"{{HGNC}}",text:"HGNC",allowedSpecies:["human"]},{key:"{{HPRD}}",text:"HPRD",allowedSpecies:["human"]},{key:"{{MGI}}",text:"MGI",allowedSpecies:["mouse"]},{key:"{{MIM}}",text:"OMIM",allowedSpecies:["human"]},{key:"{{RATMAP}}",text:"RATMAP",allowedSpecies:["rat"]},{key:"{{RGD}}",text:"RGD",allowedSpecies:["rat"]},{key:"{{TAIR}}",text:"TAIR",allowedSpecies:["arabidopsis"]},{key:"{{WormBase}}",text:"WormBase",allowedSpecies:["c. elegans"]},{key:"{{ZFIN}}",text:"ZFIN",allowedSpecies:["zebrafish"]}];Ext.override(Ext.form.CheckboxGroup,{getRawValue:function(){var a=[];this.eachItem(function(b){if(b.checked){a.push(b.getRawValue())}});return a}});biogps.get_sessionid=function(){var c=document.cookie;var d="sessionid=";var b=c.indexOf(d);if(b==-1){return""}else{var e=b+d.length;var a=c.substring(b).indexOf(";");if(a==-1){return c.substring(e)}else{return c.substring(e,b+a)}}};function deepObjCopy(a){var b=new Object();if(typeof(a)=="object"){if(typeof(a.length)!="undefined"){var b=new Array()}for(var c in a){if(typeof(a[c])=="object"){b[c]=deepObjCopy(a[c])}else{if(typeof(a[c])=="string"){b[c]=a[c]}else{if(typeof(a[c])=="number"){b[c]=a[c]}else{if(typeof(a[c])=="boolean"){((a[c]==true)?b[c]=true:b[c]=false)}}}}}}return b}if(!Ext.isArray&&isArray){Ext.isArray=isArray}function isArray(){if(typeof arguments[0]=="object"){var a=arguments[0].constructor.toString().match(/array/i);return(a!=null)}return false}function isString(){if(typeof arguments[0]=="string"){return true}if(typeof arguments[0]=="object"){var a=arguments[0].constructor.toString().match(/string/i);return(a!=null)}return false}biogps.utils.toggleScrollbar=function(a,b){if(b){a.setStyle("overflow","hidden")}else{a.setStyle("overflow","auto")}};biogps.utils.loadGeneList=function(a){if(Ext.isArray(a)&&a.length>0&&biogps.genelist_panel){biogps.genelist_panel.loadFromGeneIDList(a)}};biogps.renderPluginBrowsePanel=function(a,d){var c=Ext.getCmp("center_panel");var h="pluginbrowse_panel";var b=c.getItem(h);var f=false;if(!b){b=c.add({title:"Plugin Library",id:h,closable:true,layout:"fit",autoScroll:true});var e=function(){if(Ext.get("pluginbrowse_panel")){biogps.renderPluginBrowsePanel(a=true)}};biogps.usrMgr.linkWithAuthentication(e);b.on("destroy",function(){biogps.usrMgr.unlinkWithAuthentication(e);biogps.currentPluginRenderer=null;delete biogps.currentPluginRenderer;var k;for(var j=0;j<Windows.windows.length;j++){k=Windows.windows[j];if(k.getId().startsWith("preview")){k.close()}}});f=true}biogps.centerTab.suspendEvents();biogps.centerTab.setActiveTab(b);biogps.centerTab.resumeEvents();if(f||a){var g=new Ext.LoadMask(biogps.centerTab.body,{msg:"Loading Plugin Library...",removeMask:true});g.show();b.load({url:"/plugin/browse",scripts:true,nocache:true,callback:function(k,l,i,j){if(l){if(initLibrary){initLibrary(d)}}else{biogps.ajaxfailure(null,i)}}})}else{biogps.currentLibrary.setActiveItem("library-home","breadcrumb")}}
/*
 * Ext JS Library 3.0.0
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
;Ext.Element.addMethods({autoHeight:function(a,c,b,e){var d=this.getHeight();this.clip();this.setHeight(1);setTimeout(function(){var f=parseInt(this.dom.scrollHeight,10);if(!a){this.setHeight(f);this.unclip();if(typeof b=="function"){b()}}else{this.setHeight(d);this.setHeight(f,a,c,function(){this.unclip();if(typeof b=="function"){b()}}.createDelegate(this),e)}}.createDelegate(this),0);return this}});
/*
 * ux.ManagedIFrame for ExtJS Library 3.1+
 * Copyright(c) 2008-2009 Active Group, Inc.
 * licensing@theactivegroup.com
 * http://licensing.theactivegroup.com
 */
Ext.namespace("Ext.ux.plugin");Ext.onReady(function(){var a=Ext.util.CSS;if(a){a.getRule(".x-hide-nosize")||a.createStyleSheet(".x-hide-nosize{height:0px!important;width:0px!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;border:none!important;zoom:1;}");a.refreshCache()}});(function(){var g=Ext.Element,b=Ext.lib.Anim,a=g.prototype;var f="visibility",d="display",c="hidden",h="none";var e={};e.El={setDisplayed:function(j){var i=this;i.visibilityCls?(i[j!==false?"removeClass":"addClass"](i.visibilityCls)):a.setDisplayed.call(i,j);return i},isDisplayed:function(){return !(this.hasClass(this.visibilityCls)||this.isStyle(d,h))},fixDisplay:function(){var i=this;a.fixDisplay.call(i);i.visibilityCls&&i.removeClass(i.visibilityCls)},isVisible:function(j){var k=this.visible||(!this.isStyle(f,c)&&(this.visibilityCls?!this.hasClass(this.visibilityCls):!this.isStyle(d,h)));if(j!==true||!k){return k}var l=this.dom.parentNode,i=/^body/i;while(l&&!i.test(l.tagName)){if(!Ext.fly(l,"_isVisible").isVisible()){return false}l=l.parentNode}return true},isStyle:a.isStyle||function(i,j){return this.getStyle(i)==j}};Ext.override(g.Flyweight,e.El);Ext.ux.plugin.VisibilityMode=function(j){Ext.apply(this,j||{});var i=Ext.util.CSS;if(i&&!Ext.isIE&&this.fixMaximizedWindow!==false&&!Ext.ux.plugin.VisibilityMode.MaxWinFixed){i.updateRule(".x-window-maximized-ct","overflow","");Ext.ux.plugin.VisibilityMode.MaxWinFixed=true}};Ext.extend(Ext.ux.plugin.VisibilityMode,Object,{bubble:true,fixMaximizedWindow:true,elements:null,visibilityCls:"x-hide-nosize",hideMode:"nosize",ptype:"uxvismode",init:function(m){var j=this.hideMode||m.hideMode,l=this,i=Ext.Container.prototype.bubble,k=function(){var p=[this.collapseEl,this.actionMode].concat(l.elements||[]);Ext.each(p,function(q){l.extend(this[q]||q)},this);var n={visFixed:true,animCollapse:false,animFloat:false,hideMode:j,defaults:this.defaults||{}};n.defaults.hideMode=j;Ext.apply(this,n);Ext.apply(this.initialConfig||{},n)};m.on("render",function(){if(l.bubble!==false&&this.ownerCt){i.call(this.ownerCt,function(){this.visFixed||this.on("afterlayout",k,this,{single:true})})}k.call(this)},m,{single:true})},extend:function(i,j){i&&Ext.each([].concat(i),function(k){if(k&&k.dom){if("visibilityCls" in k){return}Ext.apply(k,e.El);k.visibilityCls=j||this.visibilityCls}},this);return this}});Ext.preg&&Ext.preg("uxvismode",Ext.ux.plugin.VisibilityMode);Ext.provide&&Ext.provide("uxvismode")})();(function(){var w=Ext.Element,ac,Q=Ext.lib.Dom,r=Ext.lib.Anim,y=Ext.EventManager,m=Ext.lib.Event,Y=document,M=function(){},C=Object.prototype,h=C.toString,S="[object HTMLDocument]";if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,""),10)<311){alert("Ext Release "+Ext.version+" is not supported")}Ext._documents={};Ext._documents[Ext.id(document,"_doc")]=Ext.elCache;var W=Q.resolveDocumentCache=function(E,aA){var ay=ao(E),aB=Ext.isDocument(ay)?Ext.id(ay):aA,A=Ext._documents[aB]||null,az,ax;if(!A&&ay&&(ax=ay.parentWindow||ay.defaultView)){if(az=ax.frameElement){aB=az.id||az.name}}return A||Ext._documents[aB]||(aB?Ext._documents[aB]={}:null)},T=Q.clearDocumentCache=function(A){delete Ext._documents[A]};w.addMethods||(w.addMethods=function(A){Ext.apply(w.prototype,A||{})});Ext.removeNode=function(aA){var az=aA?aA.dom||aA:null;if(az&&az.tagName!="BODY"){var ax,ay,A=W(az),E;if((ay=A[az.id])&&(ax=ay.el)){if(ax.dom){Ext.enableNestedListenerRemoval?y.purgeElement(ax.dom,true):y.removeAll(ax.dom)}delete A[az.id];delete ax.dom;delete ax._context;ax=null}(E=az.parentElement||az.parentNode)&&E.removeChild(az);az=null}};var ae=function(aB,az){var aA=typeof aB==="function"?aB:function ay(){};var ax=aA._ovl;if(!ax){ax={base:aA};ax[aA.length||0]=aA;aA=function ay(){var aE=arguments.callee._ovl;var aD=aE[arguments.length]||aE.base;return aD&&aD!=arguments.callee?aD.apply(this,arguments):undefined}}var aC=[].concat(az);for(var E=0,A=aC.length;E<A;++E){ax[aC[E].length]=aC[E]}aA._ovl=ax;var ay=null;return aA};Ext.applyIf(Ext,{overload:ae(ae,[function(A){return ae(null,A)},function(ax,E,A){return ax[E]=ae(ax[E],A)}]),isArray:function(A){return !!A&&h.apply(A)=="[object Array]"},isObject:function(A){return !!A&&typeof A=="object"},isDocument:function(E,A){var az=E?E.dom||E:null;var ay=h.apply(az)==S||(az&&az.nodeType==9);if(ay&&A){try{ay=!!az.location}catch(ax){return false}}return ay},isWindow:function(A){var E=A?A.dom||A:null;return E?!!E.navigator||h.apply(E)=="[object Window]":false},isIterable:function(A){if(Ext.isArray(A)||A.callee){return true}if(/NodeList|HTMLCollection/.test(h.call(A))){return true}return((typeof A.nextNode!="undefined"||A.item)&&Ext.isNumber(A.length))},isElement:function(A){return A&&Ext.type(A)=="element"},isEvent:function(A){return h.apply(A)=="[object Event]"||(Ext.isObject(A)&&!Ext.type(o.constructor)&&(window.event&&A.clientX&&A.clientX==window.event.clientX))},isFunction:function(A){return !!A&&typeof A=="function"},isEventSupported:function(ay,az){var ax={select:"input",change:"input",submit:"form",reset:"form",load:"img",error:"img",abort:"img"},A={},aA=/^on/i,E=function(aD,aC){var aB=Ext.getDom(aC);return(aB?(Ext.isElement(aB)||Ext.isDocument(aB)?aB.nodeName.toLowerCase():aC.self?"#window":aC||"#object"):aC||"div")+":"+aD};return function(aF,aH){aF=(aF||"").replace(aA,"");var aG,aE=false;var aC="on"+aF;var aB=(aH?aH:ax[aF])||"div";var aD=E(aF,aB);if(aD in A){return A[aD]}aG=Ext.isString(aB)?Y.createElement(aB):aH;aE=(!!aG&&(aC in aG));aE||(aE=window.Event&&!!(String(aF).toUpperCase() in window.Event));if(!aE&&aG){aG.setAttribute&&aG.setAttribute(aC,"return;");aE=Ext.isFunction(aG[aC])}A[aD]=aE;aG=null;return aE}}()});var u=function(A){return w[(A.tagName||"-").toUpperCase()]||w};var ak;function ab(A,E){if(!ak){ak=new Ext.Element.Flyweight()}ak.dom=Ext.getDom(A,null,E);return ak}Ext.apply(Ext,{get:w.get=function(ax,az){if(!ax){return null}Ext.isDocument(az)||(az=Y);var E,aC,aB,A=W(az);if(typeof ax=="string"){aC=Ext.getDom(ax,null,az);if(!aC){return null}if(A[ax]&&A[ax].el){E=A[ax].el;E.dom=aC}else{E=w.addToCache(new (u(aC))(aC,null,az))}return E}else{if(ax instanceof w){A=W(ax);ax.dom=ax.getDocument().getElementById(ax.id)||ax.dom;if(ax.dom){(A[ax.id]||(A[ax.id]={data:{},events:{}})).el=ax}return ax}else{if(ax.tagName||Ext.isWindow(ax)){A=W(ax);aB=Ext.id(ax);if(A[aB]&&(E=A[aB].el)){E.dom=ax}else{E=w.addToCache(new (u(ax))(ax,null,az),null,A);ax.navigator&&(A[aB].skipGC=true)}return E}else{if(Ext.isDocument(ax)){if(!Ext.isDocument(ax,true)){return false}A=W(ax);if(A[Ext.id(ax)]&&A[ax.id].el){return A[ax.id].el}var ay=function(){};ay.prototype=w.prototype;var aA=new ay();aA.dom=ax;aA.id=Ext.id(ax,"_doc");aA._isDoc=true;w.addToCache(aA,null,A);A[aA.id].skipGC=true;return aA}else{if(ax.isComposite){return ax}else{if(Ext.isArray(ax)){return Ext.get(az,az).select(ax)}}}}}}return null},getDom:function(E,A,az){var ay=az||Y;if(!E||!ay){return null}if(E.dom){return E.dom}else{if(Ext.isString(E)){var ax=ay.getElementById(E);if(ax&&Ext.isIE&&A){if(E==ax.getAttribute("id")){return ax}else{return null}}return ax}else{return E}}},getBody:function(E){var A=Q.getDocument(E)||Y;return Ext.get(A.body||A.documentElement)},getDoc:Ext.overload([Ext.getDoc,function(A){return Ext.get(A,A)}])});w.data=function(E,A,ax){E=w.get(E);if(!E){return null}var ay=W(E)[E.id].data;if(arguments.length==2){return ay[A]}else{return(ay[A]=ax)}};w.addToCache=function(E,ay,A){ay=ay||E.id;var ax=A||W(E);ax[ay]={el:E,data:{},events:{}};return E};var ag={},X=/(-[a-z])/gi,L=function(A,E){return E.charAt(1).toUpperCase()},I=/alpha\(opacity=(.*)\)/i,t=/^\s+|\s+$/g,aq=/marginRight/,j=Ext.isIE?"styleFloat":"cssFloat",c=Y.defaultView,af="visibilityMode",x=w.DISPLAY,q="originalDisplay",D="padding",ai="margin",an="border",P="-left",au="-right",Z="-top",V="-bottom",e="-width",at=Math,F="opacity",g="visibility",a="display",ap="hidden",ad="none",v="isClipped",am="overflow",K="overflow-x",H="overflow-y",O="originalClip",s="x-masked",U="x-masked-relative",p={l:an+P+e,r:an+au+e,t:an+Z+e,b:an+V+e},al={l:D+P,r:D+au,t:D+Z,b:D+V},i={l:ai+P,r:ai+au,t:ai+Z,b:ai+V},aw=w.data,ah=Ext.getDom,B=Ext.get,b=Ext.DomHelper,z=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,n=Ext.util.CSS,av=function(E){var A=aw(E,q);if(A===undefined){aw(E,q,A="")}return A},N=function(E){var A=aw(E,af);if(A===undefined){aw(E,af,A=1)}return A};function k(A){return ag[A]||(ag[A]=A=="float"?j:A.replace(X,L))}w.addMethods({getDocument:function(){return this._context||(this._context=ao(this))},remove:function(E,A){var ax=this.dom;this.isMasked()&&this.unmask();if(ax){Ext.removeNode(ax);delete this._context;delete this.dom}},appendChild:function(A,E){return B(A,E||this.getDocument()).appendTo(this)},appendTo:function(A,E){ah(A,false,E||this.getDocument()).appendChild(this.dom);return this},insertBefore:function(A,E){(A=ah(A,false,E||this.getDocument())).parentNode.insertBefore(this.dom,A);return this},insertAfter:function(A,E){(A=ah(A,false,E||this.getDocument())).parentNode.insertBefore(this.dom,A.nextSibling);return this},insertFirst:function(E,A){E=E||{};if(E.nodeType||E.dom||typeof E=="string"){E=ah(E);this.dom.insertBefore(E,this.dom.firstChild);return !A?B(E):E}else{return this.createChild(E,this.dom.firstChild,A)}},replace:function(A,E){A=B(A,E||this.getDocument());this.insertBefore(A);A.remove();return this},replaceWith:function(A,ax){var E=this;if(A.nodeType||A.dom||typeof A=="string"){A=ah(A,false,ax||E.getDocument());E.dom.parentNode.insertBefore(A,E.dom)}else{A=b.insertBefore(E.dom,A)}var ay=W(E);Ext.removeNode(E.dom);E.id=Ext.id(E.dom=A);w.addToCache(E.isFlyweight?new (u(E.dom))(E.dom,null,ay):E);return E},insertHtml:function(E,ax,A){var ay=b.insertHtml(E,this.dom,ax);return A?Ext.get(ay,ao(ay)):ay},setVisibilityMode:function(A){aw(this.dom,af,A);return this},setVisible:function(az,E){var ax=this,ay=ax.dom,A=N(this.dom)==x;if(!E||!ax.anim){if(A){ax.setDisplayed(az)}else{ax.fixDisplay();ay.style.visibility=az?"visible":ap}}else{if(az){ax.setOpacity(0.01);ax.setVisible(true)}ax.anim({opacity:{to:(az?1:0)}},ax.preanim(arguments,1),null,0.35,"easeIn",function(){if(!az){ay.style[A?a:g]=(A)?ad:ap;Ext.fly(ay).setOpacity(1)}})}return ax},setDisplayed:function(A){if(typeof A=="boolean"){A=A?av(this.dom):ad}this.setStyle(a,A);return this},fixDisplay:function(){var A=this;if(A.isStyle(a,ad)){A.setStyle(g,ap);A.setStyle(a,av(this.dom));if(A.isStyle(a,ad)){A.setStyle(a,"block")}}},enableDisplayMode:function(A){this.setVisibilityMode(w.DISPLAY);if(!Ext.isEmpty(A)){aw(this.dom,q,A)}return this},scrollIntoView:function(ax,aA){var aF=this.getDocument();var aG=Ext.getDom(ax,null,aF)||Ext.getBody(aF).dom;var az=this.dom;var ay=this.getOffsetsTo(aG),aK=this.getScroll(),aC=ay[0]+aK.left,aJ=ay[1]+aK.top,aH=aJ+az.offsetHeight,E=aC+az.offsetWidth;var A=aG.clientHeight;var aD=parseInt(aG.scrollTop,10);var aI=parseInt(aG.scrollLeft,10);var aB=aD+A;var aE=aI+aG.clientWidth;if(az.offsetHeight>A||aJ<aD){aG.scrollTop=aJ}else{if(aH>aB){aG.scrollTop=aH-A}}aG.scrollTop=aG.scrollTop;if(aA!==false){if(az.offsetWidth>aG.clientWidth||aC<aI){aG.scrollLeft=aC}else{if(E>aE){aG.scrollLeft=E-aG.clientWidth}}aG.scrollLeft=aG.scrollLeft}return this},contains:function(A){try{return !A?false:Q.isAncestor(this.dom,A.dom?A.dom:A)}catch(E){return false}},getScroll:function(){var aB=this.dom,aA=this.getDocument(),A=aA.body,ax=aA.documentElement,E,az,ay;if(Ext.isDocument(aB)||aB==A){if(Ext.isIE&&Q.docIsStrict(aA)){E=ax.scrollLeft;az=ax.scrollTop}else{E=window.pageXOffset;az=window.pageYOffset}ay={left:E||(A?A.scrollLeft:0),top:az||(A?A.scrollTop:0)}}else{ay={left:aB.scrollLeft,top:aB.scrollTop}}return ay},getStyle:function(){var A=c&&c.getComputedStyle?function E(aD){var aA=!this._isDoc?this.dom:null,ax,az,ay,aB,aC=Ext.isWebKit,aB;if(!aA||!aA.style){return null}aD=k(aD);if(aC&&aq.test(aD)){aB=this.getStyle(a);aA.style.display="inline-block"}ay=(ax=aA.style[aD])?ax:(az=c.getComputedStyle(aA,""))?az[aD]:null;if(aC){if(ay=="rgba(0, 0, 0, 0)"){ay="transparent"}else{if(aB){aA.style.display=aB}}}return ay}:function E(aB){var az=!this._isDoc?this.dom:null,ax,ay;if(!az||!az.style){return null}if(aB==F){if(az.style.filter.match){if(ax=az.style.filter.match(I)){var aA=parseFloat(ax[1]);if(!isNaN(aA)){return aA?aA/100:0}}}return 1}aB=k(aB);return az.style[aB]||((ay=az.currentStyle)?ay[aB]:null)};var E=null;return A}(),setStyle:function(az,ay){if(this._isDoc||Ext.isDocument(this.dom)){return this}var E,ax,A;if(!Ext.isObject(az)){E={};E[az]=ay;az=E}for(ax in az){ay=az[ax];ax==F?this.setOpacity(ay):this.dom.style[k(ax)]=ay}return this},center:function(A){return this.alignTo(A||this.getDocument(),"c-c")},mask:function(E,aA){var aC=this,ay=aC.dom,aB=Ext.DomHelper,az="ext-el-mask-msg",A,aD;if(aC.getStyle("position")=="static"){aC.addClass(U)}if((A=aw(ay,"maskMsg"))){A.remove()}if((A=aw(ay,"mask"))){A.remove()}aD=aB.append(ay,{cls:"ext-el-mask"},true);aw(ay,"mask",aD);aC.addClass(s);aD.setDisplayed(true);if(typeof E=="string"){var ax=aB.append(ay,{cls:az,cn:{tag:"div"}},true);aw(ay,"maskMsg",ax);ax.dom.className=aA?az+" "+aA:az;ax.dom.firstChild.innerHTML=E;ax.setDisplayed(true);ax.center(aC)}if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&aC.getStyle("height")=="auto"){aD.setSize(undefined,aC.getHeight())}return aD},unmask:function(){var ax=this,ay=ax.dom,A=aw(ay,"mask"),E=aw(ay,"maskMsg");if(A){if(E){E.remove();aw(ay,"maskMsg",undefined)}A.remove();aw(ay,"mask",undefined)}ax.removeClass([s,U])},isMasked:function(){var A=aw(this.dom,"mask");return A&&A.isVisible()},getCenterXY:function(){return this.getAlignToXY(this.getDocument(),"c-c")},getAnchorXY:function(az,aE,aJ){az=(az||"tl").toLowerCase();aJ=aJ||{};var aD=this,aG=this.getDocument(),E=aD.dom==aG.body||aD.dom==aG,aH=aJ.width||E?Q.getViewWidth(false,aG):aD.getWidth(),aB=aJ.height||E?Q.getViewHeight(false,aG):aD.getHeight(),aI,A=Math.round,ax=aD.getXY(),aF=aD.getScroll(),aC=E?aF.left:!aE?ax[0]:0,aA=E?aF.top:!aE?ax[1]:0,ay={c:[A(aH*0.5),A(aB*0.5)],t:[A(aH*0.5),0],l:[0,A(aB*0.5)],r:[aH,A(aB*0.5)],b:[A(aH*0.5),aB],tl:[0,0],bl:[0,aB],br:[aH,aB],tr:[aH,0]};aI=ay[az];return[aI[0]+aC,aI[1]+aA]},anchorTo:function(E,aA,ax,A,aC,aD){var aB=this,az=aB.dom;function ay(){ab(az).alignTo(E,aA,ax,A);Ext.callback(aD,ab(az))}Ext.EventManager.onWindowResize(ay,aB);if(!Ext.isEmpty(aC)){Ext.EventManager.on(window,"scroll",ay,aB,{buffer:!isNaN(aC)?aC:50})}ay.call(aB);return aB},getScroll:function(){var aB=this.dom,aA=this.getDocument(),A=aA.body,ax=aA.documentElement,E,az,ay;if(aB==aA||aB==A){if(Ext.isIE&&Q.docIsStrict(aA)){E=ax.scrollLeft;az=ax.scrollTop}else{E=window.pageXOffset;az=window.pageYOffset}ay={left:E||(A?A.scrollLeft:0),top:az||(A?A.scrollTop:0)}}else{ay={left:aB.scrollLeft,top:aB.scrollTop}}return ay},getAlignToXY:function(ay,aK,aL){var aX;ay=Ext.get(ay,aX=this.getDocument());if(!ay||!ay.dom){throw"Element.getAlignToXY with an element that doesn't exist"}aL=aL||[0,0];aK=(aK=="?"?"tl-bl?":(!/-/.test(aK)&&aK!=""?"tl-"+aK:aK||"tl-bl")).toLowerCase();var aU=this,aR=aU.dom,aW,aV,aD,aC,aF,aP,aI,aG=Q.getViewWidth(false,aX)-10,aQ=Q.getViewHeight(false,aX)-10,E,az,aA,aB,aH,aJ,aT=aX.documentElement,aE=aX.body,aO=(aT.scrollLeft||aE.scrollLeft||0)+5,aN=(aT.scrollTop||aE.scrollTop||0)+5,aS=false,ax="",A="",aM=aK.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!aM){throw"Element.getAlignToXY with an invalid alignment "+aK}ax=aM[1];A=aM[2];aS=!!aM[3];aW=aU.getAnchorXY(ax,true);aV=ay.getAnchorXY(A,false);aD=aV[0]-aW[0]+aL[0];aC=aV[1]-aW[1]+aL[1];if(aS){aF=aU.getWidth();aP=aU.getHeight();aI=ay.getRegion();E=ax.charAt(0);az=ax.charAt(ax.length-1);aA=A.charAt(0);aB=A.charAt(A.length-1);aH=((E=="t"&&aA=="b")||(E=="b"&&aA=="t"));aJ=((az=="r"&&aB=="l")||(az=="l"&&aB=="r"));if(aD+aF>aG+aO){aD=aJ?aI.left-aF:aG+aO-aF}if(aD<aO){aD=aJ?aI.right:aO}if(aC+aP>aQ+aN){aC=aH?aI.top-aP:aQ+aN-aP}if(aC<aN){aC=aH?aI.bottom:aN}}return[aD,aC]},adjustForConstraints:function(ax,A,E){return this.getConstrainToXY(A||this.getDocument(),false,E,ax)||ax},getConstrainToXY:function(E,A,ax,az){var ay={top:0,left:0,bottom:0,right:0};return function(aB,aO,aD,aF){var aS=this.getDocument();aB=Ext.get(aB,aS);aD=aD?Ext.applyIf(aD,ay):ay;var aN,aR,aM=0,aL=0;if(aB.dom==aS.body||aB.dom==aS){aN=Q.getViewWidth(false,aS);aR=Q.getViewHeight(false,aS)}else{aN=aB.dom.clientWidth;aR=aB.dom.clientHeight;if(!aO){var aK=aB.getXY();aM=aK[0];aL=aK[1]}}var aJ=aB.getScroll();aM+=aD.left+aJ.left;aL+=aD.top+aJ.top;aN-=aD.right;aR-=aD.bottom;var aP=aM+aN;var aA=aL+aR;var aC=aF||(!aO?this.getXY():[this.getLeft(true),this.getTop(true)]);var aH=aC[0],aG=aC[1];var aI=this.dom.offsetWidth,aQ=this.dom.offsetHeight;var aE=false;if((aH+aI)>aP){aH=aP-aI;aE=true}if((aG+aQ)>aA){aG=aA-aQ;aE=true}if(aH<aM){aH=aM;aE=true}if(aG<aL){aG=aL;aE=true}return aE?[aH,aG]:false}}(),getCenterXY:function(){return this.getAlignToXY(Ext.getBody(this.getDocument()),"c-c")},center:function(A){return this.alignTo(A||Ext.getBody(this.getDocument()),"c-c")},findParent:function(aC,aB,E){var az=this.dom,ay=this.getDocument(),A=ay.body,aA=0,ax;if(Ext.isGecko&&h.call(az)=="[object XULElement]"){return null}aB=aB||50;if(isNaN(aB)){ax=Ext.getDom(aB,null,ay);aB=Number.MAX_VALUE}while(az&&az.nodeType==1&&aA<aB&&az!=A&&az!=ax){if(Ext.DomQuery.is(az,aC)){return E?Ext.get(az,ay):az}aA++;az=az.parentNode}return null},clip:function(){var A=this,E=A.dom;if(!aw(E,v)){aw(E,v,true);aw(E,O,{o:A.getStyle(am),x:A.getStyle(K),y:A.getStyle(H)});A.setStyle(am,ap);A.setStyle(K,ap);A.setStyle(H,ap)}return A},unclip:function(){var A=this,ax=A.dom;if(aw(ax,v)){aw(ax,v,false);var E=aw(ax,O);if(E.o){A.setStyle(am,E.o)}if(E.x){A.setStyle(K,E.x)}if(E.y){A.setStyle(H,E.y)}}return A},getViewSize:function(){var ax=this.getDocument(),ay=this.dom,A=(ay==ax||ay==ax.body);if(A){var E=Ext.lib.Dom;return{width:E.getViewWidth(),height:E.getViewHeight()}}else{return{width:ay.clientWidth,height:ay.clientHeight}}},getStyleSize:function(){var az=this,A,ay,aB=this.getDocument(),aC=this.dom,E=(aC==aB||aC==aB.body),ax=aC.style;if(E){var aA=Ext.lib.Dom;return{width:aA.getViewWidth(),height:aA.getViewHeight()}}if(ax.width&&ax.width!="auto"){A=parseFloat(ax.width);if(az.isBorderBox()){A-=az.getFrameWidth("lr")}}if(ax.height&&ax.height!="auto"){ay=parseFloat(ax.height);if(az.isBorderBox()){ay-=az.getFrameWidth("tb")}}return{width:A||az.getWidth(true),height:ay||az.getHeight(true)}}});Ext.isDefined(w.collectorThreadId)&&clearInterval(w.collectorThreadId);function l(){if(!Ext.enableGarbageCollector){clearInterval(w.collectorThreadId)}else{var A,ay,aA,az,ax=Ext.elCache;for(A in ax){az=ax[A];if(az.skipGC){continue}ay=az.el;aA=ay.dom;if(!aA||!aA.parentNode||(!aA.offsetParent&&!Y.getElementById(A))){if(Ext.enableListenerCollection){Ext.EventManager.removeAll(aA)}delete ax[A]}}if(Ext.isIE){var E={};for(A in ax){E[A]=ax[A]}Ext.elCache=Ext._documents[Ext.id(document)]=E;E=null}}}if(Ext.enableGarbageCollector){w.collectorThreadId=setInterval(l,30000)}Ext.apply(Q,{getDocument:function(ax,ay){var az=null;try{az=Ext.getDom(ax,null,null)}catch(E){}var A=Ext.isDocument(az);if(A){if(ay){return Ext.isDocument(az,ay)?az:null}return az}return az?az.ownerDocument||az.document:null},docIsStrict:function(A){return(Ext.isDocument(A)?A:this.getDocument(A)).compatMode=="CSS1Compat"},getViewWidth:Ext.overload([Q.getViewWidth||function(A){},function(){return this.getViewWidth(false)},function(A,E){return A?this.getDocumentWidth(E):this.getViewportWidth(E)}]),getViewHeight:Ext.overload([Q.getViewHeight||function(A){},function(){return this.getViewHeight(false)},function(A,E){return A?this.getDocumentHeight(E):this.getViewportHeight(E)}]),getDocumentHeight:Ext.overload([Q.getDocumentHeight||M,function(A){if(A=this.getDocument(A)){return Math.max(!this.docIsStrict(A)?A.body.scrollHeight:A.documentElement.scrollHeight,this.getViewportHeight(A))}return undefined}]),getDocumentWidth:Ext.overload([Q.getDocumentWidth||M,function(A){if(A=this.getDocument(A)){return Math.max(!this.docIsStrict(A)?A.body.scrollWidth:A.documentElement.scrollWidth,this.getViewportWidth(A))}return undefined}]),getViewportHeight:Ext.overload([Q.getViewportHeight||M,function(A){if(A=this.getDocument(A)){if(Ext.isIE){return this.docIsStrict(A)?A.documentElement.clientHeight:A.body.clientHeight}else{return A.defaultView.innerHeight}}return undefined}]),getViewportWidth:Ext.overload([Q.getViewportWidth||M,function(A){if(A=this.getDocument(A)){return !this.docIsStrict(A)&&!Ext.isOpera?A.body.clientWidth:Ext.isIE?A.documentElement.clientWidth:A.defaultView.innerWidth}return undefined}]),getXY:Ext.overload([Q.getXY||M,function(A,ay){A=Ext.getDom(A,null,ay);var ax=this.getDocument(A),E=ax?(ax.body||ax.documentElement):null;if(!A||!E||A==E){return[0,0]}return this.getXY(A)}])});var ao=Q.getDocument,d=w._flyweights;Ext.fly=w.fly=function(ax,A,ay){var E=null;A=A||"_global";if(ax=Ext.getDom(ax,null,ay)){(E=d[A]=(d[A]||new w.Flyweight())).dom=ax;Ext.isDocument(ax)&&(E._isDoc=true)}return E};var G=function(){};G.prototype=w.prototype;w.Flyweight=function(A){this.dom=A};w.Flyweight.prototype=new G();w.Flyweight.prototype.isFlyweight=true;function f(ax,az,aC,ay,E,aE){ax=Ext.getDom(ax);if(!ax){return}var A=Ext.get(ax).id,aD=(W(ax)[A]||{}).events||{},aA;aA=m.on(ax,az,E);aD[az]=aD[az]||[];aD[az].push([aC,E,aE,aA,ay]);if(az=="mousewheel"&&ax.addEventListener){var aB=["DOMMouseScroll",E,false];ax.addEventListener.apply(ax,aB);Ext.EventManager.addListener(window,"beforeunload",function(){ax.removeEventListener.apply(ax,aB)})}if(az=="mousedown"&&Ext.isDocument(ax)){Ext.EventManager.stoppedMouseDownEvent.addListener(E)}}function R(A,E){return function(){var ax=Ext.toArray(arguments);if(E.target==Ext.EventObject.setEvent(ax[0]).target){A.apply(this,ax)}}}function J(E,ax,A){return function(ay){A.delay(ax.buffer,E,null,[new Ext.EventObjectImpl(ay)])}}function aj(az,ay,A,ax,E){return function(aA){Ext.EventManager.removeListener(ay,A,ax,E);az(aA)}}function ar(E,ax,A){return function(az){var ay=new Ext.util.DelayedTask(E);(A.tasks||(A.tasks=[])).push(ay);ay.delay(ax.delay||10,E,null,[new Ext.EventObjectImpl(az)])}}function aa(aA,az,A,aC,aD){var E=!Ext.isObject(A)?{}:A,ax=Ext.getDom(aA),ay;aC=aC||E.fn;aD=aD||E.scope;if(!ax){throw'Error listening for "'+az+'". Element "'+aA+"\" doesn't exist."}function aB(aF){if(!window.Ext){return}aF=Ext.EventObject.setEvent(aF);var aE;if(E.delegate){if(!(aE=aF.getTarget(E.delegate,ax))){return}}else{aE=aF.target}if(E.stopEvent){aF.stopEvent()}if(E.preventDefault){aF.preventDefault()}if(E.stopPropagation){aF.stopPropagation()}if(E.normalized){aF=aF.browserEvent}aC.call(aD||ax,aF,aE,E)}if(E.target){aB=R(aB,E)}if(E.delay){aB=ar(aB,E,aC)}if(E.single){aB=aj(aB,ax,az,aC,aD)}if(E.buffer){ay=new Ext.util.DelayedTask(aB);aB=J(aB,E,ay)}f(ax,az,aC,ay,aB,aD);return aB}Ext.apply(y,{addListener:y.on=function(ax,A,az,ay,E){if(Ext.isObject(A)){var aC=A,aA,aB;for(aA in aC){aB=aC[aA];if(!z.test(aA)){if(Ext.isFunction(aB)){aa(ax,aA,aC,aB,aC.scope)}else{aa(ax,aA,aB)}}}}else{aa(ax,A,E,az,ay)}},removeListener:y.un=function(aB,aC,aG,aI){var ax=Ext.getDom(aB);ax&&Ext.get(ax);var aH=ax?W(ax):{},aE=ax&&((aH[ax.id]||{events:{}}).events)[aC]||[],A,aA,ay,az,E,aD,aF;for(aA=0,aD=aE.length;aA<aD;aA++){if(Ext.isArray(aF=aE[aA])&&aF[0]==aG&&(!aI||aF[2]==aI)){aF[4]&&aF[4].cancel();az=aG.tasks&&aG.tasks.length;if(az){while(az--){aG.tasks[az].cancel()}delete aG.tasks}A=aF[1];m.un(ax,aC,m.extAdapter?aF[3]:A);if(aC=="mousewheel"&&ax.addEventListener&&A){ax.removeEventListener("DOMMouseScroll",A,false)}if(aC=="mousedown"&&ax==Y&&A){Ext.EventManager.stoppedMouseDownEvent.removeListener(A)}aE.splice(aA,1);if(aE.length===0){delete aH[ax.id].events[aC]}for(az in aH[ax.id].events){return false}aH[ax.id].events={};return false}}},removeAll:function(ax){if(!(ax=Ext.getDom(ax))){return}var E=ax.id,aF=W(ax)||{},aG=aF[E]||{},aE=aG.events||{},aB,aA,aC,ay,aD,az,A;for(ay in aE){if(aE.hasOwnProperty(ay)){aB=aE[ay];for(aA=0,aC=aB.length;aA<aC;aA++){aD=aB[aA];aD[4]&&aD[4].cancel();if(aD[0].tasks&&(az=aD[0].tasks.length)){while(az--){aD[0].tasks[az].cancel()}delete aD.tasks}A=aD[1];m.un(ax,ay,m.extAdapter?aD[3]:A);if(ax.addEventListener&&A&&ay=="mousewheel"){ax.removeEventListener("DOMMouseScroll",A,false)}if(A&&ax==Y&&ay=="mousedown"){Ext.EventManager.stoppedMouseDownEvent.removeListener(A)}}}}aF[E]&&(aF[E].events={})},getListeners:function(ax,E){ax=Ext.getDom(ax);if(!ax){return}var az=(Ext.get(ax)||{}).id,A=W(ax),ay=(A[az]||{}).events||{};return ay[E]||null},purgeElement:function(ax,A,az){ax=Ext.getDom(ax);var E=ax.id,aC=W(ax),aD=(aC[E]||{}).events||{},ay,aB,aA;if(az){if(aD.hasOwnProperty(az)){aB=aD[az];for(ay=0,aA=aB.length;ay<aA;ay++){y.removeListener(ax,az,aB[ay][0])}}}else{y.removeAll(ax)}if(A&&ax&&ax.childNodes){for(ay=0,aA=ax.childNodes.length;ay<aA;ay++){y.purgeElement(ax.childNodes[ay],A,az)}}}});m.getListeners=function(E,A){return Ext.EventManager.getListeners(E,A)};Ext.provide&&Ext.provide("multidom")})();(function(){var El=Ext.Element,ElFrame,ELD=Ext.lib.Dom,EMPTYFN=function(){},OP=Object.prototype,addListener=function(){var handler;if(window.addEventListener){handler=function F(el,eventName,fn,capture){el.addEventListener(eventName,fn,!!capture)}}else{if(window.attachEvent){handler=function F(el,eventName,fn,capture){el.attachEvent("on"+eventName,fn)}}else{handler=function F(){}}}var F=null;return handler}(),removeListener=function(){var handler;if(window.removeEventListener){handler=function F(el,eventName,fn,capture){el.removeEventListener(eventName,fn,(capture))}}else{if(window.detachEvent){handler=function F(el,eventName,fn){el.detachEvent("on"+eventName,fn)}}else{handler=function F(){}}}var F=null;return handler}();if(typeof ELD.getDocument!="function"){alert("MIF 2.1.1 requires multidom support")}if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,""),10)<311){alert("Ext Release "+Ext.version+" is not supported")}Ext.ns("Ext.ux.ManagedIFrame","Ext.ux.plugin");var MIM,MIF=Ext.ux.ManagedIFrame,MIFC;var frameEvents=["documentloaded","domready","focus","blur","resize","scroll","unload","scroll","exception","message","reset"];var reSynthEvents=new RegExp("^("+frameEvents.join("|")+")","i");Ext.ux.ManagedIFrame.Element=Ext.extend(Ext.Element,{constructor:function(element,forceNew,doc){var d=doc||document;var elCache=ELD.resolveDocumentCache(d);var dom=Ext.getDom(element,false,d);if(!dom||!(/^(iframe|frame)/i).test(dom.tagName)){return null}var id=Ext.id(dom);this.dom=dom;this.id=id;(elCache[id]||(elCache[id]={el:this,events:{},data:{}})).el=this;this.dom.name||(this.dom.name=this.id);if(Ext.isIE){document.frames&&(document.frames[this.dom.name]||(document.frames[this.dom.name]=this.dom))}this.dom.ownerCt=this;MIM.register(this);if(!this._observable){(this._observable=new Ext.util.Observable()).addEvents("documentloaded","domready","exception","resize","message","blur","focus","unload","scroll","reset");this._observable.addEvents("_docready","_docload")}var H=Ext.isIE?"onreadystatechange":"onload";this.dom[H]=this.loadHandler.createDelegate(this);this.dom.onerror=this.loadHandler.createDelegate(this)},destructor:function(){this.dom[Ext.isIE?"onreadystatechange":"onload"]=this.dom.onerror=EMPTYFN;MIM.deRegister(this);this.removeAllListeners();Ext.destroy(this.frameShim,this.DDM);this.hideMask(true);delete this.loadMask;this.reset();this.manager=null;this.dom.ownerCt=null},cleanse:function(forceReclean,deep){if(this.isCleansed&&forceReclean!==true){return this}var d=this.dom,n=d.firstChild,nx;while(d&&n){nx=n.nextSibling;deep&&Ext.fly(n).cleanse(forceReclean,deep);Ext.removeNode(n);n=nx}this.isCleansed=true;return this},src:null,CSS:null,manager:null,disableMessaging:true,domReadyRetries:7500,focusOnLoad:Ext.isIE,eventsFollowFrameLinks:true,_domCache:null,remove:function(){this.destructor.apply(this,arguments);ElFrame.superclass.remove.apply(this,arguments)},getDocument:function(){return this.dom?this.dom.ownerDocument:document},submitAsTarget:function(submitCfg){var opt=submitCfg||{},D=this.getDocument(),form=Ext.getDom(opt.form?opt.form.form||opt.form:null,false,D)||Ext.DomHelper.append(D.body,{tag:"form",cls:"x-hidden x-mif-form",encoding:"multipart/form-data"}),formFly=Ext.fly(form,"_dynaForm"),formState={target:form.target||"",method:form.method||"",encoding:form.encoding||"",enctype:form.enctype||"",action:form.action||""},encoding=opt.encoding||form.encoding,method=opt.method||form.method||"POST";formFly.set({target:this.dom.name,method:method,encoding:encoding,action:opt.url||opt.action||form.action});if(method=="POST"||!!opt.enctype){formFly.set({enctype:opt.enctype||form.enctype||encoding})}var hiddens,hd,ps;if(opt.params&&(ps=Ext.isFunction(opt.params)?opt.params():opt.params)){hiddens=[];Ext.iterate(ps=typeof ps=="string"?Ext.urlDecode(ps,false):ps,function(n,v){Ext.fly(hd=D.createElement("input")).set({type:"hidden",name:n,value:v});form.appendChild(hd);hiddens.push(hd)})}opt.callback&&this._observable.addListener("_docready",opt.callback,opt.scope,{single:true});this._frameAction=true;this._targetURI=location.href;this.showMask();(function(){form.submit();hiddens&&Ext.each(hiddens,Ext.removeNode,Ext);if(formFly.hasClass("x-mif-form")){formFly.remove()}else{formFly.set(formState)}delete El._flyweights._dynaForm;formFly=null;this.hideMask(true)}).defer(100,this);return this},resetUrl:(function(){return Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"about:blank"})(),setSrc:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&&O.addListener("_docload",callback,scope||this,{single:true});this.showMask();(discardUrl!==true)&&(this.src=src);var s=this._targetURI=(Ext.isFunction(src)?src()||"":src);try{this._frameAction=true;this.dom.src=s;this.checkDOM()}catch(ex){O.fireEvent.call(O,"exception",this,ex)}return this},setLocation:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&&O.addListener("_docload",callback,scope||this,{single:true});this.showMask();var s=this._targetURI=(Ext.isFunction(src)?src()||"":src);if(discardUrl!==true){this.src=src}try{this._frameAction=true;this.getWindow().location.replace(s);this.checkDOM()}catch(ex){O.fireEvent.call(O,"exception",this,ex)}return this},reset:function(src,callback,scope){this._unHook();var loadMaskOff=false,s=src,win=this.getWindow(),O=this._observable;if(this.loadMask){loadMaskOff=this.loadMask.disabled;this.loadMask.disabled=false}this.hideMask(true);if(win){this.isReset=true;var cb=callback;O.addListener("_docload",function(frame){if(this.loadMask){this.loadMask.disabled=loadMaskOff}Ext.isFunction(cb)&&(cb=cb.apply(scope||this,arguments));O.fireEvent("reset",this)},this,{single:true});Ext.isFunction(s)&&(s=src());s=this._targetURI=Ext.isEmpty(s,true)?this.resetUrl:s;win.location?(win.location.href=s):O.fireEvent("_docload",this)}return this},scriptRE:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,update:function(content,loadScripts,callback,scope){loadScripts=loadScripts||this.getUpdater().loadScripts||false;content=Ext.DomHelper.markup(content||"");content=loadScripts===true?content:content.replace(this.scriptRE,"");var doc;if((doc=this.getFrameDocument())&&!!content.length){this._unHook();this.src=null;this.showMask();Ext.isFunction(callback)&&this._observable.addListener("_docload",callback,scope||this,{single:true});this._targetURI=location.href;doc.open();this._frameAction=true;doc.write(content);doc.close();this.checkDOM()}else{this.hideMask(true);Ext.isFunction(callback)&&callback.call(scope,this)}return this},execCommand:function(command,userInterface,value,validate){var doc,assert;if((doc=this.getFrameDocument())&&!!command){try{Ext.isIE&&this.getWindow().focus();assert=validate&&Ext.isFunction(doc.queryCommandEnabled)?doc.queryCommandEnabled(command):true;return assert&&doc.execCommand(command,!!userInterface,value)}catch(eex){return false}}return false},setDesignMode:function(active){var doc;(doc=this.getFrameDocument())&&(doc.designMode=(/on|true/i).test(String(active))?"on":"off")},getUpdater:function(){return this.updateManager||(this.updateManager=new MIF.Updater(this))},getHistory:function(){var h=null;try{h=this.getWindow().history}catch(eh){}return h},get:function(el){var doc=this.getFrameDocument();return doc?Ext.get(el,doc):doc=null},fly:function(el,named){var doc=this.getFrameDocument();return doc?Ext.fly(el,named,doc):null},getDom:function(el){var d;if(!el||!(d=this.getFrameDocument())){return(d=null)}return Ext.getDom(el,d)},select:function(selector,unique){var d;return(d=this.getFrameDocument())?Ext.Element.select(selector,unique,d):d=null},query:function(selector){var d;return(d=this.getFrameDocument())?Ext.DomQuery.select(selector,d):null},removeNode:Ext.removeNode,_renderHook:function(){this._windowContext=null;this.CSS=this.CSS?this.CSS.destroy():null;this._hooked=false;try{if(this.writeScript('(function(){(window.hostMIF = parent.document.getElementById("'+this.id+'").ownerCt)._windowContext='+(Ext.isIE?"window":'{eval:function(s){return new Function("return ("+s+")")();}}')+";})()")){var w,p=this._frameProxy,D=this.getFrameDocument();if(w=this.getWindow()){p||(p=this._frameProxy=this._eventProxy.createDelegate(this));addListener(w,"focus",p);addListener(w,"blur",p);addListener(w,"resize",p);addListener(w,"unload",p);D&&addListener(Ext.isIE?w:D,"scroll",p)}D&&(this.CSS=new Ext.ux.ManagedIFrame.CSS(D))}}catch(ex){}return this.domWritable()},_unHook:function(){if(this._hooked){var id,el,c=this._domCache;if(c){for(id in c){el=c[id].el;el&&el.removeAllListeners&&el.removeAllListeners();el&&(c[id].el=el=null);delete c[id].data;delete c[id]}}this._windowContext&&(this._windowContext.hostMIF=null);this._windowContext=null;var w,p=this._frameProxy;if(p&&this.domWritable()&&(w=this.getWindow())){removeListener(w,"focus",p);removeListener(w,"blur",p);removeListener(w,"resize",p);removeListener(w,"unload",p);removeListener(Ext.isIE?w:this.getFrameDocument(),"scroll",p)}}MIM._flyweights={};this._domCache=null;ELD.clearDocumentCache&&ELD.clearDocumentCache(this.id);this.CSS=this.CSS?this.CSS.destroy():null;this.domFired=this._frameAction=this.domReady=this._hooked=false},_windowContext:null,getFrameDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&&win?win.document:null)||this.dom.contentDocument||window.frames[this.dom.name].document||null}catch(gdEx){this._domCache=null;ELD.clearDocumentCache&&ELD.clearDocumentCache(this.id);return false}doc=(doc&&Ext.isFunction(ELD.getDocument))?ELD.getDocument(doc,true):doc;if(doc){this._domCache||(this._domCache=ELD.resolveDocumentCache(doc,this.id))}return doc},getDoc:function(){var D=this.getFrameDocument();return Ext.get(D,D)},getBody:function(){var d;return(d=this.getFrameDocument())?this.get(d.body||d.documentElement):null},getDocumentURI:function(){var URI,d;try{URI=this.src&&(d=this.getFrameDocument())?d.location.href:null}catch(ex){}return URI||(Ext.isFunction(this.src)?this.src():this.src)},getWindowURI:function(){var URI,w;try{URI=(w=this.getWindow())?w.location.href:null}catch(ex){}return URI||(Ext.isFunction(this.src)?this.src():this.src)},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null}catch(gwEx){}return win},scrollChildIntoView:function(child,container,hscroll){this.fly(child,"_scrollChildIntoView").scrollIntoView(this.getDom(container)||this.getBody().dom,hscroll);return this},print:function(){try{var win;if(win=this.getWindow()){Ext.isIE&&win.focus();win.print()}}catch(ex){throw new MIF.Error("printexception",ex.description||ex.message||ex)}return this},domWritable:function(){return !!Ext.isDocument(this.getFrameDocument(),true)&&!!this._windowContext},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block)}else{return this._windowContext.eval(block)}}else{throw new MIF.Error("execscript-secure-context")}}catch(ex){this._observable.fireEvent.call(this._observable,"exception",this,ex);return false}return true},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:"text/javascript",text:block});try{var head,script,doc=this.getFrameDocument();if(doc&&typeof doc.getElementsByTagName!="undefined"){if(!(head=doc.getElementsByTagName("head")[0])){head=doc.createElement("head");doc.getElementsByTagName("html")[0].appendChild(head)}if(head&&(script=doc.createElement("script"))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&&attrib in script){script[attrib]=attributes[attrib]}}return !!head.appendChild(script)}}}catch(ex){this._observable.fireEvent.call(this._observable,"exception",this,ex)}finally{script=head=null}return false},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fnSrc=fn.fn||window[fn];name&&fnSrc&&this.execScript(name+"="+fnSrc,useDOM);invokeIt&&this.execScript(name+"()")},loadHandler:function(e,target){var rstatus=(this.dom||{}).readyState||(e||{}).type;if(this.eventsFollowFrameLinks||this._frameAction||this.isReset){switch(rstatus){case"domready":case"DOMFrameContentLoaded":case"domfail":this._onDocReady(rstatus);break;case"load":case"complete":this._onDocLoaded(rstatus);break;case"error":this._observable.fireEvent.apply(this._observable,["exception",this].concat(arguments));break;default:}this.frameState=rstatus}},_onDocReady:function(eventName){var w,obv=this._observable,D;if(!this.isReset&&this.focusOnLoad&&(w=this.getWindow())){w.focus()}obv.fireEvent("_docready",this);(D=this.getDoc())&&(D.isReady=true);if(!this.domFired&&(this._hooked=this._renderHook())){this.domFired=true;this.isReset||obv.fireEvent.call(obv,"domready",this)}this.domReady=true;this.hideMask()},_onDocLoaded:function(eventName){var obv=this._observable,w;this.domReady||this._onDocReady("domready");obv.fireEvent("_docload",this);this.isReset||obv.fireEvent("documentloaded",this);this.hideMask(true);this._frameAction=this.isReset=false},checkDOM:function(win){if(Ext.isGecko){return}var n=0,frame=this,domReady=false,b,l,d,max=this.domReadyRetries||2500,polling=false,startLocation=(this.getFrameDocument()||{location:{}}).location.href;(function(){d=frame.getFrameDocument()||{location:{}};polling=(d.location.href!==startLocation||d.location.href===frame._targetURI);if(frame.domReady){return}domReady=polling&&((b=frame.getBody())&&!!(b.dom.innerHTML||"").length)||false;if(d.location.href&&!domReady&&(++n<max)){setTimeout(arguments.callee,2);return}frame.loadHandler({type:domReady?"domready":"domfail"})})()},filterEventOptionsRe:/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,addListener:function(eventName,fn,scope,options){if(typeof eventName=="object"){var o=eventName;for(var e in o){if(this.filterEventOptionsRe.test(e)){continue}if(typeof o[e]=="function"){this.addListener(e,o[e],o.scope,o)}else{this.addListener(e,o[e].fn,o[e].scope,o[e])}}return}if(reSynthEvents.test(eventName)){var O=this._observable;if(O){O.events[eventName]||(O.addEvents(eventName));O.addListener.call(O,eventName,fn,scope||this,options)}}else{ElFrame.superclass.addListener.call(this,eventName,fn,scope||this,options)}return this},removeListener:function(eventName,fn,scope){var O=this._observable;if(reSynthEvents.test(eventName)){O&&O.removeListener.call(O,eventName,fn,scope||this,options)}else{ElFrame.superclass.removeListener.call(this,eventName,fn,scope||this)}return this},removeAllListeners:function(){Ext.EventManager.removeAll(this.dom);var O=this._observable;O&&O.purgeListeners.call(this._observable);return this},showMask:function(msg,msgCls,maskCls){var lmask=this.loadMask;if(lmask&&!lmask.disabled){this.mask(msg||lmask.msg,msgCls||lmask.msgCls,maskCls||lmask.maskCls,lmask.maskEl)}},hideMask:function(forced){var tlm=this.loadMask||{};if(forced||(tlm.hideOnReady&&this.domReady)){this.unmask()}},mask:function(msg,msgCls,maskCls,maskEl){this._mask&&this.unmask();var p=Ext.get(maskEl)||this.parent(".ux-mif-mask-target")||this.parent();if(p.getStyle("position")=="static"&&!p.select("iframe,frame,object,embed").elements.length){p.addClass("x-masked-relative")}p.addClass("x-masked");this._mask=Ext.DomHelper.append(p,{cls:maskCls||"ux-mif-el-mask"},true);this._mask.setDisplayed(true);this._mask._agent=p;if(typeof msg=="string"){this._maskMsg=Ext.DomHelper.append(p,{cls:msgCls||"ux-mif-el-mask-msg",style:{visibility:"hidden"},cn:{tag:"div",html:msg}},true);this._maskMsg.setVisibilityMode(Ext.Element.VISIBILITY).center(p).setVisible(true)}if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&this.getStyle("height")=="auto"){this._mask.setSize(undefined,this._mask.getHeight())}return this._mask},unmask:function(){var a;if(this._mask){(a=this._mask._agent)&&a.removeClass(["x-masked-relative","x-masked"]);if(this._maskMsg){this._maskMsg.remove();delete this._maskMsg}this._mask.remove();delete this._mask}},createFrameShim:function(imgUrl,shimCls){this.shimCls=shimCls||this.shimCls||"ux-mif-shim";this.frameShim||(this.frameShim=this.next("."+this.shimCls)||Ext.DomHelper.append(this.dom.parentNode,{tag:"img",src:imgUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:"no"},true));this.frameShim&&(this.frameShim.autoBoxAdjust=false);return this.frameShim},toggleShim:function(show){var shim=this.frameShim||this.createFrameShim();var cls=this.shimCls+"-on";!show&&shim.removeClass(cls);show&&!shim.hasClass(cls)&&shim.addClass(cls)},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&&loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer}um.update.apply(um,arguments)}return this},_eventProxy:function(e){if(!e){return}e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e,er,args=[e.type,this];if(!be.eventPhase||(be.eventPhase==(be.AT_TARGET||2))){if(e.type=="resize"){var doc=this.getFrameDocument();doc&&(args.push({height:ELD.getDocumentHeight(doc),width:ELD.getDocumentWidth(doc)},{height:ELD.getViewportHeight(doc),width:ELD.getViewportWidth(doc)},{height:ELD.getViewHeight(false,doc),width:ELD.getViewWidth(false,doc)}))}er=this._observable?this._observable.fireEvent.apply(this._observable,args.concat(Array.prototype.slice.call(arguments,0))):null;(e.type=="unload")&&this._unHook()}return er},sendMessage:function(message,tag,origin){},postMessage:function(message,ports,origin){}});ElFrame=Ext.Element.IFRAME=Ext.Element.FRAME=Ext.ux.ManagedIFrame.Element;var fp=ElFrame.prototype;Ext.override(ElFrame,{on:fp.addListener,un:fp.removeListener,getUpdateManager:fp.getUpdater});Ext.ux.ManagedIFrame.ComponentAdapter=function(){};Ext.ux.ManagedIFrame.ComponentAdapter.prototype={version:2.01,defaultSrc:null,title:"&#160;",unsupportedText:"Inline frames are NOT enabled/supported by your browser.",hideMode:!Ext.isIE&&!!Ext.ux.plugin.VisibilityMode?"nosize":"display",animCollapse:Ext.isIE,animFloat:Ext.isIE,frameConfig:null,focusOnLoad:false,frameEl:null,useShim:false,autoScroll:true,autoLoad:null,getId:function(){return this.id||(this.id="mif-comp-"+(++Ext.Component.AUTO_ID))},stateEvents:["documentloaded"],stateful:false,setAutoScroll:function(auto){var scroll=Ext.value(auto,this.autoScroll===true);this.rendered&&this.getFrame()&&this.frameEl.setOverflow((this.autoScroll=scroll)?"auto":"hidden");return this},getContentTarget:function(){return this.getFrame()},getFrame:function(){if(this.rendered){if(this.frameEl){return this.frameEl}var f=this.items&&this.items.first?this.items.first():null;f&&(this.frameEl=f.frameEl);return this.frameEl}return null},getFrameWindow:function(){return this.getFrame()?this.frameEl.getWindow():null},getFrameDocument:function(){return this.getFrame()?this.frameEl.getFrameDocument():null},getFrameDoc:function(){return this.getFrame()?this.frameEl.getDoc():null},getFrameBody:function(){return this.getFrame()?this.frameEl.getBody():null},resetFrame:function(){this.getFrame()&&this.frameEl.reset.apply(this.frameEl,arguments);return this},submitAsTarget:function(submitCfg){this.getFrame()&&this.frameEl.submitAsTarget.apply(this.frameEl,arguments);return this},load:function(loadCfg){if(loadCfg&&this.getFrame()){var args=arguments;this.resetFrame(null,function(){loadCfg.submitAsTarget?this.submitAsTarget.apply(this,args):this.frameEl.load.apply(this.frameEl,args)},this)}this.autoLoad=loadCfg;return this},doAutoLoad:function(){this.autoLoad&&this.load(typeof this.autoLoad=="object"?this.autoLoad:{url:this.autoLoad})},getUpdater:function(){return this.getFrame()?this.frameEl.getUpdater():null},setSrc:function(url,discardUrl,callback,scope){this.getFrame()&&this.frameEl.setSrc.apply(this.frameEl,arguments);return this},setLocation:function(url,discardUrl,callback,scope){this.getFrame()&&this.frameEl.setLocation.apply(this.frameEl,arguments);return this},getState:function(){var URI=this.getFrame()?this.frameEl.getDocumentURI()||null:null;var state=this.supr().getState.call(this);state=Ext.apply(state||{},{defaultSrc:Ext.isFunction(URI)?URI():URI,autoLoad:this.autoLoad});return state},setMIFEvents:function(){this.addEvents("documentloaded","domready","exception","message","blur","focus","scroll","resize","unload","reset")},sendMessage:function(message,tag,origin){},onAdd:function(C){C.relayTarget&&this.suspendEvents(true)},initRef:function(){if(this.ref){var t=this,levels=this.ref.split("/"),l=levels.length,i;for(i=0;i<l;i++){if(t.ownerCt){t=t.ownerCt}}this.refName=levels[--i];t[this.refName]||(t[this.refName]=this);this.refOwner=t}}};Ext.ux.ManagedIFrame.Component=Ext.extend(Ext.BoxComponent,{ctype:"Ext.ux.ManagedIFrame.Component",initComponent:function(){var C={monitorResize:this.monitorResize||(this.monitorResize=!!this.fitToParent),plugins:(this.plugins||[]).concat(this.hideMode==="nosize"&&Ext.ux.plugin.VisibilityMode?[new Ext.ux.plugin.VisibilityMode({hideMode:"nosize",elements:["bwrap"]})]:[])};MIF.Component.superclass.initComponent.call(Ext.apply(this,Ext.apply(this.initialConfig,C)));this.setMIFEvents()},onRender:function(ct,position){var frCfg=this.frameCfg||this.frameConfig||(this.relayTarget?{name:this.relayTarget.id}:{})||{};var frDOM=frCfg.autoCreate||frCfg;frDOM=Ext.apply({tag:"iframe",id:Ext.id()},frDOM);var el=Ext.getDom(this.el);(el&&el.tagName=="iframe")||(this.autoEl=Ext.apply({name:frDOM.id,frameborder:0},frDOM));MIF.Component.superclass.onRender.apply(this,arguments);if(this.unsupportedText){ct.child("noframes")||ct.createChild({tag:"noframes",html:this.unsupportedText||null})}var frame=this.el;var F;if(F=this.frameEl=(this.el?new MIF.Element(this.el.dom,true):null)){(F.ownerCt=(this.relayTarget||this)).frameEl=F;F.addClass("ux-mif");if(this.loadMask){var mEl=this.loadMask.maskEl;F.loadMask=Ext.apply({disabled:false,hideOnReady:false,msgCls:"ext-el-mask-msg x-mask-loading",maskCls:"ext-el-mask"},{maskEl:F.ownerCt[String(mEl)]||F.parent("."+String(mEl))||F.parent(".ux-mif-mask-target")||mEl},Ext.isString(this.loadMask)?{msg:this.loadMask}:this.loadMask);Ext.get(F.loadMask.maskEl)&&Ext.get(F.loadMask.maskEl).addClass("ux-mif-mask-target")}F.disableMessaging=Ext.value(frCfg.disableMessaging,true);F._observable&&(this.relayTarget||this).relayEvents(F._observable,frameEvents.concat(this._msgTagHandlers||[]));delete this.contentEl}},afterRender:function(container){MIF.Component.superclass.afterRender.apply(this,arguments);if(this.fitToParent&&!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1])}this.getEl().setOverflow("hidden");this.setAutoScroll();var F;if(F=this.frameEl){var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on("afterlayout",function(container,layout){Ext.each(["north","south","east","west"],function(region){var reg;if((reg=layout[region])&&reg.split&&reg.split.dd&&!reg._splitTrapped){reg.split.dd.endDrag=reg.split.dd.endDrag.createSequence(MIM.hideShims,MIM);reg.split.on("beforeresize",MIM.showShims,MIM);reg._splitTrapped=MIM._splitTrapped=true}},this)},this,{single:true});ownerCt=ownerCt.ownerCt}if(!!this.ownerCt||this.useShim){this.frameShim=F.createFrameShim()}this.getUpdater().showLoadIndicator=this.showLoadIndicator||false;var resumeEvents=this.relayTarget&&this.ownerCt?this.ownerCt.resumeEvents.createDelegate(this.ownerCt):null;if(this.autoload){this.doAutoLoad()}else{if(this.frameMarkup||this.html){F.update(this.frameMarkup||this.html,true,resumeEvents);delete this.html;delete this.frameMarkup;return}else{if(this.defaultSrc){F.setSrc(this.defaultSrc,false)}else{F.reset(null,resumeEvents);return}}}resumeEvents&&resumeEvents()}},beforeDestroy:function(){var F;if(F=this.getFrame()){F.remove();this.frameEl=this.frameShim=null}this.relayTarget&&(this.relayTarget.frameEl=null);MIF.Component.superclass.beforeDestroy.call(this)}});Ext.override(MIF.Component,MIF.ComponentAdapter.prototype);Ext.reg("mif",MIF.Component);function embed_MIF(config){config||(config={});config.layout="fit";config.items={xtype:"mif",ref:"mifChild",useShim:true,autoScroll:Ext.value(config.autoScroll,this.autoScroll),defaultSrc:Ext.value(config.defaultSrc,this.defaultSrc),frameMarkup:Ext.value(config.html,this.html),loadMask:Ext.value(config.loadMask,this.loadMask),focusOnLoad:Ext.value(config.focusOnLoad,this.focusOnLoad),frameConfig:Ext.value(config.frameConfig||config.frameCfg,this.frameConfig),relayTarget:this};delete config.html;this.setMIFEvents();return config}Ext.ux.ManagedIFrame.Panel=Ext.extend(Ext.Panel,{ctype:"Ext.ux.ManagedIFrame.Panel",bodyCssClass:"ux-mif-mask-target",constructor:function(config){MIF.Panel.superclass.constructor.call(this,embed_MIF.call(this,config))}});Ext.override(MIF.Panel,MIF.ComponentAdapter.prototype);Ext.reg("iframepanel",MIF.Panel);Ext.ux.ManagedIFrame.Portlet=Ext.extend(Ext.ux.ManagedIFrame.Panel,{ctype:"Ext.ux.ManagedIFrame.Portlet",anchor:"100%",frame:true,collapseEl:"bwrap",collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("iframeportlet",MIF.Portlet);Ext.ux.ManagedIFrame.Window=Ext.extend(Ext.Window,{ctype:"Ext.ux.ManagedIFrame.Window",bodyCssClass:"ux-mif-mask-target",constructor:function(config){MIF.Window.superclass.constructor.call(this,embed_MIF.call(this,config))}});Ext.override(MIF.Window,MIF.ComponentAdapter.prototype);Ext.reg("iframewindow",MIF.Window);Ext.ux.ManagedIFrame.Updater=Ext.extend(Ext.Updater,{showLoading:function(){this.showLoadIndicator&&this.el&&this.el.mask(this.indicatorText)},hideLoading:function(){this.showLoadIndicator&&this.el&&this.el.unmask()},updateComplete:function(response){MIF.Updater.superclass.updateComplete.apply(this,arguments);this.hideLoading()},processFailure:function(response){MIF.Updater.superclass.processFailure.apply(this,arguments);this.hideLoading()}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase()};Ext.ux.ManagedIFrame.CSS=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,destroy:function(){return doc=null},createStyleSheet:function(cssText,id){var ss;if(!doc){return}var head=doc.getElementsByTagName("head")[0];var rules=doc.createElement("style");rules.setAttribute("type","text/css");Ext.isString(id)&&rules.setAttribute("id",id);if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText}else{try{rules.appendChild(doc.createTextNode(cssText))}catch(e){rules.cssText=cssText}head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1])}this.cacheStyleSheet(ss);return ss},removeStyleSheet:function(id){if(!doc||!id){return}var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing)}},swapStyleSheet:function(id,url){if(!doc){return}this.removeStyleSheet(id);var ss=doc.createElement("link");ss.setAttribute("rel","stylesheet");ss.setAttribute("type","text/css");Ext.isString(id)&&ss.setAttribute("id",id);ss.setAttribute("href",url);doc.getElementsByTagName("head")[0].appendChild(ss)},refreshCache:function(){return this.getRules(true)},cacheStyleSheet:function(ss,media){this.rules||(this.rules={});try{Ext.each(ss.cssRules||ss.rules||[],function(rule){this.hashRule(rule,ss,media)},this);Ext.each(ss.imports||[],function(sheet){sheet&&this.cacheStyleSheet(sheet,this.resolveMedia([sheet,sheet.parentStyleSheet]))},this)}catch(e){}},hashRule:function(rule,sheet,mediaOverride){var mediaSelector=mediaOverride||this.resolveMedia(rule);if(rule.cssRules||rule.rules){this.cacheStyleSheet(rule,this.resolveMedia([rule,rule.parentRule]))}if(rule.styleSheet){this.cacheStyleSheet(rule.styleSheet,this.resolveMedia([rule,rule.ownerRule,rule.parentStyleSheet]))}rule.selectorText&&Ext.each((mediaSelector||"").split(","),function(media){this.rules[((media?media.trim()+":":"")+rule.selectorText).toLowerCase()]=rule},this)},resolveMedia:function(rule){var media;Ext.each([].concat(rule),function(r){if(r&&r.media&&r.media.length){media=r.media;return false}});return media?(Ext.isIE?String(media):media.mediaText):""},getRules:function(refreshCache){if(!this.rules||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i<len;i++){try{this.cacheStyleSheet(ds[i])}catch(e){}}}}return this.rules},getRule:function(selector,refreshCache,mediaSelector){var rs=this.getRules(refreshCache);if(Ext.type(mediaSelector)=="string"){mediaSelector=mediaSelector.trim()+":"}else{mediaSelector=""}if(!Ext.isArray(selector)){return rs[(mediaSelector+selector).toLowerCase()]}var select;for(var i=0;i<selector.length;i++){select=(mediaSelector+selector[i]).toLowerCase();if(rs[select]){return rs[select]}}return null},updateRule:function(selector,property,value,mediaSelector){Ext.each((mediaSelector||"").split(","),function(mediaSelect){if(!Ext.isArray(selector)){var rule=this.getRule(selector,false,mediaSelect);if(rule){rule.style[property.replace(camelRe,camelFn)]=value;return true}}else{for(var i=0;i<selector.length;i++){if(this.updateRule(selector[i],property,value,mediaSelect)){return true}}}return false},this)}}}};Ext.ux.ManagedIFrame.Manager=function(){var frames={};var implementation={_DOMFrameReadyHandler:function(e){try{var $frame;if($frame=e.target.ownerCt){$frame.loadHandler.call($frame,e)}}catch(rhEx){}},shimCls:"ux-mif-shim",register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.name]={ref:frame};return frame},deRegister:function(frame){delete frames[frame.id];delete frames[frame.name]},hideShims:function(){var mm=MIF.Manager;mm.shimsApplied&&Ext.select("."+mm.shimCls,true).removeClass(mm.shimCls+"-on");mm.shimsApplied=false},showShims:function(){var mm=MIF.Manager;!mm.shimsApplied&&Ext.select("."+mm.shimCls,true).addClass(mm.shimCls+"-on");mm.shimsApplied=true},getFrameById:function(id){return typeof id=="string"?(frames[id]?frames[id].ref||null:null):null},getFrameByName:function(name){return this.getFrameById(name)},getFrameHash:function(frame){return frames[frame.id]||frames[frame.id]||null},_flyweights:{},destroy:function(){if(document.addEventListener&&!Ext.isOpera){window.removeEventListener("DOMFrameContentLoaded",this._DOMFrameReadyHandler,false)}delete this._flyweights}};document.addEventListener&&!Ext.isOpera&&window.addEventListener("DOMFrameContentLoaded",implementation._DOMFrameReadyHandler,false);Ext.EventManager.on(window,"beforeunload",implementation.destroy,implementation);return implementation}();MIM=MIF.Manager;MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;var winDD=Ext.Window.DD;Ext.override(winDD,{startDrag:winDD.prototype.startDrag.createInterceptor(MIM.showShims),endDrag:winDD.prototype.endDrag.createInterceptor(MIM.hideShims)});Ext.ux.ManagedIFramePanel=MIF.Panel;Ext.ux.ManagedIFramePortlet=MIF.Portlet;Ext.ux.ManagedIframe=function(el,opt){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&&el.dom&&el.dom.tagName=="IFRAME"){config=args[1]||{}}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||Ext.getBody(),Ext.apply({tag:"iframe",frameborder:0,cls:"x-mif",src:(Ext.isIE&&Ext.isSecure)?Ext.SSL_SECURE_URL:"about:blank"},config.autoCreate))):null;if(el&&config.unsupportedText){Ext.DomHelper.append(el.dom.parentNode,{tag:"noframes",html:config.unsupportedText})}}var mif=new MIF.Element(el,true);if(mif){Ext.apply(mif,{disableMessaging:Ext.value(config.disableMessaging,true),loadMask:!!config.loadMask?Ext.apply({msg:"Loading..",msgCls:"x-mask-loading",maskEl:null,hideOnReady:false,disabled:false},config.loadMask):false,_windowContext:null,eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,true)});config.listeners&&mif.on(config.listeners);if(!!config.html){mif.update(config.html)}else{!!config.src&&mif.setSrc(config.src)}}return mif};Ext.ux.ManagedIFrame.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message)},name:"Ext.ux.ManagedIFrame"});Ext.apply(Ext.ux.ManagedIFrame.Error.prototype,{lang:{"documentcontext-remove":"An attempt was made to remove an Element from the wrong document context.","execscript-secure-context":"An attempt was made at script execution within a document context with limited access permissions.",printexception:"An Error was encountered attempting the print the frame contents (document access is likely restricted)."}});Ext.onReady(function(){var CSS=new Ext.ux.ManagedIFrame.CSS(document),rules=[];CSS.getRule(".ux-mif-fill")||(rules.push(".ux-mif-fill{height:100%;width:100%;}"));CSS.getRule(".ux-mif-mask-target")||(rules.push(".ux-mif-mask-target{position:relative;zoom:1;}"));CSS.getRule(".ux-mif-el-mask")||(rules.push(".ux-mif-el-mask {z-index: 100;position: absolute;top:0;left:0;-moz-opacity: 0.5;opacity: .50;*filter: alpha(opacity=50);width: 100%;height: 100%;zoom: 1;} ",".ux-mif-el-mask-msg {z-index: 1;position: absolute;top: 0;left: 0;border:1px solid;background:repeat-x 0 -16px;padding:2px;} ",".ux-mif-el-mask-msg div {padding:5px 10px 5px 10px;border:1px solid;cursor:wait;} "));if(!CSS.getRule(".ux-mif-shim")){rules.push(".ux-mif-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}");rules.push(".ux-mif-shim-on{width:100%;height:100%;display:block;zoom:1;}");rules.push(".ext-ie6 .ux-mif-shim{margin-left:5px;margin-top:3px;}")}!!rules.length&&CSS.createStyleSheet(rules.join(" "),"mifCSS")});Ext.provide&&Ext.provide("mif")})();biogps.staticpage_data=new Ext.util.MixedCollection();biogps.staticpage_data.addAll([{title:"About BioGPS",id:"about",content:"/about/?mode=div"},{title:"Terms of Use",id:"terms",content:"/terms/?mode=div"},{title:"Help",id:"help",content:"/help/?mode=div"},{title:"FAQ",id:"faq",content:"/faq/?mode=div"},{title:"Downloads",id:"downloads",content:"/downloads/?mode=div"},{title:"Blog",id:"blog",icon:"/assets/img/blogger_16.gif",url:"http://biogps.blogspot.com/"}]);biogps.showInfoPage=function(a){var d=biogps.staticpage_data.get(a);if(d){var b=Ext.getCmp("center_panel");var c="infotab_"+d.id;var e=b.getItem(c);if(!e){e=b.add({title:d.title,id:c,closable:true,autoScroll:true})}b.setActiveTab(e);e.load({url:d.content,scripts:true})}};biogps.initInfobar=function(){var a=Ext.get("info_bar");for(var c=0;c<biogps.staticpage_data.length;c++){var d=biogps.staticpage_data.get(c);var b=d.title;var b=d.icon?d.title+String.format('&nbsp;<img src="{0}">',d.icon):d.title;if(d.url){var e=a.createChild({tag:"a",id:"infobar_"+d.id,style:"padding-right:20px",href:d.url,target:"_blank",html:b})}else{var e=a.createChild({tag:"a",id:"infobar_"+d.id,style:"padding-right:20px",href:"#goto="+d.id,html:b});e.on("click",function(g,f){g.stopEvent();var h=biogps.staticpage_data.get(f.id.substring("infobar_".length));Ext.History.add("goto="+h.id);_gaq.push(["_trackPageview","/#"+h.id]);_gaq.push(["_trackEvent","BioGPS",h.id])},this)}}var e=a.createChild({tag:"a",style:"padding-right:20px",href:"javascript:void(null);",html:"Email updates"});e.on("click",function(f,g){biogps.subscribeGoogleGroups(f,Ext.get(g))},this)};biogps.subscribeGoogleGroups=function(a,d){if(biogps.subscribepanel){biogps.subscribepanel.destroy();return}biogps.subscribepanel=new Ext.ToolTip({target:d,bodyStyle:"background-color:white; padding: 3px 3px 5px 5px;",html:'<img src="http://groups.google.com/groups/img/3nb/groups_bar.gif" height=26 width=132 alt="Google Groups"><p style="padding-bottom:2px"><a href="http://groups.google.com/group/biogps-announce" target="_blank"><b>biogps-announce</b></a>: (low-volume list for news and announcements)</p><form action="http://groups.google.com/group/biogps-announce/boxsubscribe" target="_blank">&nbsp;&nbsp;&nbsp;&nbsp;Email: <input type=text name=email><button style="font-size: 8pt" type=submit name="sub"> Subscribe</button></form>',mouseOffset:[0,25],showDelay:10000000000,trackMouse:false,autoHide:false,closable:true,draggable:true});biogps.subscribepanel.on("destroy",function(){biogps.subscribepanel=null});biogps.subscribepanel.on("hide",function(){biogps.subscribepanel.destroy()});if(a.getXY){biogps.subscribepanel.targetXY=a.getXY()}else{biogps.subscribepanel.targetXY=[a.pageX,a.pageY]}var c=d.getX();var b=d.getY()-120;biogps.subscribepanel.showAt([c,b])};biogps.UserManager=function(a){Ext.apply(this,a);biogps.UserManager.superclass.constructor.call(this);this.userName=null;this.firstName=null;this.lastName=null;this.name=null;this.can_share=false;this.is_gnf_user=false;this.is_nvs_user=false;this.profile={};this.is_anonymoususer=true;this.authUrl="/auth/login/";this.loginbarEl="login-bar";this.loginEl="login";this.logoutEl="logout";this.logoutUrl="/authx/logout/";this.getuserdataUrl="/authx/getuserdata";this.saveprofileUrl="/authx/saveprofile";this.loginwin=null;this.addEvents({authenticateduser:true});this.addEvents({anonymoususer:true});this.addEvents({login:true});this.addEvents({logout:true})};Ext.extend(biogps.UserManager,Ext.util.Observable,{init:function(){this.on("authenticateduser",function(){biogps.dispatcher()});this.on("anonymoususer",function(){this.setAnonymousUser();biogps.dispatcher()});this.loadSavedUserData()},setAnonymousUser:function(){this.userName=null;this.firstName=null;this.lastName=null;this.name=null;this.can_share=false;this.is_gnf_user=false;this.is_nvs_user=false;this.profile={};this.profile.defaultlayout=biogps.LayoutMgr.defaultlayout_for_anonymoususer;biogps.LayoutMgr.loadAllLayout({layout_id:biogps.alt_defaultlayout});this.is_anonymoususer=true;this.fireEvent("logout")},doLogin:function(){Ext.getCmp("loginform").getForm().submit({url:this.authUrl,method:"POST",success:function(a,b){afterLogin(b.result.data)},failure:function(a,b){Ext.MessageBox.hide();Ext.MessageBox.show({title:"Error",msg:"Network Error! Try again.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});Ext.getBody().dom.innerHTML=b.response.responseText}})},loginSuccess:function(b){this.is_anonymoususer=false;this.userName=b.username;this.firstName=b.firstname;this.lastName=b.lastname;this.name=b.name;this.can_share=b.can_share||false;this.is_gnf_user=b.is_gnf_user||false;this.is_nvs_user=b.is_nvs_user||false;if(isString(b.profile)){this.profile=Ext.util.JSON.decode(b.profile)}else{this.profile=b.profile}biogps.LayoutMgr.loadAllLayout({layout_id:biogps.alt_defaultlayout});var a=String.format('<div>Hello!&nbsp;<a href="/auth/" title="Manage your account in a new window"><span id="login_div_username">{0}</span></a>&nbsp;/&nbsp;<a id="logout" href="javascript:biogps.usrMgr.logout()">Logout</a></div>',this.firstName||this.userName);Ext.get(this.loginbarEl).update(a,false,function(){var c=Ext.get("login_div_username");if(c){var d=100;while(c.getTextWidth()>110&&d>70){d=d-1;c.setStyle({"font-size":d.toString()+"%"})}}});this.fireEvent("login")},loginFail:function(){Ext.MessageBox.show({title:"Error",msg:"Login failed! Please try again.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,fn:function(){var a=Ext.getCmp("loginform").form;a.reset();a.items.get(0).focus()}})},updateUserInfo:function(){},saveUserProfile:function(a){if(a==null){a={}}a.showmsg=(a.showmsg==null)?true:a.showmsg;a.msg=(a.msg==null)?"Your profile was just saved!":a.msg;biogps.callRemoteService({url:this.saveprofileUrl,params:{userprofile:Ext.util.JSON.encode(this.profile)},fn:function(b){var c=b.reader.jsonData;if(c.success){if(a.showmsg){biogps.showmsg("",a.msg)}if(a.callback){a.callback.call(a.scope||this)}}else{biogps.showmsg("","Your profile failed to save!")}},method:"POST",scope:this})},addSharedLayout:function(a){if(!this.profile.sharedlayouts.include(a)){this.profile.sharedlayouts.push(a);this.saveUserProfile({msg:'Your "shared layouts" list was updated!',callback:function(){biogps.LayoutMgr.loadAllLayout({noEventFired:true})},scope:this})}},removeSharedLayout:function(a){if(this.profile.sharedlayouts.include(a)){this.profile.sharedlayouts.remove(a);this.saveUserProfile({msg:'Your "shared layouts" list was updated!',callback:function(){biogps.LayoutMgr.loadAllLayout({noEventFired:true})},scope:this})}},logout:function(){var a=new Ext.data.JsonStore({url:this.logoutUrl,fields:[],autoLoad:true});a.on("load",function(b){this.setAnonymousUser();this.setLoginLink();this.setWelcomeLogout();this.fireEvent("logout")},this);a.on("loadexception",biogps.ajaxfailure2,this)},loadSavedUserData:function(){var b=Ext.get(this.loginbarEl);var a=b.createChild({tag:"div",cls:"loading-indicator",html:"Checking user..."});var c=new Ext.data.JsonStore({url:this.getuserdataUrl,fields:[],autoLoad:true});c.on("load",function(e){a.remove();var d=e.reader.jsonData;if(d.username){this.is_anonymoususer=false;this.loginSuccess(d);this.fireEvent("authenticateduser")}else{this.setLoginLink();this.is_anonymoususer=true;this.fireEvent("anonymoususer")}},this);c.on("loadexception",biogps.ajaxfailure,this)},setLoginLink:function(){this.setLoginLink_newpage()},setLoginLink_newpage:function(){Ext.get(this.loginbarEl).update('<div><a id="login" href="javascript:biogps.usrMgr.gotoLoginPage()">Login here</a>&nbsp;or&nbsp;<a href="/auth/signup">Sign up</a></div>')},gotoLoginPage:function(){var a="/auth/login?next="+encodeURIComponent(window.location.href);window.location=a},setLoginLink_inpage:function(){Ext.get(this.loginbarEl).update('<a id="login" href="javascript:biogps.usrMgr.showLoginWin()"><b>Login here</b></a>&nbsp;or&nbsp;<a href="/auth/signup"><b>Sign up</b></a>')},setWelcomeLogout:function(){Ext.get("welcome-loggedin").update('<h4>Logged Out</h4><p>Your session has ended.<br><br><a href="/auth/login/">Login again</a></p>')},maskForAnonymous:function(a){var d=a.targetEl;var c=a.msg;var b=a.msg2;var e="<b>"+c+"</b>";e+="<br />Either <a href='javascript:biogps.usrMgr.gotoLoginPage()';>login</a> or <a href='/auth/signup'>create a free account</a>.<br />";if(b){e+="<br />"+b}d.mask(e,"maskBox")},showLoginWin:function(b){var a=b||Ext.get(this.loginEl);if(!this.loginwin){this.loginwin=new biogps.LoginWin()}this.loginwin.show(a)},linkWithAuthentication:function(b,a){this.on("login",b,a);this.on("logout",b,a)},unlinkWithAuthentication:function(b,a){this.un("login",b,a);this.un("logout",b,a)}});biogps.usrMgr=new biogps.UserManager();biogps.LoginWin=function(a){Ext.apply(this,a);this.loginform=new Ext.FormPanel({id:"loginform",labelWidth:75,autoHeight:true,bodyStyle:"padding:5px 5px 5px 5px",width:320,border:false,plain:true,items:[{xtype:"fieldset",title:"BioGPS user account",autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Username",id:"loginfield_username",name:"username",width:210,allowBlank:true},{xtype:"textfield",fieldLabel:"Password",id:"loginfield_password",name:"password",width:210,inputType:"password",allowBlank:false},{xtype:"checkbox",boxLabel:"Remember me on this computer.",name:"remember",border:false,labelSeparator:""}]}],buttons:[{text:"Login",id:"login_button",handler:function(){this.doLogin()},scope:this},{text:"Close",handler:function(){this.hide()},scope:this}]});biogps.LoginWin.superclass.constructor.call(this,{title:"User login",layout:"fit",width:360,height:200,autoHeight:true,plain:true,modal:true,stateful:false,closeAction:"hide",listeners:{show:{buffer:10,fn:function(c){this.loginform.form.items.get(0).focus();var b=new Ext.KeyMap(c.items.get(0).getEl(),{key:13,stopEvent:true,fn:function(){this.doLogin()},scope:c})}}},items:[this.loginform]})};Ext.extend(biogps.LoginWin,Ext.Window,{doLogin:function(){if(!this.loginform.form.isValid()){Ext.MessageBox.show({title:"Error",msg:"Wrong input! Correct and try again.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}else{this.body.mask("Authenticating...");this.loginform.form.submit({url:biogps.usrMgr.authUrl,method:"POST",success:function(a,c){this.body.unmask();var b=c.result.data;if(b.name!="Bad Login"){this.hide();biogps.usrMgr.loginSuccess(b)}else{biogps.usrMgr.loginFail()}},failure:function(a,b){this.body.unmask();biogps.formfailure(b,"Network Error! Try again.",function(){a.reset()})},scope:this})}}});biogps.Layout=function(a){this.id="";this.layout_name="";this.author="";this.description="";this.created="";this.lastmodified="";this.layout_data=[];Ext.apply(this,a);biogps.Layout.superclass.constructor.call(this);this.addEvents({beforeload:true,load:true,loadfailed:true,saved:true,savefailed:true,"delete":true,deletefailed:true,pluginadded:true,pluginaddfailed:true});this.layout_modified=false};Ext.extend(biogps.Layout,Ext.util.Observable,{load:function(b,a){b=b||this.id;a=a?1:0;if(b){this.fireEvent("beforeload");biogps.callRemoteService({url:String.format("/layout/{0}/?loadplugin={1}",b,a),fn:function(c){if(c.reader.jsonData.totalCount!=1){this.fireEvent("loadfailed",b)}else{var d=c.reader.jsonData.items[0].fields;d.id=c.reader.jsonData.items[0].pk;if(isString(d.layout_data)){d.layout_data=Ext.util.JSON.decode(d.layout_data)}Ext.apply(this,d);this.fireEvent("load")}},scope:this})}},isMyLayout:function(){return !this.isSharedLayout()},isSharedLayout:function(){return(this.is_shared==true)},isDefault:function(){return(this.layout_id==biogps.usrMgr.profile.defaultlayout)},save:function(){var b={layout_id:this.id,layout_name:this.layout_name,description:this.description,layout_data:Ext.util.JSON.encode(this.layout_data)};var a=new Ext.data.JsonStore({url:"/layout/update/",baseParams:b,method:"POST",fields:[],autoLoad:true});a.on("load",function(){var c=a.reader.jsonData;if(c.success){this.fireEvent("saved",c)}else{this.fireEvent("savefailed",c)}},this);a.on("loadexception",biogps.ajaxfailure,this)},saveas:function(b){var c={layout_name:b||this.layout_name,description:this.description,layout_data:Ext.util.JSON.encode(this.layout_data)};var a=new Ext.data.JsonStore({url:"/layout/add/",baseParams:c,method:"POST",fields:[],autoLoad:true});a.on("load",function(){var d=a.reader.jsonData;if(d.success){this.fireEvent("saved",d)}else{this.fireEvent("savefailed",d)}},this);a.on("loadexception",biogps.ajaxfailure,this)},"delete":function(){var a=new Ext.data.JsonStore({url:"/layout/delete/",baseParams:{layout_id:this.id},method:"POST",fields:[],autoLoad:true});a.on("load",function(b){var c=b.reader.jsonData;if(c.success){this.fireEvent("deleted",this)}else{this.fireEvent("deletefailed",c)}},this);a.on("loadexception",biogps.ajaxfailure,this)},addPlugin:function(a){if(isArray(this.layout_data)){this.layout_data.push({id:a.id})}this.on("saved",function(){this.fireEvent("pluginadded")},this);this.on("savefailed",function(){this.fireEvent("pluginaddfailed")},this);this.save()},quickAddPlugin:function(a){var c=Math.round(Math.random()*225),b=Math.round(Math.random()*400),d={id:a.id,author:a.author,title:a.title,url:a.url,type:a.type,options:a.options,description:a.description,lastmodified:a.lastmodified,top:c,left:b,width:350,height:250};if(isArray(this.layout_data)){this.layout_data.push(d)}this.layout_modified=true;biogps.GeneReportMgr.updateAll()}});biogps.LayoutMgr=function(a){this.currentLayout=null;this.availableLayouts=null;this.currentLayoutLoaded=false;this.availableLayoutsLoaded=false;this.layoutloading=false;this.layoutchanged=false;this.defaultlayout_for_anonymoususer=83;this.addEvents({currentlayoutloaded:true});this.addEvents({currentlayoutloadingfailed:true});this.addEvents({availablelayoutupdated:true});this.addEvents({layoutloaded:true})};Ext.extend(biogps.LayoutMgr,Ext.util.Observable,{loadLayout:function(b){var a=new biogps.Layout({id:b});a.on("load",function(){this.currentLayout=a;this.currentLayoutLoaded=true;this.fireEvent("currentlayoutloaded")},this);a.on("loadfailed",function(c){this.currentLayoutLoaded=true;this.fireEvent("currentlayoutloaded")},this);this.currentLayoutLoaded=false;a.load(b,true)},loadAvailableLayout:function(){var a=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"/layoutlist/all/?userselected=1",method:"GET"}),autoload:true,reader:new Ext.data.JsonReader({id:"pk",root:"items",fields:[{name:"layout_name",mapping:"fields.layout_name",type:"string"},{name:"layout_data",mapping:"fields.layout_data"},{name:"author",mapping:"fields.author",type:"string"},{name:"description",mapping:"fields.description",type:"string"},{name:"is_shared",mapping:"fields.is_shared",type:"boolean"},{name:"lastmodified",mapping:"fields.lastmodified",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"created",mapping:"fields.created",type:"date",dateFormat:"Y-m-d H:i:s"}]})});a.setDefaultSort("layout_name","desc");a.on("load",function(b){var e=[];var d;for(var c=0;c<b.getCount();c++){d=new biogps.Layout(b.getAt(c).data);if(isString(d.layout_data)){d.layout_data=Ext.decode(d.layout_data)}e.push(d);e[c].id=b.getAt(c).id}this.availableLayouts=e;this.availableLayoutsLoaded=true;this.fireEvent("availablelayoutupdated")},this);a.on("loadexception",biogps.ajaxfailure,this);this.availableLayoutsLoaded=false;a.load()},loadAllLayout:function(a){if(a&&a.layout_id){var b=a.layout_id}else{var b=biogps.usrMgr.profile.defaultlayout}this.layoutloading=true;this.on("currentlayoutloaded",function(){if(this.availableLayoutsLoaded){this.layoutchanged=false;this.layoutloading=false;if(!(a&&a.noEventFired)){this.fireEvent("layoutloaded")}}biogps.clearListeners(this,"currentlayoutloaded")},this);this.on("availablelayoutupdated",function(){if(this.currentLayoutLoaded){this.layoutchanged=false;this.layoutloading=false;if(!(a&&a.noEventFired)){this.fireEvent("layoutloaded")}}biogps.clearListeners(this,"availablelayoutupdated")},this);this.loadLayout(b);this.loadAvailableLayout()},reloadAvailableLayout:function(){var a=function(){biogps.GeneReportMgr.markLayoutChanged();this.un("availablelayoutupdated",a)};this.on("availablelayoutupdated",a,this);this.loadAvailableLayout()},createNewLayout:function(){}});biogps.LayoutMgr=new biogps.LayoutMgr();biogps.Gene=function(a){this.id="";Ext.apply(this,a);biogps.Gene.superclass.constructor.call(this);this.addEvents({beforeload:true});this.addEvents({load:true});this.fireEvent("beforeload")};Ext.extend(biogps.Gene,Ext.util.Observable,{load:function(a){biogps.callRemoteService({url:"/service/getgeneidentifiers/?format=json&geneid="+(a||this.id),fn:function(b){Ext.apply(this,b.reader.jsonData);this.fireEvent("load",this)},scope:this})},getEntryGene:function(c){var f=null;if(isArray(c)){f=c}else{if(isString(c)){f=[c]}else{if(this.EntrySpecies){f=[this.EntrySpecies]}else{f=this.SpeciesList}}}var d=null;if(f&&this.EntryGeneID){for(var b=0;b<f.length;b++){var e=this[f[b]];if(isArray(e)){for(var a=0;a<e.length;a++){if((e[a].EntrezGene==this.EntryGeneID)||(e[a].EnsemblGene==this.EntryGeneID)){return e[a]}}}}}}});biogps.loadSampleGene=function(a){var d,e,c,b;d=a.id||1017;e=a.callback||Ext.emptyFn;c=a.scope;b=a.species;if(b&&biogps.SAMPLE_GENE&&biogps.SAMPLE_GENE[b]){d=biogps.SAMPLE_GENE[b]}if(!(biogps.sample_gene&&biogps.sample_gene.id==d)){biogps.sample_gene=new biogps.Gene({id:d});biogps.sample_gene.on("load",e,c);biogps.sample_gene.load()}else{e.call(c)}};biogps.Plugin=function(a){this.id="";this.title="";this.url="";this.author="";this.type="iframe";this.description="";this.options={};this.useroptions=null;this.runtimeoptions=null;this.permission=null;this.lastmodified="";this.tags="";this.usage_percent={};this.left;this.top;this.width;this.height;this.separator="+";Ext.apply(this,a);if(this.options&&isString(this.options)){this.options=Ext.util.JSON.decode(this.options)}if(this.options==""|this.options==null){this.options={}}biogps.Plugin.superclass.constructor.call(this);if(this.useroptions&&this.useroptions.currentSpecies){this.runtimeoptions=this.runtimeoptions||{};this.runtimeoptions.currentSpecies=this.useroptions.currentSpecies}this.addEvents({load:true});this.addEvents({keyworderror:true});this.addEvents({error:true});this.is_secure_cookie_set=function(){var b=document.cookie.split(";").walk(function(c){return c.trim()});return b.indexOf("secure_plugin_client_session="+biogps.get_sessionid())!=-1};this.set_secure_cookie=function(){if(!this.is_secure_cookie_set()){biogps.callRemoteService({url:"/utils/d9d7fd01be668950e3ea61c574e8eca9/",fn:function(){this.fireEvent("secure_cookie_set")},scope:this})}}};Ext.extend(biogps.Plugin,Ext.util.Observable,{load:function(a){biogps.callRemoteService({url:"/plugin/"+(a||this.id)+"/",fn:function(b){var c=b.reader.jsonData;if(c.totalCount==1){this.id=c.items[0].pk;this.title=c.items[0].fields.title;this.url=c.items[0].fields.url;this.author=c.items[0].fields.author;this.type=c.items[0].fields.type;this.description=c.items[0].fields.description;if(isString(c.items[0].fields.options)){if(c.items[0].fields.options!=""){this.options=Ext.util.JSON.decode(c.items[0].fields.options)}}else{this.options=c.items[0].fields.options}this.permission=c.items[0].fields.permission;this.lastmodified=c.items[0].fields.lastmodified;this.created=c.items[0].fields.created;this.tags=c.items[0].fields.tags;this.is_shared=c.items[0].fields.is_shared;this.usage_percent=c.items[0].fields.usage_percent;this.fireEvent("load",this)}},scope:this})},getKeywords:function(a){a=a||this.url;if(a){var b=a.match(/(\{\{[\w|]+\}\})/g);return b}else{return null}},getPreviewUrl:function(){return this.geturl(biogps.sample_gene)},geturl:function(h){var d=null;var f;var g;if(h){var e=this.getKeywords();if(e&&e.length>0){var c=this.getCurrrentSpecies(h,true);if(c){this.current_species=c;var a=h[c][0];d=this.url;if(a){for(var b=0;b<e.length;b++){f=e[b];g=f.substring(2,f.length-2);g.split("|").each(function(i){i=i.trim();if(a[i]){var j=a[i];if(isArray(j)){j=j.join(this.separator)}d=d.replace(f,j)}},this)}}}}}else{throw new Ext.Error("no-sample-gene","plugin.geturl(gene) was called without a value for 'gene'.")}if(this.getKeywords(d)!=null){this.fireEvent("keyworderror");return}else{if(this.options.securityAware==true){this.set_secure_cookie()}}return d},isValidUrl:function(){return(this.validateUrl()==true)},validateUrl:function(){var d=true;var g=null;var b=this.getKeywords();if(b&&Ext.isArray(b)){var f=[];var c,e;biogps.PLUGINKEYWORDS_common.concat(biogps.PLUGINKEYWORDS_other).each(function(h){f.push(h.key.substring(2,h.key.length-2))});f.push("EntrezGeneID");for(var a=0;a<b.length;a++){c=b[a];e=c.substring(2,c.length-2);e.split("|").each(function(h){if(f.indexOf(h.trim())==-1){d=false}g=String.format('Un-recognized keyword: "{0}".',h)})}}if(d){return true}else{return g}},hasPositioning:function(){return(this.top&&this.left&&this.width&&this.height)!=null},getPositioning:function(){return{left:this.left,top:this.top,width:this.width,height:this.height}},isOneSpeciesOnly:function(){return(this.options.allowedSpecies!=null&&this.options.allowedSpecies.length==1)},getAllowedSpecies:function(a){var b=this.options.allowedSpecies?this.options.allowedSpecies:biogps.AVAILABLE_SPECIES;if(b.length>1&&a==true&&this.useroptions&&this.useroptions.speciesOnly&&b.indexOf(this.useroptions.speciesOnly)!=-1){b=[this.useroptions.speciesOnly]}return b},isSpeciesAllowed:function(a){return(this.getAllowedSpecies().indexOf(a)!=-1)},getAvailableSpecies:function(f,a){var b=this.getAllowedSpecies(a);var d=[];var e=f.SpeciesList;if(e){for(var c=0;c<b.length;c++){if(e.indexOf(b[c])!=-1){d.push(b[c])}}}return d},getCurrrentSpecies:function(d,a){var b=this.getAvailableSpecies(d,a);var c=null;if(this.runtimeoptions&&this.runtimeoptions.currentSpecies&&b.indexOf(this.runtimeoptions.currentSpecies)!=-1){c=this.runtimeoptions.currentSpecies}else{if(b.length>0){c=b[0]}}return c},getAllowedSpeciesOnKeyword:function(){var d=null;var b=this.getKeywords();if(b&&Ext.isArray(b)){var c,f;var e=new Ext.util.MixedCollection(false,function(g){return g.key.substring(2,g.key.length-2)});e.addAll(biogps.PLUGINKEYWORDS_common.concat(biogps.PLUGINKEYWORDS_other));for(var a=0;a<b.length;a++){c=b[a];f=c.substring(2,c.length-2);f.split("|").each(function(h){var g=e.get(h);if(g&&Ext.isArray(g.allowedSpecies)){d=g.allowedSpecies}})}}return d},formatPermission:function(){return biogps.formatPermision(this.permission?this.permission.R:null)},render_preview:function(c,b){if(!b){if(this.type=="iframe"){var a=this.geturl(c);if(a){window.open(a,"","scrollbars=yes,menubar=no,height=600,width=800,resizable=yes,toolbar=no,location=no,status=no")}}}else{}},preview:function(a){if(biogps.sample_gene){this.render_preview(biogps.sample_gene,a)}else{biogps.sample_gene=new biogps.Gene({id:1017});biogps.sample_gene.on("load",function(b){this.render_preview(b,a)},this);biogps.sample_gene.load()}},show:function(a){},showFlagAsInappropriateForm:function(a){if(this.id){if(!this.flagformwin){this.flagformwin=new Ext.Window({title:"Flag plugin",layout:"fit",width:380,labelWidth:150,constrain:true,constrainHeader:true,renderTo:a,autoHeight:true,stateful:false,plain:true,ownerCmp:this,listeners:{show:{buffer:0,fn:function(c){c.center();setTimeout(function(){c.items.get(0).items.get(0).focus()},10);var b=new Ext.KeyMap(c.getEl(),[{key:13,stopEvent:true,fn:function(){this.ownerCmp.flagAsInappropriate()},scope:c}])}}},items:[new Ext.FormPanel({id:"newlayoutform",labelWidth:120,autoHeight:true,bodyStyle:"padding:5px 5px 5px 5px",border:false,items:[{xtype:"label",html:"<b>Note:</b>&nbsp;If you believe that the content displayed in this plugin are inappropriate or irrelevant, please enter a brief description below.  Flagged plugins will be reviewed by a moderator. <br/><br/>"},{xtype:"radiogroup",fieldLabel:"Reason:",labelSeparator:"",hidden:false,disabled:false,columns:1,vertical:true,items:[{inputValue:"broken",name:"reason",boxLabel:"Broken plugin",checked:true},{inputValue:"inappropriate",boxLabel:"Inappropriate or offensive content",name:"reason",checked:false}]},{fieldLabel:"Your comments (optional)",xtype:"textarea",anchor:"90%",name:"comment",value:"",allowBlank:true},{xtype:"label",hidden:true,style:"color:red"}],buttons:[{text:"Flag now",handler:this.flagAsInappropriate,scope:this},{text:"Cancel",handler:function(){this.flagformwin.destroy()},scope:this}]})]})}this.flagformwin.on("destroy",function(){this.flagformwin=null},this);this.flagformwin.show();biogps.flagformwin=this.flagformwin}},flagAsInappropriate:function(){if(this.id&&this.flagformwin){var b=this.flagformwin.items.get(0);var a=this.flagformwin.items.get(0).items.get(3);if(b&&a){a.show();a.setText("Submitting...");b.form.submit({url:String.format("/plugin/{0}/flag/",this.id),method:"POST",timeout:60,success:function(c,d){if(d.result&&d.result.success){if(d.result.msg){a.setText(d.result.msg)}else{a.setText("Success.")}b.buttons[0].disable();b.buttons[1].setText("Done!")}},failure:function(c,d){biogps.formfailure(d,"Submitting flag failed!")}})}}},join:function(a){this.store=a}});biogps.renderPluginBrowsePanel=function(a,c){var g="pluginbrowse_panel";var b=biogps.centerTab.getItem(g);var e=false;if(!b){b=biogps.centerTab.add({title:"Plugin Library",id:g,closable:true,layout:"fit",autoScroll:true});var d=function(){if(Ext.get("pluginbrowse_panel")){biogps.renderPluginBrowsePanel(a=true)}};biogps.usrMgr.linkWithAuthentication(d);b.on("destroy",function(){biogps.usrMgr.unlinkWithAuthentication(d);biogps.currentPluginRenderer=null;delete biogps.currentPluginRenderer});e=true}biogps.centerTab.suspendEvents();biogps.centerTab.setActiveTab(b);biogps.centerTab.resumeEvents();if(e||a){var f=new Ext.LoadMask(biogps.centerTab.body,{msg:"Loading Plugin Library...",removeMask:true});f.show();b.load({url:"/plugin/browse",scripts:true,nocache:true,callback:function(j,k,h,i){if(k){if(initLibrary){initLibrary(c)}}else{biogps.ajaxfailure(null,h)}}})}else{biogps.currentLibrary.setActiveItem("library-home","breadcrumb")}};biogps.PluginLibrary=function(a){this.id="";this.currentItem="library-home";this.mask=new Ext.LoadMask("pluginbrowse_panel",{msg:"Loading plugin data..."});this.mask.show();Ext.apply(this,a);biogps.currentLibrary=this;biogps.PluginLibrary.superclass.constructor.call(this)};Ext.extend(biogps.PluginLibrary,Ext.Panel,{setActiveItem:function(p,m){var g=Ext.getCmp("library-add");var d=Ext.getCmp("library-browse");var b=Ext.getCmp("library-plugin");var a=Ext.getCmp("library-header");var j=Ext.getCmp("library-search");var h=Ext.getCmp("library-home");var i=Ext.getCmp("library-edit");var c=Ext.getCmp("btn-library-home");var n=Ext.getCmp("btn-library-browse");var l=Ext.getCmp("btn-library-plugin");var f=Ext.getCmp("btn-library-edit");var e=Ext.getCmp("btn-library-add");h.hide();d.hide();b.hide();i.hide();g.hide();c.removeClass("activeBreadcrumb");n.removeClass("activeBreadcrumb");l.removeClass("activeBreadcrumb");f.removeClass("activeBreadcrumb");e.removeClass("activeBreadcrumb");if(p=="library-home"){a.show();if(m=="delete"){l.hide();f.hide()}}else{a.hide()}if(p=="library-browse"){Ext.getCmp("library-browse-nav").show();n.show();if(m!="breadcrumb"){l.hide();f.hide()}}else{Ext.getCmp("library-browse-nav").hide()}if(p=="library-plugin"){l.show();if(m=="library-home"){n.hide()}if(m!="breadcrumb"){f.hide()}}if(p=="library-edit"){f.show()}if(p=="library-add"||p=="library-edit"){Ext.getCmp("library-search").hide()}else{Ext.getCmp("library-search").show()}if(p=="library-add"&&biogps.usrMgr.is_anonymoususer){g.on("show",function(){biogps.usrMgr.maskForAnonymous({targetEl:g.body,msg:"You must be logged in to add a plugin.",msg2:"Or you can go <a href='javascript:navHandler(\"home\");'>back to the Library</a>."})},this)}Ext.getCmp(p).show();var k="btn-"+p;Ext.getCmp(k).addClass("activeBreadcrumb");this.currentItem=p;this.hash_history();this.setSize();this.ownerCt.doLayout(true);this.libDone();return true},libLoading:function(){this.mask.show()},libDone:function(){this.mask.hide()},hash_history:function(){var a="goto=pluginlibrary&t="+this.currentItem;if((this.currentItem=="library-plugin"||this.currentItem=="library-edit")&&this.plugin){a=a+"&p="+this.plugin.id}else{if(this.currentItem=="library-browse"){var b={sort:biogps.pluginStore.lastOptions.params.sort,start:biogps.pluginStore.lastOptions.params.start,limit:biogps.pluginStore.lastOptions.params.limit,scope:biogps.pluginStore.lastOptions.params.scope,dir:biogps.pluginStore.lastOptions.params.dir};if(biogps.pluginStore.lastOptions.params.search){b.search=biogps.pluginStore.lastOptions.params.search}else{if(biogps.pluginStore.lastOptions.params.tags){b.tags=biogps.pluginStore.lastOptions.params.tags}}a=a+"&"+Ext.urlEncode(b)}}Ext.History.suspendEvents();biogps.centerTab.suspendEvents();Ext.History.add(a,true);biogps.setTitle("pluginlibrary");setTimeout("Ext.History.resumeEvents()",60);biogps.centerTab.resumeEvents()},dispatcher_by_params:function(b){if(b.t){if(b.t=="library-plugin"||b.t=="library-edit"){if(b.p){if(!(this.plugin&&b.p==this.plugin.id)){this.renderPluginById(b.p,"history")}else{this.setActiveItem(b.t,"history")}}}else{if(b.t=="library-browse"){var a={params:{sort:b.sort,start:b.start,limit:b.limit,scope:b.scope,dir:b.dir}};if(b.search){a.params.search=b.search}else{if(b.tags){a.params.tags=b.tags}}biogps.pluginStore.load(a);this.setActiveItem(b.t,"history")}else{this.setActiveItem(b.t,"history")}}}else{this.setActiveItem("library-home","history")}},setBrowseTitle:function(b){var a=b+" &nbsp; &raquo;";Ext.getCmp("btn-library-browse").setText(a);Ext.getCmp("library-browse").setTitle(b)},setPluginTitle:function(b){var a=b;Ext.getCmp("btn-library-plugin").setText(a)},setPluginEditTitle:function(b){var a="&raquo; &nbsp; Edit "+b;Ext.getCmp("btn-library-edit").setText(a)},queryPlugins:function(a){if(a){a.cancelBubble=true}var d=Ext.getCmp("library-search").getForm().getValues();var e=d.query.trim();var c=null;if(e&&e!="Search the Plugin Library"){c="all";var b={params:{search:e,scope:c}};biogps.pluginStore.load(b);this.setActiveItem("library-browse","library-home");_gaq.push(["_trackPageview","/pluginlibrary/search/?query="+e])}return false},browsePluginsBy:function(b,c){if(b){var a={params:{sort:b}};biogps.pluginStore.load(a);this.setActiveItem("library-browse",c);_gaq.push(["_trackPageview","/pluginlibrary/browse/"])}},browsePluginsByTag:function(a,c){if(a){var b={params:{tags:a}};biogps.pluginStore.load(b);this.setActiveItem("library-browse",c);_gaq.push(["_trackPageview","/pluginlibrary/search/?tag="+query])}},sortPluginList:function(c,b){if(c&&b){var a=biogps.pluginStore.lastOptions;a.params.sort=c;a.params.dir=b;biogps.pluginStore.load(a)}},renderPluginById:function(h,g){var f,c,b,d,a,e;a=e=false;if(h){c=function(){a=true;d.call(this)};b=function(i){e=true;biogps.loadSampleGene({species:(i.options&&i.options.allowedSpecies&&Ext.isArray(i.options.allowedSpecies))?i.options.allowedSpecies[0]:null,callback:c,scope:this})};d=function(){if(a&&e){this.plugin=f;markup=this.markupPluginTemplate(f,"large");Ext.getCmp("library-plugin").el.update(markup);if(!biogps.usrMgr.is_anonymoususer){var k=new Ext.Button({text:"&nbsp; Add to my Layout &nbsp;",handler:this.showAddToLayoutMenu,applyTo:"plugin-add-to-layout",scale:"medium",cls:"add-to-layout-btn",scope:this});var i=Ext.get("flag-button");i.on("click",function(){f.showFlagAsInappropriateForm(this.el)},this);i.show();if(!f.is_shared){var m=new Ext.Button({text:"Edit this plugin",handler:this.showPluginEditForm.createDelegate(this,[f]),applyTo:"plugin-add-to-layout",scope:this})}}else{note=Ext.get("plugin-add-to-layout");note.insertHtml("beforeEnd","Login to use this plugin in a layout.");note.addClass("login-note")}if(f.type=="div"){var j=f.getPreviewUrl(),l=false;j=j+"&container=library-plugin-preview";if(j.startsWith("http://")){l=j.startsWith("http://plugins.gnf.org/");j="/utils/proxy?url="+j.replace("&","%26");if(this.plugin.options.securityAware){j+="&secure=1"}}else{l=true}Ext.get("library-plugin-preview").load({url:j,scripts:l})}this.setPluginTitle(f.title);this.setActiveItem("library-plugin",g);_gaq.push(["_trackPageview","/pluginlibrary/plugin/"+f.id])}};this.libLoading();f=new biogps.Plugin({id:h});f.on("load",b,this);f.load()}},markupPluginTemplate:function(f,d){if(f&&d){var c=f.getAllowedSpecies().join(", ");var e="";if(f.tags){var b=new Array();f.tags.split(" ").each(function(g){b.push("<a href=\"javascript:biogps.currentLibrary.browsePluginsByTag('"+g+"','library-plugin')\" title=\"click to view plugins with this tag\">"+g+"</a>")});e=b.join(" | ")}else{e="none"}var a=biogps.pluginTpls[d].apply({url:this.markHighlight(f.url),previewUrl:f.getPreviewUrl(),id:f.id,title:this.markHighlight(f.title),description:this.markHighlight(f.description),author:this.markHighlight(f.author),rolepermission:this.plugin.formatPermission(),lastmodified:f.lastmodified,created:f.created,tags:e,allowedspecies:c,usage:f.usage_percent});return a}},markHighlight:function(c){var d=["red","blue","green","aqua","purple","fuchsia","black","gray","lime","maroon","navy","olive","silver","teal"];if(this.highlight){var a;for(var b=0;b<this.highlight.length;b++){a=d[b%d.length];c=c.replace(new RegExp("("+this.highlight[b].trim()+")","gi"),'<span class="highlight" style="color:'+a+';">$1</span>')}}return c},showPluginEditForm:function(c){if(!c){return false}var b=new biogps.PluginEditPanel({id:"pluginmodify_"+c.id.toString(),modifyonly:true});var a=Ext.getCmp("library-edit");a.items.each(function(d){a.remove(d)});a.add(b);b.on("afterlayout",b.fillPluginForm.createDelegate(b,[c]));a.doLayout();this.setPluginEditTitle(c.title);this.setActiveItem("library-edit","library-plugin");_gaq.push(["_trackPageview","/pluginlibrary/edit/"+c.id])},showAddToLayoutMenu:function(c,a){a.stopEvent();this.layoutmenu=null;if(!this.layoutmenu){this.layoutmenu=new Ext.menu.Menu({items:[{text:"New layout",layout:null,plugindata:this.plugin,group:"selectedlayout",handler:this.onAddToNewLayout,scope:this},"-"]});for(var b=0;b<biogps.LayoutMgr.availableLayouts.length;b++){var d=biogps.LayoutMgr.availableLayouts[b];if(d.isMyLayout()){this.layoutmenu.add({text:d.layout_name,layout:d,group:"selectedlayout",handler:this.onAddToLayout,scope:this})}}}this.layoutmenu.showAt(a.getXY())},onAddToLayout:function(a,b){b.stopEvent();if(this.plugin){if(a.layout&&this.el){a.layout.on("pluginadded",function(){this.el.mask(String.format('This plugin was added to layout "{0}".',a.layout.layout_name));biogps.GeneReportMgr.refreshLayout(a.layout);var c=this.el;setTimeout(function(){c.unmask()},1000);biogps.clearListeners(a.layout,"pluginadded")},this);a.layout.on("pluginaddfailed",function(c){},this);this.el.mask(String.format('Adding this plugin to layout "{0}"...',a.layout.layout_name));a.layout.addPlugin(this.plugin)}}return true},onAddToNewLayout:function(a,b){b.stopEvent();if(this.plugin&&this.el){if(!this.newlayoutwin){this.newlayoutwin=new Ext.Window({title:"Create a new layout",layout:"fit",width:380,labelWidth:200,constrain:true,constrainHeader:true,renderTo:this.el,autoHeight:true,stateful:false,plain:true,ownerCmp:this,listeners:{show:{buffer:0,fn:function(d){d.center();setTimeout(function(){d.items.get(0).items.get(0).focus()},10);var c=new Ext.KeyMap(d.getEl(),[{key:13,stopEvent:true,fn:function(){this.ownerCmp.saveNewLayout()},scope:d}])}}},items:new Ext.FormPanel({id:"newlayoutform",labelWidth:120,autoHeight:true,bodyStyle:"padding:5px 5px 5px 5px",border:false,items:[{xtype:"textfield",anchor:"90%",fieldLabel:"Name your layout",id:this.id+"_field_name",name:"layout_name",allowBlank:false},{fieldLabel:"Description",xtype:"textarea",anchor:"90%",id:this.id+"_field_description",name:"description",value:"",allowBlank:true}],buttons:[{text:"Save",handler:this.saveNewLayout,scope:this},{text:"Cancel",handler:function(){this.newlayoutwin.destroy()},scope:this}]})})}this.newlayoutwin.on("destroy",function(){this.newlayoutwin=null},this);this.newlayoutwin.show()}return true},saveNewLayout:function(){if(this.plugin&&this.newlayoutwin&&this.newlayoutwin.rendered){var b=this.newlayoutwin.items.get(0);if(!(b.form.isValid())){Ext.MessageBox.show({title:"Error",msg:"Missing or wrong input layout name! Correct and try again.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});b.form.reset();b.items.get(0).focus()}else{var a=new biogps.Layout(b.form.getValues());a.layout_data=[{id:this.plugin.id}];a.on("saved",function(){this.newlayoutwin.destroy();this.el.mask(String.format('This plugin was added to layout "{0}".',a.layout_name));biogps.LayoutMgr.loadAvailableLayout();biogps.GeneReportMgr.markLayoutChanged();var c=this.el;setTimeout(function(){c.unmask()},1000);biogps.clearListeners(a,"saved")},this);a.on("savefailed",function(c){this.el.unmask();this.newlayoutwin.center();biogps.formfailure({result:c},"Saving Layout failed! Try again.",function(){if(this.newlayoutwin.rendered){this.newlayoutwin.items.get(0).form.reset();this.newlayoutwin.items.get(0).items.get(0).focus()}},this)},this);this.el.mask(String.format('Saving new layout "{0}"...',a.layout_name));a.saveas()}}}});biogps.pluginJsonStore=function(a){Ext.data.JsonStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(!a.data?new Ext.data.HttpProxy({url:a.url,method:a.method}):undefined),reader:new biogps.pluginJsonReader(a,a.fields)}))};Ext.extend(biogps.pluginJsonStore,Ext.data.Store);biogps.pluginJsonReader=function(a,b){a=a||{};biogps.pluginJsonReader.superclass.constructor.call(this,a,b||a.fields)};Ext.extend(biogps.pluginJsonReader,Ext.data.JsonReader,{readRecords:function(q){this.jsonData=q;if(q.metaData){delete this.ef;this.meta=q.metaData;this.recordType=Ext.data.Record.create(q.metaData.fields);this.onMetaChange(this.meta,this.recordType,q)}var l=this.meta,a=this.recordType,y=a.prototype.fields,j=y.items,h=y.length;if(!this.ef){if(l.totalProperty){this.getTotal=this.getJsonAccessor(l.totalProperty)}if(l.successProperty){this.getSuccess=this.getJsonAccessor(l.successProperty)}this.getRoot=l.root?this.getJsonAccessor(l.root):function(c){return c};if(l.id){var x=this.getJsonAccessor(l.id);this.getId=function(f){var c=x(f);return(c===undefined||c==="")?null:c}}else{this.getId=function(){return null}}this.ef=[];for(var u=0;u<h;u++){y=j[u];var A=(y.mapping!==undefined&&y.mapping!==null)?y.mapping:y.name;this.ef[u]=this.getJsonAccessor(A)}}var t=this.getRoot(q),z=t.length,m=z,e=true;if(l.totalProperty){var k=parseInt(this.getTotal(q),10);if(!isNaN(k)){m=k}}if(l.successProperty){var k=this.getSuccess(q);if(k===false||k==="false"){e=false}}var w=[];for(var u=0;u<z;u++){var r=t[u];var b={};var p=this.getId(r);var d=new biogps.Plugin(r.fields);d.id=r.pk;d.json=r;d.data=r.fields;d.data.id=r.pk;w[u]=d}return{success:e,records:w,totalRecords:m}}});biogps.PluginEditPanel=function(a){this.pluginbox=null;Ext.apply(this,a);biogps.PluginEditPanel.superclass.constructor.call(this,{id:this.id+"_form",title:this.modifyonly?"Edit your own plugin":"Create your own plugin",cls:"centerMargins",labelWidth:110,stateful:false,defaultType:"textfield",width:"90%",autoHeight:true,border:false,trackResetOnLoad:this.modifyonly,items:[{xtype:"fieldset",cls:"roundBoxBlue",autoHeight:true,defaults:{anchor:"90%"},defaultType:"textfield",items:[{fieldLabel:"Title*",id:this.id+"_field_title",name:"title",maxLength:100,allowBlank:false},{fieldLabel:"URL template*",id:this.id+"_field_url",name:"url",maxLength:500,value:"",allowBlank:false,validator:this.validateURLTemplate,listeners:{render:this.addURLHelp,blur:function(b){this.toggleSpeciesBasedOnKeyword(b.getValue());return false},scope:this}},{xtype:"box",autoEl:{tag:"div",cls:"details",html:'<h5>Template Syntax Explained</h5>                     <p>You need to supply the URL to the website you want to add                     as a plugin, including one (or more) keywords. When you then                     use your plugin in a layout, the appropriate identifier for                     your gene of interest will be substituted in.</p><br />                     <p>For example, to make a simple Google search plugin, you would                     type in the URL below, then click                     the "Add Keyword" button and select whichever identifier you want.<br />                     <b>http://www.google.com/search?q=</b></p><br />                     <p>Once you have picked an identifier, the URL template                     will then look like this:<br />                     <b>http://www.google.com/search?q={{Symbol}}</b></p><br />                     <p>When the plugin is then used in a layout to look at a gene,                     BioGPS will automatically insert the correct value. For                     example, if you used the UniGene ID keyword and the user                     is looking at CDK2, the actual URL that will load would be                     this:<br />                     <b>http://www.google.com/search?q=Hs.19192</b></p><br />                     <p>If you want to test your URL template before saving, just hit                     the "Preview" button at the bottom of this page.                     </p>'}}]},{xtype:"fieldset",cls:"roundBox",autoHeight:true,defaults:{anchor:"90%"},defaultType:"textfield",items:[{fieldLabel:"Description",xtype:"textarea",id:this.id+"_field_description",name:"description",autoHeight:false,height:75,value:"",grow:false,allowBlank:true},{fieldLabel:"Tags (categories)",id:this.id+"_field_tags",name:"tags",allowBlank:true},{xtype:"box",autoEl:{tag:"div",cls:"details",html:'Enter words to help categorize your plugin. Separate them with a single space.<br />                     Example: "<b>exon structure gene</b>" will make your plugin                     show up in each of those three categories.'}},{xtype:"checkboxgroup",name:"allowedspeciesGroup",fieldLabel:"Species allowed:",labelSeparator:"",listeners:{change:function(b){this.hideSpeciesMsgTip()},scope:this},columns:biogps.AVAILABLE_SPECIES.walk(function(b){return 80}),items:biogps.AVAILABLE_SPECIES.walk(function(b){return{name:"allowedspecies",inputValue:b,boxLabel:b.capitalize(),checked:true}})},{xtype:"radiogroup",name:"rolepermission",fieldLabel:"Visible to:",labelSeparator:"",hidden:false,disabled:false,columns:biogps.usrMgr.is_gnf_user?[100,100,100]:[100,0,100],height:30,listeners:{render:function(b){if(!biogps.usrMgr.can_share&&!biogps.usrMgr.is_anonymoususer){biogps.whydisabled(b,'You need to provide us your full name and affiliation information before you can share your plugin with others. Click <a href="/auth/account/edit" target="_blank">here</a> to edit your account information.')}}},items:[{inputValue:"biogpsusers",name:"rolepermission",boxLabel:"Everyone",checked:biogps.usrMgr.can_share},{inputValue:"gnfusers",hidden:!biogps.usrMgr.is_gnf_user,disabled:!biogps.usrMgr.is_gnf_user,name:"rolepermission",boxLabel:"GNF Only"},{inputValue:"myself",boxLabel:"Myself Only",name:"rolepermission",checked:!biogps.usrMgr.can_share}]}]}],buttons:[{text:this.modifyonly?"Save Edits":"Save New",handler:this.doSavePlugin,style:"font-weight: bold",scope:this},{text:"Cancel",handler:this.cancelEdit,hidden:!this.modifyonly,scope:this},{text:"Preview",handler:this.previewPlugin,scope:this},{text:"Clear",handler:this.doClearForm,hidden:this.modifyonly,scope:this},{text:"Delete",hidden:!this.modifyonly,handler:this.deletePlugin,scope:this}]});this.on("afterlayout",function(){this.addScreencastLink()},this)};Ext.extend(biogps.PluginEditPanel,Ext.FormPanel,{addURLHelp:function(b){if(!this.urlhelp){var d=b.container;var a=d.createChild({tag:"div",cls:"keyword-btn"});this.keywordmenu=new Ext.menu.Menu({cls:"no-icon-menu"});this.keywordmenu.add('<b class="menu-title">Available keywords:</b>');for(var c=0;c<biogps.PLUGINKEYWORDS_common.length;c++){this.keywordmenu.add({text:biogps.PLUGINKEYWORDS_common[c].text,keyword:biogps.PLUGINKEYWORDS_common[c].key,handler:this.appendKeyword,scope:this})}this.subkeywordmenu=new Ext.menu.Menu({cls:"no-icon-menu"});for(var c=0;c<biogps.PLUGINKEYWORDS_other.length;c++){this.subkeywordmenu.add({text:biogps.PLUGINKEYWORDS_other[c].text,keyword:biogps.PLUGINKEYWORDS_other[c].key,handler:this.appendKeyword,scope:this})}this.keywordmenu.add("-");this.keywordmenu.add({text:"more keywords",menu:this.subkeywordmenu,handler:function(){return false}});this.urlhelp=new Ext.Toolbar.Button({renderTo:a,iconCls:"icon-help",text:"Add Keyword",handler:function(){this.showMenu()},menu:this.keywordmenu})}},addScreencastLink:function(){if(!this.screencast){var a='<a class="roundButton right" href="http://plugins.gnf.org/screencasts/plugin_registration/">Watch the Screencast</a>';this.screencast=this.header.insertHtml("afterBegin",a,true)}},appendKeyword:function(c,b){if(c.keyword){var a=this.form.getValues().url+c.keyword;this.form.setValues({url:a});this.toggleSpeciesBasedOnKeyword(a)}},validateURLTemplate:function(b){var c=b.trim();var d=new biogps.Plugin();d.url=c;var a=d.validateUrl();return a},toggleSpeciesBasedOnKeyword:function(a){var c=a.trim();var e=new biogps.Plugin();e.url=c;var d=e.getAllowedSpeciesOnKeyword();if(Ext.isArray(d)){var b=this.form.findField("allowedspeciesGroup").getRawValue();if(!b.sort().equals(d.sort())){this.setSpeciesGroup(d);this.showSpeciesMsgTip('<img style="vertical-align:text-top;" src="/assets/img/information.png" />&nbsp;"Allowed species" has been changed based on the keyword used in URL template.');return true}}this.hideSpeciesMsgTip();return false},showSpeciesMsgTip:function(a){var c=this.form.findField("allowedspeciesGroup");var b=c.items.get(c.items.length-1).getEl().parent();if(!this.species_msgtip){this.species_msgtip=new Ext.ToolTip({anchor:"left",anchorOffset:0,renderTo:c.getEl(),html:a,maxWidth:230,anchorToTarget:true,dismissDelay:0,autoHide:false});this.species_msgtip.showAt(this.species_msgtip.el.getAlignToXY(b,"l-tr",[20,-5]))}else{if(this.species_msgtip.hidden){this.species_msgtip.show()}this.species_msgtip.body.update(a);this.species_msgtip.doAutoWidth()}},hideSpeciesMsgTip:function(){if(this.species_msgtip){this.species_msgtip.hide();delete this.species_msgtip}},cancelEdit:function(b,a){if(this.modifyonly&&this.form.isDirty()){Ext.MessageBox.confirm("Confirm","Cancel modification? Unsaved changes will be discarded.",function(c){if(c=="yes"){biogps.currentLibrary.setActiveItem("library-plugin","library-edit");_gaq.push(["_trackPageview","/pluginlibrary/edit/cancel/"])}},this)}else{biogps.currentLibrary.setActiveItem("library-plugin","library-edit")}},previewPlugin:function(){var a=new biogps.Plugin(this.form.getValues());if(a.allowedspecies){if(isArray(a.allowedspecies)){a.options.allowedSpecies=a.allowedspecies}else{a.options.allowedSpecies=[a.allowedspecies]}}biogps.loadSampleGene({species:a.options.allowedSpecies.length>0?a.options.allowedSpecies[0]:null,callback:function(){if(!a.geturl(biogps.sample_gene)){Ext.MessageBox.show({title:"Error",msg:"Can not interpret the URL template. Please make sure the substitutable keyword is correct.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}else{a.render_preview(biogps.sample_gene,Ext.get("pluginboxcontainer"))}},scope:this})},doSavePlugin:function(){if(this.modifyonly){Ext.MessageBox.confirm("Confirm",String.format('Update plugin "{0}"?',this.form.getValues().title),function(a){if(a=="yes"){this.submitPluginForm()}},this)}else{this.submitPluginForm()}},handleDupPluginAtSave:function(d){if(d&&d.length>0){var c,b;var a="<p><br />";d.each(function(e){a+='<a href="#goto=pluginlibrary&t=library-plugin&p='+e.id.toString()+'" onclick="javascript:Ext.Msg.hide();">'+e.text+"</a><br />"});a+="</p>";if(d.length==1){c="Duplicated plugin found";b="We detected that there is an existing plugin with exactly the same URL template as you provided. You can click the link below to view this existing plugin: "+a+'<p><br />Click "Yes" to save it anyway, or "No" to cancel the saving.</p>'}else{c="Duplicated plugins found";b="We detected that there are "+d.length.toString()+" existing plugins with exactly the same URL template as you provided. You can click the links below to view the existing plugins: "+a+'<p><br />Click "Yes" to save it anyway, or "No" to cancel the saving.</p>'}Ext.Msg.confirm(c,b,function(e){if(e=="yes"){this.submitPluginForm({allowdup:true})}},this)}},submitPluginForm:function(a){var d=this.form;if(!d.isValid()){Ext.MessageBox.show({title:"Error",msg:"Wrong input! Correct and try again.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});d.reset()}else{if(this.modifyonly&&!this.current_pluginid){Ext.MessageBox.show({title:"Error",msg:"Missing plugin id for updating this plugin! Reload this plugin and try again.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}else{var e=new biogps.Plugin(d.getValues());var c=e.validateUrl();if(c==true){this.toggleSpeciesBasedOnKeyword(e.url);d.getEl().mask(this.modifyonly?"Save your modification...":"Submit your new plugin...");var b={};if(this.modifyonly){Ext.apply(b,{plugin_id:this.current_pluginid})}if(a&&a.allowdup){Ext.apply(b,{allowdup:"1"})}d.submit({url:this.modifyonly?"/plugin/update/":"/plugin/add/",method:"POST",params:b,success:function(h,i){h.getEl().unmask();h.getEl().mask(this.modifyonly?"Your plugin was updated!":"Your plugin was saved!");_gaq.push(["_trackPageview","/pluginlibrary/edit/save/"]);setTimeout(function(){h.getEl().unmask()},1000);if(!this.modifyonly&&!this.current_pluginid){this.current_pluginid=i.result.plugin_id;h.reset()}var g=this.modifyonly?"library-edit":"library-add";biogps.currentLibrary.renderPluginById(this.current_pluginid,g)},failure:function(g,h){g.getEl().unmask();if(h.result.dup_plugins){this.handleDupPluginAtSave(h.result.dup_plugins)}else{biogps.formfailure(h,this.modifyonly?'"updatePlugin" service failed!':'"addPlugin" service failed!')}},scope:this})}else{var f="Invalid URL template. ";if(Ext.isString(c)){f+=c}else{f+="Please make sure the substitutable keyword is correct."}Ext.MessageBox.show({title:"Error",msg:f,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}}}},doClearForm:function(){if(this.modifyonly){Ext.MessageBox.confirm("Confirm",String.format('Clear all values for plugin "{0}"?',this.form.getValues().title),function(a){if(a=="yes"){this.form.reset()}},this)}else{this.form.reset()}},setSpeciesGroup:function(c){var b=this.form.findField("allowedspeciesGroup");var a=[];b.eachItem(function(d){a.push(c.indexOf(d.inputValue)!=-1)});b.setValue(a)},fillPluginForm:function(c){var b=this.form;b.setValues({url:c.url,title:c.title,description:c.description,tags:c.tags,rolepermission:c.formatPermission()});var a=c.getAllowedSpecies();this.setSpeciesGroup(a);this.current_pluginid=c.id},deletePlugin:function(){if(!this.modifyonly){return false}var c=this.current_pluginid;var b=this.form.getValues().title;biogps.callRemoteService({url:"/plugin/"+c+"/usage/",scope:this,fn:function(e){var d=e.reader.jsonData;var f=String.format('Are you SURE you want to delete the "{0}" plugin?<br />This action CANNOT be undone!',b);if(d[0]>0||d[1]>0){f+=String.format("<br /><br />Usage info: this plugin is currently used in [<b>{0}</b>] of your own layouts and [<b>{1}</b>] of others'.",d[0],d[1])}else{f+="<br /><br />Usage info: this plugin is currently not used in any layout."}Ext.MessageBox.confirm("Confirm",f,function(g){if(g=="yes"){a(this)}},this)}});function a(e){var d=new Ext.data.JsonStore({url:"/plugin/delete/",baseParams:{plugin_id:c},method:"POST",fields:[],autoLoad:true});e.body.mask(String.format('Delete plugin "{0}"...',b));d.on("load",function(f){var g=f.reader.jsonData;if(g.success){e.body.unmask();e.body.mask("You plugin was deleted!");_gaq.push(["_trackPageview","/pluginlibrary/edit/delete/"]);setTimeout(function(){e.body.unmask();biogps.currentLibrary.setActiveItem("library-home","delete")},1500)}else{e.body.unmask();Ext.MessageBox.show({title:"Error",msg:g.error?g.error:"",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}},e);d.on("loadexception",biogps.ajaxfailure,e)}}});function initLibrary(e){var d=Ext.getCmp("pluginbrowse_panel");biogps.pluginStore=new biogps.pluginJsonStore({url:"/plugin/",method:"GET",root:"items",totalProperty:"totalCount",id:"pk",fields:[],listeners:{beforeload:{scope:this,fn:function(j,i){biogps.currentLibrary.body.mask("Loading...");biogps.currentLibrary.setBrowseTitle("Loading");if(!i.params.start){i.params.start=0}if(!i.params.limit){i.params.limit=50}if(!i.params.scope){i.params.scope="all"}if(!i.params.dir){i.params.dir="DESC"}if(!i.params.sort){i.params.sort="popularity"}}},load:{scope:this,fn:function(j){biogps.currentLibrary.body.unmask();if(j.getTotalCount()===1){var i=j.getAt(0);biogps.currentLibrary.renderPluginById(i.id,"library-home")}else{var l=j.lastOptions.params;var k="";if(l.tags){k="plugins tagged with '"+l.tags+"'"}else{if(l.search){k="results for '"+l.search+"'"}else{k="Plugins"}}if(l.sort=="created"){k="Newest "+k}else{if(l.sort=="lastmodified"){k="Recently Updated "+k}else{if(l.sort=="popularity"){k="Most Popular "+k}else{if(l.sort=="title"){k="Alphabetical "+k}else{if(l.sort=="author"){k="By Author "+k}}}}}biogps.currentLibrary.setBrowseTitle(k);Ext.getCmp("library-browse-sort").setValue(l.sort);biogps.currentLibrary.hash_history()}}}}});biogps.pluginTpls=new Array();var h=new Ext.XTemplate('<tpl for=".">','<a class="pluginbox {[("permission" in values) ? this.isGNF(values.permission) : "myself"]}','" href="javascript:biogps.currentLibrary.renderPluginById({id},\'library-browse\')">','<span class="name">{title}</span><br />','<span class="url">{[shortUrl(values.url)]}</span>',"</a></tpl>",{isGNF:function(i){return(i.R[0]==="GNF Users")?"gnfusers":""}});biogps.pluginTpls.small=h.compile();var c=new Ext.XTemplate('<tpl for=".">','<a class="roundBoxBlue pluginbox-medium {[("permission" in values) ? this.isGNF(values.permission) : "myself"]}','" href="javascript:biogps.currentLibrary.renderPluginById({id},\'library-browse\')">','<span class="author">Registered by {author}</span>','<span class="name">{title}</span><br />','<tpl if="1 <= values.usage_percent.layouts">','<span class="usage">Layout Popularity: {values.usage_percent.layouts:round(0)}</span>',"</tpl>",'<p class="description">{description}</p>','<p class="url">{[colorShortUrl(values.url)]}</p>',"</a></tpl>",{isGNF:function(i){return(i.R[0]==="GNF Users")?"gnfusers":""}});biogps.pluginTpls.medium=c.compile();var g=new Ext.XTemplate('<div class="roundBoxBlue basics {rolepermission}">','<div class="preview">','<div id="library-plugin-preview">','<iframe src="{previewUrl}"></iframe>',"</div>","<p>Preview of CDK2 gene data</p>","</div>","<h1>{title}</h1>",'<p class="author">Registered by {author}</p>','<tpl if="1 <= values.usage.layouts">','<p class="attribute"><span class="attribute-name">Layout Popularity:</span>'," {values.usage.layouts:round(0)}</p>","</tpl>",'<p class="attribute"><span class="attribute-name">Tags (keywords):</span> '," {tags}</p>",'<p class="attribute"><span class="attribute-name">Species:</span> '," {allowedspecies}</p>",'<p class="url attribute">{[colorShortUrl(values.url)]}</p>','<div><div id="plugin-add-to-layout"></div></div>','<tpl if="this.isMine(rolepermission)">','<div class="permission"><img src="/assets/img/label_personal.gif" title="This plugin is not visible to anyone but you." /></div>',"</tpl>",'<tpl if="this.isGNF(rolepermission)">','<div class="permission"><img src="/assets/img/gnf_only_icon.gif" title="Only GNF / Novartis users can use this plugin." /></div>',"</tpl>",'<div class="clear"></div>',"</div>",'<div class="roundBox details">',"<h4>Long Description</h4>",'<p class="description">{description}</p>','<p class="timestamp">Updated {lastmodified}<br />Created {created}</p>','<div class="clear"></div>',"</div>",'<div class="details noBorder">','<a id="flag-button" class="roundButton" style="visibility: hidden;">','<img src="/assets/img/flag_red.png"/>',"Flag as Broken or Inappropriate","</a>","</div>",{isMine:function(i){return i=="myself"},isGNF:function(i){return i=="gnfusers"}});biogps.pluginTpls.large=g.compile();var b=new biogps.PluginLibrary({id:"pluginlibrary_card",layout:"anchor",autoScroll:true,bodyStyle:"padding:5px",border:false,defaults:{border:false},tbar:[{id:"btn-library-home",text:"Library &nbsp; &raquo;",cls:"activeBreadcrumb",handler:navHandler.createDelegate(this,["home"])},{id:"btn-library-browse",text:"Browse &raquo;",handler:navHandler.createDelegate(this,["browse"]),hidden:true},{id:"btn-library-plugin",text:"Plugin",handler:navHandler.createDelegate(this,["plugin"]),hidden:true},{id:"btn-library-edit",text:"Edit Plugin",handler:navHandler.createDelegate(this,["edit"]),hidden:true},"->",{id:"btn-library-add",text:"Add a Plugin",handler:navHandler.createDelegate(this,["add"])}],items:[{id:"library-header",contentEl:"pluginheader"},{id:"library-search",xtype:"form",baseCls:"x-window",cls:"x-window-plain x-window-dlg",frame:true,title:"   ",onSubmit:Ext.emptyFn,keys:{key:13,stopEvent:true,fn:function(){biogps.currentLibrary.queryPlugins()}},items:[{xtype:"panel",layout:"column",border:false,items:[{xtype:"textfield",name:"query",cls:"search_field",id:"plugin_query",emptyText:"Search the Plugin Library",columnWidth:1},{xtype:"panel",border:false,width:75,items:[{xtype:"button",type:"submit",text:"SEARCH",cls:"right",handler:function(){biogps.currentLibrary.queryPlugins()}}]}]},{id:"library-search-advanced",xtype:"panel",title:"Advanced",collapsed:true,collapsible:true,titleCollapse:true,hideCollapseTool:true,baseCls:"form-group",items:[{xtype:"checkbox",id:"scope_my",boxLabel:"My Plugins",checked:true},{xtype:"checkbox",id:"scope_shared",boxLabel:"Shared Plugins",checked:true}]}]},{id:"library-add",hidden:true,height:650,items:new biogps.PluginEditPanel({id:"pluginadd",pluginbox:this,modifyonly:false})},{id:"library-home",contentEl:"pluginhome"},{id:"library-browse",title:"Browse",hidden:true,items:new Ext.DataView({tpl:biogps.pluginTpls.medium,store:biogps.pluginStore,itemSelector:"div.plugindetails"})},{id:"library-plugin",contentEl:"pluginpage",hidden:true},{id:"library-edit",hidden:true,items:[{html:""}]}],bbar:new Ext.PagingToolbar({id:"library-browse-nav",store:biogps.pluginStore,autoHeight:true,pageSize:50,displayInfo:true,displayMsg:"Plugins {0} - {1} of {2}",emptyMsg:"No plugins to display",hidden:true})});d.add(b);d.doLayout();biogps.centerTab.body.unmask();var f=new Ext.data.SimpleStore({fields:["sortby","direction","sortbyName"],data:[["popularity","DESC","Most Popular"],["created","DESC","Newest first"],["lastmodified","DESC","Recently Updated"],["title","ASC","Plugin Name"],["author","ASC","Author"]]});var a=new Ext.form.ComboBox({id:"library-browse-sort",store:f,valueField:"sortby",displayField:"sortbyName",mode:"local",editable:false,triggerAction:"all",width:125,listWidth:125,listeners:{select:function(k,j,i){biogps.currentLibrary.sortPluginList(j.data.sortby,j.data.direction)}}});Ext.getCmp("library-browse-nav").add(a);Ext.getCmp("library-search-advanced").hide();if(e){biogps.currentLibrary.dispatcher_by_params(e)}else{biogps.currentLibrary.hash_history();biogps.currentLibrary.mask.hide();_gaq.push(["_trackPageview","/pluginlibrary/"])}}var navHandler=function(b){var a="library-"+b;biogps.currentLibrary.setActiveItem(a,"breadcrumb")};var shortUrl=function(a){var b=a.replace(/.*\:\/\//,"").replace(/\/.*/,"");if(b==""){b="biogps.gnf.org"}return b};var colorShortUrl=function(a){var c=a.split("://");if(c.length==1){c[1]="biogps.gnf.org"+c[0];c[0]="http"}var b=c[1].split("/");b[0]=b[0]+"</span>";return c[0]+'://<span class="domain">'+b.join("/")};function disableEnterKey(b){var a;if(window.event){a=window.event.keyCode}else{a=b.which}if(a==13){return false}else{return true}}biogps.PluginQuickAdd=function(a){this.grp=null;Ext.apply(this,a);this.pluginStore=new biogps.pluginJsonStore({url:"/plugin/",method:"GET",root:"items",totalProperty:"totalCount",id:"pk",fields:[],listeners:{beforeload:{scope:this,fn:function(c,b){if(!b.params.scope){b.params.scope="all"}if(!b.params.dir){b.params.dir="DESC"}if(!b.params.sort){b.params.sort="popularity"}}}}});this.pluginTpl=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item pluginbox-quick {[("permission" in values) ? this.isGNF(values.permission) : "myself"]}>','<span class="name">{title}</span><br />','<tpl if="1 <= values.usage_percent.layouts">','<span class="usage">Layout Popularity: {values.usage_percent.layouts:round(0)}</span>',"</tpl>",'<span class="detailLink"><a href="#goto=pluginlibrary&t=library-plugin&p={id}" onclick="biogps.GeneReportMgr.collapseQuickLists();event.cancelBubble=true;">Details</a></span>','<p class="url">{[shortUrl(values.url)]}</p>',"</div></tpl>",{isGNF:function(b){return(b.R[0]==="GNF Users")?"gnfusers":""}});biogps.PluginQuickAdd.superclass.constructor.call(this,{emptyText:"Add a Plugin",loadingText:"Searching...",store:this.pluginStore,tpl:this.pluginTpl,pageSize:5,minChars:0,lazyInit:false,displayField:"title",queryParam:"search",listAlign:"tr-br?",listWidth:250,width:100,onSelect:function(b){this.collapse();this.grp.grlayout.quickAddPlugin(b)}})};Ext.extend(biogps.PluginQuickAdd,Ext.form.ComboBox,{});biogps.renderMyStuffPanel=function(a){var c=Ext.getCmp("center_panel");var f="mystuff_panel";var b=c.getItem(f);var e=false;if(!b){b=c.add({title:"My Stuff",id:f,closable:true,layout:"fit",autoScroll:true});var d=function(){if(Ext.get(f)){biogps.renderMyStuffPanel(a=true)}};biogps.usrMgr.linkWithAuthentication(d);b.on("destroy",function(){biogps.usrMgr.unlinkWithAuthentication(d)});e=true}c.setActiveTab(b);if(e||a){b.load({url:"/mystuff/",scripts:true,nocache:true,callback:function(i,j,g,h){if(j){if(onPanelLoad){onPanelLoad()}}else{biogps.ajaxfailure(null,g)}}})}};biogps.renderSearchForm=function(e){var c=Ext.get(e);c.createChild({tag:"h2",html:"Search genes by:"});var a=new Ext.data.SimpleStore({fields:["unit","factor"],data:[["bp",1],["Kb",1000],["Mb",1000000]]});biogps.searchform=new Ext.FormPanel({id:"searchform",border:false,width:475,labelWidth:120,style:"padding:15px 0 5px 15px",items:[{xtype:"tabpanel",id:"searchformtab",activeTab:0,plain:true,border:true,deferredRender:false,defaults:{autoHeight:true,bodyStyle:"padding:10px",border:Ext.isIE6?true:false},listeners:{tabchange:{fn:b,scope:this},render:function(g){var f=new Ext.KeyMap(g.getEl(),{key:13,ctrl:true,stopEvent:true,fn:function(){biogps.doSearch()},scope:this})}},items:[{title:"Annotation",layout:"form",id:"searchbyanno",defaultType:"textfield",items:[{xtype:"radio",boxLabel:"Symbol Or Accession",checked:true,name:"qtype",inputValue:"symbolanno",fieldLabel:"Type"},{xtype:"radio",boxLabel:"Keyword",name:"qtype",inputValue:"keyword",labelSeparator:""},{xtype:"textarea",height:187,width:300,fieldLabel:"Query",name:"query",style:"overflow:auto",id:"query",value:""},{xtype:"label",html:"Try some sample queries? Click these links: <p><div style=\"padding-left: 125px\"><table style=\"font-size: 0.8em\"><tr><td><a tabindex=1000 href=\"javascript:biogps.setSampleQuery({qtype:'symbolanno', query:'CDK2\\nCDK3'});\">Gene Symbol(s)</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><a  tabindex=1001 href=\"javascript:biogps.setSampleQuery({qtype:'keyword', query:'BTK'});\">Keyword queries</a></td></tr><tr><td><a  tabindex=1002 href=\"javascript:biogps.setSampleQuery({qtype:'symbolanno', query:'CDK?'});\">Wildcard queries</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><a  tabindex=1003 href=\"javascript:biogps.setSampleQuery({qtype:'symbolanno', query:'1007_s_at\\n1053_at\\n117_at\\n121_at\\n1255_g_at\\n1294_at\\n1316_at\\n1320_at\\n1405_i_at\\n1431_at'});\">Affymetrix IDs</a></td></tr><tr><td><a  tabindex=1004 href=\"javascript:biogps.setSampleQuery({qtype:'symbolanno', query:'GO:0006275'});\">Gene Ontology</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><a  tabindex=1005 href=\"javascript:biogps.setSampleQuery({qtype:'symbolanno', query:'IPR008351'});\">Interpro</a></td></tr></table></div></p>"}]},{title:"Genome Interval",layout:"form",id:"searchbyinterval",items:[{xtype:"textfield",layout:"form",fieldLabel:"Enter a string",id:"genomeinternal_string",name:"genomeinternal_string",listeners:{render:function(f){if(f.container){f.container.createChild({tag:"p",html:"example: <a href=\"javascript:biogps.setSampleQuery({genomeassembly:'mouse', genomeinternal_string:'chrX:151,073,054-151,383,976'});\">chrX:151,073,054-151,383,976</a>"})}}},width:300,regex:new RegExp("^s*(chr.+)s*:s*([0-9,]+)s*-s*([0-9,]+)s*$","i"),regexText:'Invalid format! Should be something like "chrX:151,073,054-151,383,976" (case-insensitive).'},{html:'<p><label class="x-form-item label">or</label></p><p><label class="x-form-item label">Enter numbers:</label></p>',border:false,labelSeparator:""},{xtype:"textfield",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chr",name:"genomeinterval_chr",width:50,maxLength:10},{xtype:"textfield",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start",name:"genomeinterval_start",width:100,regex:new RegExp("^[,0-9]+$"),regexText:"Invalid format! Should be number only."},{xtype:"textfield",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end",name:"genomeinterval_end",width:100,regex:new RegExp("^[,0-9]+$"),regexText:"Invalid format! Should be number only."},{xtype:"combo",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unit",labelAlign:"left",store:a,width:50,displayField:"unit",name:"genomeinterval_unit",value:"Mb",typeAhead:false,mode:"local",triggerAction:"all",editable:false,forceSelection:true,selectOnFocus:true},{xtype:"radio",boxLabel:"Human (hg18)",id:"genome1",name:"genomeassembly",inputValue:"human",fieldLabel:"Genome Assembly"},{xtype:"radio",boxLabel:"Mouse (mm9)",checked:true,id:"genome2",name:"genomeassembly",inputValue:"mouse",labelSeparator:""},{xtype:"radio",boxLabel:"Rat (rn4)",id:"genome3",name:"genomeassembly",inputValue:"rat",labelSeparator:""},{xtype:"radio",boxLabel:"Drosophila (Dm3)",id:"genome4",name:"genomeassembly",inputValue:"drosophila",labelSeparator:""}]}]}],buttons:[{text:"Search",type:"submit",handler:function(){biogps.doSearch()}},{text:"Reset",type:"reset",handler:function(){this.ownerCt.form.reset()}}]});biogps.searchform.getForm().on("beforeaction",function(){_gaq.push(["_trackPageview","/search"]);_gaq.push(["_trackEvent","BioGPS","Search"])});var d=new Ext.Panel({layout:"column",height:"100%",border:false,renderTo:c,items:[biogps.searchform,{id:"col_info",plain:true,border:false,bodyStyle:"padding:35px 0 25px 35px"}]});function b(g,f){if(f.title=="Genome Interval"){if(!f.hintenabled_2){Ext.QuickTips.register({target:Ext.get("genomeinternal_string"),text:'example "chrX:151,073,054-151,383,976"',title:"Hint"});Ext.QuickTips.enable();f.hintenabled_2=true}Ext.getCmp("genomeinternal_string").focus()}else{if(!f.hintenabled_1){Ext.QuickTips.register({target:Ext.get("query"),text:'For Symbol or accession searches, query terms can be separated by a space or a newline.<br>For Keyword searches, query terms on a single line are interpreted as a phrase.<br>Wildcards: "?" substitutes for a single character, "*" substitutes for any number of characters.',title:"Hint"});Ext.QuickTips.enable();f.hintenabled_1=true}if(!coreDispatcher.showWelcome){Ext.getCmp("query").focus()}}}};biogps.doSearch=function(a){if(biogps.resultpage&&biogps.resultpage.genelistrendered){biogps.resultpage.genelistrendered=false}var c=biogps.searchform;var e;if(a){c.form.setValues(a);e=a.target;if(a.searchby){c.items.get(0).setActiveTab(a.searchby)}}var b=c.items.get(0).getActiveTab().id;setFocus=function(){if(e){var f=Ext.get(e);if(f){f.focus()}}else{if(b=="searchbyanno"){Ext.getCmp("query").focus()}else{Ext.getCmp("genomeinternal_string").focus()}}};if(!c.getForm().isValid()){Ext.MessageBox.show({title:"Error",msg:"Wrong input! Correct and try again.",buttons:Ext.Msg.OK,fn:setFocus,icon:Ext.MessageBox.ERROR})}else{if(b=="searchbyanno"){var d=c.getForm().getValues().query.trim();if(d==""){c.getForm().setValues({query:""});return}else{if(d.length>biogps.MAX_QUERY_LENGTH){Ext.MessageBox.show({title:"Error",msg:String.format("Your query is too large (>{0}k characters). Modify your query and try again.",biogps.MAX_QUERY_LENGTH/1000),buttons:Ext.Msg.OK,fn:setFocus,icon:Ext.MessageBox.ERROR});return}}}c.getForm().submit({url:"/",waitMsg:"Searching database...",method:"POST",timeout:60,params:{searchby:b},success:function(f,g){Ext.MessageBox.hide();if(g.result.data.geneList&&g.result.data.geneList.length==0){Ext.MessageBox.show({title:"Not found",msg:"Your query does not return any record. Try again.",buttons:Ext.Msg.OK,fn:setFocus,icon:Ext.MessageBox.WARNING})}else{biogps.genelist_panel.loadGeneList(g.result.data);biogps.renderSearchResult("resultpanel","center_panel",g.result.data)}},failure:function(f,g){biogps.formfailure(g,"Searching database failed!")}})}};biogps.setSampleQuery=function(a){if(biogps.searchform){biogps.searchform.form.setValues(a)}};biogps.renderTipBox=function(a){if(isArray(biogps.tip_array)&&biogps.tip_array.length>0){var b=Ext.fly(a).createChild({tag:"div",id:"tipbox_container",style:"padding:35px 5px 25px 5px;"});if(!Ext.state.Manager.get("hideTipBox")){var c=new biogps.TipBox({id:"tipbox"});c.render(b)}else{biogps.makeShowTipBoxLink(b)}}};biogps.makeShowTipBoxLink=function(a){var b=a.createChild({tag:"div",style:"padding:4px 0px 0px 5px"});b.update('<img src="/assets/img/information.png" align="absmiddle"/>&nbsp;<span style="font: 8pt Tahoma; font-weight:bold;">Tip of the Day:</span>&nbsp;');var c=b.createChild({tag:"a",href:"#",style:"font: 8pt Tahoma;",html:"[show]"});c.on("click",function(g,f){g.stopEvent();Ext.state.Manager.clear("hideTipBox");var h=new biogps.TipBox({id:"tipbox"});var d=Ext.fly("tipbox_container");d.dom.innerHtml="";while(d.first()){d.first().remove()}h.render(d)},this)};biogps.TipBox=function(a){this.id="";Ext.apply(this,a);biogps.TipBox.superclass.constructor.call(this,{width:300,bodyStyle:"padding:5px 5px 5px 15px",html:"",tbar:new Ext.Toolbar({style:"background:#ffffff;",items:[" ",'<img src="/assets/img/information.png" align="absmiddle"/>'," ","<b>Tip of the Day:</b>","->",{text:"prev",handler:this.prevTip,scope:this}," ","|"," ",{text:"next",handler:this.nextTip,scope:this},"    ",{text:"close",handler:this.closeBox,scope:this}]})});this.current_idx=Math.floor(Math.random()*1000%biogps.tip_array.length);this.on("render",function(){this.el.fadeIn({duration:1});this.showTip()},this)};Ext.extend(biogps.TipBox,Ext.Panel,{showTip:function(){this.body.update(String.format("{0}",biogps.tip_array[this.current_idx]))},nextTip:function(){this.current_idx=this.current_idx+1;if(this.current_idx>biogps.tip_array.length-1){this.current_idx=0}this.showTip()},prevTip:function(){this.current_idx=this.current_idx-1;if(this.current_idx<0){this.current_idx=biogps.tip_array.length-1}this.showTip()},closeBox:function(){if(this.el){this.el.fadeOut({duration:1,callback:function(){this.destroy();Ext.fly("tipbox_container").dom.innerHtml="";biogps.makeShowTipBoxLink(Ext.fly("tipbox_container"));Ext.state.Manager.set("hideTipBox",true)},scope:this})}}});biogps.renderFeedBox=function(b){var a=Ext.fly(b).createChild({tag:"div",style:"padding:5px 0px 0px 5px"});a.setSize(305,"auto");var c=new Ext.Panel();c.on("render",function(d){d.load({url:"/utils/feedbox/",scripts:true})});c.render(a)};NodeMouseEventPlugin=Ext.extend(Object,{init:function(a){if(!a.rendered){a.on("render",function(){this.init(a)},this);return}this.tree=a;a.body.on("mouseover",this.onTreeMouseover,this,{delegate:"li.x-tree-node"})},onTreeMouseover:function(c,b,f){var a=Ext.fly(b).down("div.x-tree-node-el");if(a){var d=a.getAttribute("tree-node-id","ext");if(d){this.tree.fireEvent("mouseover",this.tree.getNodeById(d),c)}}}});biogps.ListPanelBase=function(a){this.ibar=[];var b={border:false,split:true,width:225,minSize:175,maxSize:400,rootVisible:false,lines:true,baseAtrchecked:true,collapseFirst:false,plugins:new NodeMouseEventPlugin()};Ext.apply(this,b);Ext.apply(this,a);biogps.ListPanelBase.superclass.constructor.call(this);this.on("mouseover",function(d,c){if(d.isLeaf()){this.toggleNodeInlineToolBar(d)}c.stopEvent();return false},this);this.getSelectionModel().on("beforeselect",function(d,c){return c.isLeaf()},this);this.on("checkchange",function(d,c){if(!d.isLeaf()&&d.parentNode==this.root&&d.childNodes.length>0){d.childNodes.each(function(e){e.ui.toggleCheck(c)})}},this)};Ext.extend(biogps.ListPanelBase,Ext.tree.TreePanel,{afterRender:function(){biogps.ListPanelBase.superclass.afterRender.call(this);this.el.on("contextmenu",function(a){a.preventDefault()})},toggleNodeInlineToolBar:function(b){if(b){var c=b.ui.getAnchor();var a=Ext.get(c.parentNode);c=Ext.get(c);var d=(a.last().id==b.id+"_ibar")?a.last():null;if(!d){d=a.createChild({tag:"div",id:b.id+"_ibar",cls:"node-inline-toolbar"});this.ibar.each(function(e){var f=d.createChild({tag:"button",cls:"node-inline-btn "+e.iconCls});f.on("click",function(g){e.fn.call(e.scope,b)},this,{stopPropagation:true,stopEvent:true,preventDefault:true})},this)}}},removeNode:function(b,c){var a;if(b.id){a=b}else{a=this.getNodeById(b)}if(a){a.unselect();if(!c){Ext.fly(a.ui.elNode).ghost("l",{callback:function(){this.remove()},scope:a,duration:0.4})}else{a.remove()}}}});biogps.GeneListPanel=function(){biogps.GeneListPanel.superclass.constructor.call(this,{id:"genelist-tree",region:"center",lines:false,root:new Ext.tree.TreeNode("GeneList Viewer"),tbar:[{iconCls:"icon-showreport",text:"View",handler:function(){this.showGeneReport()},tooltip:"View Gene Report",scope:this},{iconCls:"icon-undo",text:"Undo",handler:this.loadLastGeneList,tooltip:"Load last gene list",scope:this},{text:"Save",iconCls:"icon-save",id:"genelist_save_btn",handler:this.saveGeneSet,tooltip:"Save selected genes",disabled:true,scope:this}],ibar:[{iconCls:"icon-remove-small",fn:function(a){this.removeNode(a)},scope:this}]});this.createRoot();this.on({beforeremove:function(){this.last_geneList=this.getCurrentGeneList()},remove:function(){this.updateRoot()},scope:this});this.addEvents({geneclicked:true});this.on("click",function(b,a){if(b.isLeaf()){this.fireEvent("geneclicked",b.attributes)}},this);biogps.usrMgr.linkWithAuthentication(this.init,this)};Ext.extend(biogps.GeneListPanel,biogps.ListPanelBase,{init:function(){if(biogps.usrMgr.is_anonymoususer){this.getTopToolbar().items.get("genelist_save_btn").disable()}else{this.getTopToolbar().items.get("genelist_save_btn").enable()}},createRoot:function(){this.genelist_node=this.root.appendChild(new Ext.tree.TreeNode({text:"All Genes",cls:"node-root-el",checked:false,expanded:true}))},getCurrentGeneList:function(){var c=[];var a=this.genelist_node.childNodes;if(a.length>0){for(var b=0;b<a.length;b++){c.push(a[b].attributes)}}return c},removeAll:function(){this.last_geneList=this.getCurrentGeneList();this.root.removeChild(this.genelist_node);this.createRoot()},updateRoot:function(){this.genelist_node.setText(String.format("All ({0})",this.genelist_node.childNodes.length))},addGene:function(a,b,e){var d=this.getNodeById(a.id);if(d){if(!b){d.select();d.ui.highlight()}return}Ext.apply(a,{iconCls:"icon-gene",checked:false,leaf:true,qtip:"GeneID: "+a.id+"<br>"+a.name,id:a.id});var c=new Ext.tree.TreeNode(a);this.genelist_node.appendChild(c);if(!b){if(!e){Ext.fly(c.ui.elNode).slideIn("l",{callback:c.select,scope:c,duration:0.4})}else{c.select()}}return c},mergeGeneList:function(d,c){var b=d.concat(c).sort(function(f,e){return f.symbol>e.symbol});for(var a=1;a<b.length;a++){if(b[a-1].id==b[a].id){b.splice(a,1);a=a-1}}return b},loadGeneList:function(c,e){var d;if(e){d=this.mergeGeneList(this.getCurrentGeneList(),c.geneList)}else{d=c.geneList}var a=1000;if(d.length>a){biogps.warning(String.format("At most {0} genes can be loaded at left-side panel. {1} extra genes are excluded.",a,d.length-a))}this.removeAll();for(var b=0;b<Math.min(d.length,a);b++){gid=d[b].id;gsymbol=d[b].symbol;gname=d[b].name;this.addGene({id:gid,symbol:gsymbol,name:gname,text:gsymbol},true,true)}this.updateRoot();this.expand(true);this.doLayout()},loadLastGeneList:function(){if(this.last_geneList&&this.last_geneList.length>0){this.loadGeneList({geneList:this.last_geneList})}},loadFromGeneIDList:function(b){var a=new Ext.LoadMask(this.ownerCt.getEl(),{msg:"Loading gene list..."});a.show();biogps.callRemoteService({url:"/service/getgenelist/",params:{genelist:b.join(",")},method:"POST",timeout:90000,fn:function(d){var c=d.reader.jsonData;this.loadGeneList(c);a.hide();a.destroy()},scope:this})},getSelectedGenes:function(){var a=[];this.genelist_node.eachChild(function(b){if(b.ui.checkbox.checked){a.push(b.id)}});return a},showGeneReport:function(b){if(b&&b.id){var a=[b.id]}else{var a=this.getSelectedGenes()}if(a.length==0){biogps.error("You did not select any gene. Please select and try again.")}else{if(a.length>10){biogps.error("You can only render at most 10 gene reports at one time. Please select less genes and try again.")}else{biogps.renderGeneReport2(a)}}},saveGeneSet:function(){var a=this.getSelectedGenes();biogps.GeneSetMgr.saveGeneSet(a,this.tbar)}});biogps.GeneSetMgr=function(a){this.id="";Ext.apply(this,a);biogps.GeneSetMgr.superclass.constructor.call(this);this.addEvents({genesetsaved:true});this.on("genesetsaved",function(){biogps.geneset_panel.load()})};Ext.extend(biogps.GeneSetMgr,Ext.util.Observable,{doGenesetSave:function(b){if(!(biogps.genesetsavewin&&biogps.genesetsavewin.el.parent())){return}var c,f;var g="POST";switch(b.mode){case"new":var a=b.geneList;c="/geneset/";f={data:Ext.util.JSON.encode(a)};break;case"union":var d=b.genesetid;c="/geneset/union/";f={genesetid:d};break;case"intersection":var d=b.genesetid;c="/geneset/intersection/";f={genesetid:d};break;case"update":var e=b.geneset;c="/geneset/"+e.genesetid+"/";g="PUT";break;default:return}if(!(Ext.getCmp("genesetsaveform_name").isValid())){biogps.error("Missing or wrong input gene list name! Correct and try again.");Ext.getCmp("genesetsaveform").form.reset()}else{biogps.genesetsavewin.body.mask("Saving gene list...");Ext.getCmp("genesetsaveform").getForm().submit({url:c,params:f,method:g,scope:this,success:function(i,j){if(j.result.success){var h=Ext.getCmp("genesetsaveform_name").getValue();biogps.genesetsavewin.body.unmask();biogps.genesetsavewin.body.mask(String.format('Gene list "{0}" saved!',h));setTimeout(function(){biogps.genesetsavewin.body.unmask();biogps.genesetsavewin.close()},1000);this.fireEvent("genesetsaved")}else{biogps.genesetsavewin.body.unmask();biogps.formfailure(j,errmsg="Saving Gene list failed! Try again.",onclose=function(){if(biogps.genesetsavewin){biogps.genesetsavewin.items.get(0).form.reset()}biogps.genesetsavewin.items.get(0).items.get(0).focus()})}},failure:function(h,i){biogps.genesetsavewin.body.unmask();biogps.formfailure(i,errmsg="Saving Gene list failed! Try again.",onclose=function(){Ext.getCmp("genesetsaveform").form.reset();Ext.getCmp("genesetsaveform").items.get(0).focus()})}})}},showSaveWin:function(c){var h=c.targetEl;var e=function(){this.doGenesetSave(c)};var i,g,f;if(c.mode=="new"){var a=c.geneList;if(a.length==0){biogps.error("You did not select any gene to save. Please try again.");return}else{if(a.length>1000){biogps.error("You can save at most 1000 genes in one gene list. Please select less genes and try again.");return}}i=String.format("Save selected Genes ({0})",a.length)}else{if(c.mode=="union"||c.mode=="intersection"){var b=c.genesetid;if(!isArray(b)||b.length<2){biogps.error("Select at least two gene lists for operation.");return}else{if(b.length>100){biogps.error("At most 100 gene lists can be operated at once.");return}}i=String.format("Take {0} of selected gene lists ({1})",c.mode,b.length);g=String.format("{0}_Gene_List_{1}",Ext.util.Format.capitalize(c.mode),Ext.util.Format.date(new Date(),"mdY"));f=String.format("This gene list is created by taking {0} from ({1})",c.mode,b.join(", "))}else{if(c.mode=="update"){var d=c.geneset;i="Update geneset";g=d.name;f=d.description}else{return}}}biogps.genesetsavewin=new Ext.Window({title:i,layout:"fit",width:380,labelWidth:200,modal:true,autoHeight:true,stateful:false,plain:true,grp:this,listeners:{show:{buffer:10,fn:function(k){var j=new Ext.KeyMap(k.getEl(),[{key:13,stopEvent:true,fn:e,scope:this.grp},{key:27,stopEvent:true,fn:function(){biogps.genesetsavewin.close()}}]);k.items.get(0).items.get(0).focus()}},destroy:function(){delete biogps.genesetsavewin}},items:new Ext.FormPanel({id:"genesetsaveform",labelWidth:120,autoHeight:true,bodyStyle:"padding:5px",border:false,items:[{xtype:"textfield",anchor:"90%",fieldLabel:"Name your Gene list",id:"genesetsaveform_name",name:"name",value:g,allowBlank:false},{fieldLabel:"Description",xtype:"textarea",anchor:"90%",id:"genesetsaveform_description",name:"description",value:f,height:100,allowBlank:true}],buttons:[{text:"Save",handler:e,scope:this},{text:"Cancel",handler:function(){biogps.genesetsavewin.close()}}]})});biogps.genesetsavewin.show(h)},saveGeneSet:function(a,b){this.showSaveWin({mode:"new",targetEl:b,geneList:a})},unionGeneSet:function(a,b){this.showSaveWin({mode:"union",targetEl:b,genesetid:a})},intersectionGeneSet:function(a,b){biogps.callRemoteService({url:"/geneset/intersection/",params:{genesetid:a,validate:"1"},method:"POST",fn:function(c){if(c.reader.jsonData.success){this.showSaveWin({mode:"intersection",targetEl:b,genesetid:a})}else{biogps.error(c.reader.jsonData.error?c.reader.jsonData.error:"Failed to perform intersection on selected gene sets.")}},scope:this})},editGeneSet:function(a,b){this.showSaveWin({mode:"update",targetEl:b,geneset:a})},deleteGeneSet:function(b,d,a){var c=String.format('Are you SURE you want to delete the "{0}" gene list?<br />This action CANNOT be undone!',b.name);Ext.MessageBox.confirm("Confirm",c,function(e){if(e=="yes"){biogps.callRemoteService({url:"/geneset/"+b.genesetid+"/",method:"DELETE",fn:d,scope:a})}},this)},loadGenes:function(b,c,a){biogps.callRemoteService({url:"/geneset/"+b.genesetid+"/?geneinfo=1",method:"GET",fn:c,scope:a})},loadGeneSets:function(a,e,f,d,c){var b;if(e=="intersection"){b="/geneset/intersection/"}else{if(e=="union"){b="/geneset/union/"}else{biogps.error("Unknown mode parameter: "+e);return}}biogps.callRemoteService({url:b,params:{genesetid:a,geneinfo:1},method:"POST",fn:f,failure:c,scope:this})}});biogps.GeneSetMgr=new biogps.GeneSetMgr();Ext.override(Ext.tree.MultiSelectionModel,{onNodeClick:function(a,b){this.select(a,b,true)},select:function(a,c,b){if(this.isSelected(a)){this.lastSelNode=a;this.unselect(a);return a}this.selNodes.push(a);this.selMap[a.id]=a;this.lastSelNode=a;a.ui.onSelectedChange(true);this.fireEvent("selectionchange",this,this.selNodes);return a}});biogps.GeneSetPanel=function(){biogps.GeneSetPanel.superclass.constructor.call(this,{id:"geneset-tree",region:"south",title:"Saved Gene Lists",lines:true,height:300,selModel:new Ext.tree.MultiSelectionModel(),simpleSelect:true,root:new Ext.tree.TreeNode("GeneSet Viewer"),tbar:[new Ext.Toolbar.SplitButton({text:"Load",handler:this.union,scope:this,tooltip:"Load genes from selected gene list",iconCls:"icon-load",menu:{items:[{text:"Union",handler:this.union,scope:this,iconCls:"icon-intersection"},{text:"Intersection",handler:this.intersection,scope:this,iconCls:"icon-intersection"},"-","Options:",{text:"Append genes",id:"cbx_genelist_appending",checked:false,listeners:{render:{fn:function(a){this.cbx_genelist_appending=a},scope:this}},handler:function(b,a){b.setChecked(!b.checked);return false},scope:this}]}})],ibar:[{iconCls:"icon-edit-small",fn:this.edit,scope:this},{iconCls:"icon-remove-small",fn:this.remove,scope:this}]});this.createRoot();biogps.usrMgr.linkWithAuthentication(this.init,this);this.on({remove:function(){this.updateRoot()},click:function(b,a){if(b.isLeaf()){b.ui.checkbox.checked=!b.ui.checkbox.checked}},checkchange:function(b,a){if(b.parentNode==this.root&&b.childNodes.length>0){b.childNodes.each(function(c){c.ui.toggleCheck(a)})}else{if(b.isLeaf()){if(a){this.selModel.select(b);b.ui.highlight()}else{this.selModel.unselect(b)}}}},scope:this});this.on("dblclick",function(b,a){this.loadOneGeneset(b);b.ui.toggleCheck(true)},this)};Ext.extend(biogps.GeneSetPanel,biogps.ListPanelBase,{init:function(){if(biogps.usrMgr.is_anonymoususer){this.removeAll();this.mylist.appendChild(new Ext.tree.TreeNode({text:"Available after logging in.",disabled:true}));this.getTopToolbar().disable();this.mylist.disable()}else{this.load()}},isGenesetNode:function(a){return a&&a.attributes.genesetid},createRoot:function(){this.mylist=this.root.appendChild(new Ext.tree.TreeNode({text:"All Gene Lists",cls:"node-root-el",checked:false,expanded:true}))},getSelectedGeneSets:function(a){var b=[];this.mylist.eachChild(function(c){if(c.ui.checkbox.checked){if(a){b.push(c)}else{b.push(c.attributes.genesetid)}}});return b},onlyOneSelected:function(){var a=this.getSelectedGeneSets(returnnodes=true);if(a.length==0){biogps.error("Please select a gene list first.")}else{if(a.length>1){biogps.error("Please select only one gene list to continue.")}else{return a[0]}}},removeAll:function(){this.suspendEvents();this.root.removeChild(this.mylist);this.resumeEvents();this.createRoot()},updateRoot:function(){this.root.firstChild.setText(String.format("All ({0})",this.mylist.childNodes.length))},addNode:function(a,b,e){var d=this.getNodeById(a.id);if(d){if(!b){d.select();d.ui.highlight()}return}Ext.apply(a,{iconCls:"icon-geneset",checked:false,leaf:true,qtip:a.description,id:"geneset_"+a.genesetid,text:a.name+" ("+a.size+")"});var c=new Ext.tree.TreeNode(a);this.mylist.appendChild(c);if(!b){if(!e){Ext.fly(c.ui.elNode).slideIn("l",{callback:c.select,scope:c,duration:0.4})}else{c.select()}}return c},load:function(b){biogps.callRemoteService({url:"/getmygenesets/",fn:a,scope:this});function a(d){var c=d.reader.jsonData;this.removeAll();for(var e=0;e<c.length;e++){this.addNode({genesetid:c[e].id,name:c[e].name,description:Ext.util.Format.ellipsis(c[e].description,100),size:c[e].size},true,true)}this.updateRoot();this.expand(true);this.doLayout()}},edit:function(a){if(!(a&&a.attributes)){a=this.onlyOneSelected()}if(a&&a.attributes.genesetid){biogps.GeneSetMgr.editGeneSet(a.attributes,this.tbar)}},remove:function(a){if(!(a&&a.attributes)){a=this.onlyOneSelected()}if(a&&a.attributes.genesetid){biogps.GeneSetMgr.deleteGeneSet(a.attributes,b,this)}function b(c){data=c.reader.jsonData;if(data.success){this.removeNode(a.id)}else{biogps.error(data.error?data.error:"")}}},getLoadAppendingFlag:function(){return this.cbx_genelist_appending?this.cbx_genelist_appending.checked:false},loadOneGeneset:function(a){if(a&&a.attributes.genesetid){var b=new Ext.LoadMask(this.ownerCt.getEl(),{msg:"Loading gene list..."});b.show();var d=this.getLoadAppendingFlag();if(a.attributes.cachedGeneList){biogps.genelist_panel.loadGeneList(a.attributes.cachedGeneList,d);b.hide();b.destroy()}else{function c(f){geneset=f.reader.jsonData;var e={totalCount:geneset.data.length,geneList:geneset.data};a.attributes.cachedGeneList=e;biogps.genelist_panel.loadGeneList(e,d);b.hide();b.destroy()}biogps.GeneSetMgr.loadGenes(a.attributes,c,this)}}},loadGeneSets:function(e){var b=this.getSelectedGeneSets();if(!isArray(b)||b.length==0){biogps.error("Please select a gene list first.");return}if(e=="intersection"&&b.length<2){biogps.error("Select at least two gene lists for operation.");return}if(b.length==1&&e!="intersection"){var c=this.onlyOneSelected();this.loadOneGeneset(c);return}var d=new Ext.LoadMask(this.ownerCt.getEl(),{msg:"Loading gene list..."});d.show();var g=this.getLoadAppendingFlag();function f(i){genedata=i.reader.jsonData;var h={totalCount:genedata.genes.length,geneList:genedata.genes};biogps.genelist_panel.loadGeneList(h,g);d.hide();d.destroy()}function a(){d.hide();d.destroy()}biogps.GeneSetMgr.loadGeneSets(b,e,f,this,a)},intersection:function(){this.loadGeneSets(mode="intersection")},union:function(){this.loadGeneSets(mode="union")}});biogps.renderSearchResult=function(e,c,a){var b=Ext.get(e);var d=Ext.getCmp(c);Ext.getCmp("result_panel").enable();if(!b){b=Ext.getBody().createChild({tag:"div",id:e});d.add({contentEl:e,title:"Search Result",layout:"fit",closable:true,autoScroll:true});d.doLayout();d.setActiveTab(d.items.getCount()-1)}if(a.geneList.length>1){Ext.History.add("goto=searchresult");d.setActiveTab("result_panel")}b.dom.innerHTML="";biogps.resultpage=new biogps.GeneResultPage(a);biogps.resultpage.render(b.dom)};biogps.GeneResultPage=function(b){this.totalCount;this.resultPerPage;this.currentPage;this.geneList;Ext.apply(this,b);var a=this.totalCount>1?"s":"";this.start=this.resultPerPage*(this.currentPage-1)+1;this.end=Math.min(this.totalCount,this.start+this.resultPerPage-1);this.totalPage=Math.ceil(this.totalCount/this.resultPerPage);biogps.GeneResultPage.superclass.constructor.call(this,{border:false,tbar:[String.format("Your query returns {0} record{1}.",this.totalCount,a)," ","->"," "]});this.on("render",this.renderGeneList,this)};Ext.extend(biogps.GeneResultPage,Ext.Panel,{renderGeneList:function(){var c,d;if(this.rendered){c='<table id="generesult_table" class="generesult_table" cellspacing="0">';c+='<thead><tr><th scope="col">no.</th><th scope="col">symbol</th><th scope="col">id</th><th scope="col">name</th></tr></thead><tbody>';for(var b=0;b<this.geneList.length;b++){d=this.geneList[b];if(b%2==0){c+=String.format('<tr onclick="biogps.renderGeneReport2(\'{0}\')"><th scope="row">{1}</th><td>{2}</td><td>{3}</td><td>{4}</td></tr>',d.id,b+1,d.symbol,d.id,d.name)}else{c+=String.format('<tr class="odd" onclick="biogps.renderGeneReport2(\'{0}\')"><th scope="row">{1}</th><td class="alt">{2}</td><td class="alt">{3}</td><td class="alt">{4}</td></tr>',d.id,b+1,d.symbol,d.id,d.name)}}c+="</tbody></table>";var a=this.geneList;this.body.update(c,false,function(){biogps.Messenger.fireEvent("genelistrendered");biogps.resultpage.genelistrendered=true;if(a.length==1){biogps.renderGeneReport2(a[0].id)}else{if(Ext.isIE){Ext.History.add("goto=searchresult")}}},this)}}});biogps.portletGroup=Ext.WindowGroup();biogps.portletGroup.zseed=1000;biogps.Portlet=function(a){this.id;this.plugin;this.gene;this.renderTo;var b={manager:biogps.portletGroup,xtype:"biogpsportlet",maximizable:true,collapsible:false,constrainHeader:true,shadow:Ext.isIE,animCollapse:false,autoScroll:true,bodyCssClass:"portlet-body",hideCollapseTool:true,hideMode:"display",renderTo:this.container,defaultSrc:"/assets/img/s.gif",tools:[{id:"gear",handler:function(c,d){this.showOptionMenu(d)},scope:this,qtip:"More options"}]};Ext.apply(this,a,b);this.x=this.x||0;this.y=this.y||0;this.width=this.width||350;this.height=this.height||250;biogps.Portlet.superclass.constructor.call(this);this.flag_bypasspluginsync=false;this.addEvents({contentload:true});this.addEvents({speciesswitch:true});this.on({contentload:function(){this.onContentLoad()},documentloaded:function(){this.fireEvent("contentload")},resize:function(){if(!this.flag_bypasspluginsync){this.syncSize()}this.fixHeaderText();this.toFront()},move:function(){if(!this.flag_bypasspluginsync){this.syncLocation()}},maximize:function(){biogps.utils.toggleScrollbar(biogps.centerTab.get("report_panel").body,true)},restore:function(){biogps.utils.toggleScrollbar(biogps.centerTab.get("report_panel").body,false)},show:function(){this.renderSpeciesSelector();this.syncLocation();this.syncSize();if(Ext.isIE){var c=new Ext.util.DelayedTask(function(){this.loadContent()},this);c.delay(0)}else{this.loadContent()}},scope:this})};Ext.extend(biogps.Portlet,Ext.ux.ManagedIFrame.Window,{maximize:function(){if(!this.maximized){this.expand(false);this.restoreSize=this.getSize();this.restorePos=this.getPosition(true);if(this.maximizable){this.tools.maximize.hide();this.tools.restore.show()}this.maximized=true;this.el.disableShadow();if(this.dd){this.dd.lock()}if(this.collapsible){this.tools.toggle.hide()}var b=biogps.centerTab.get("report_panel");var e=this.container.getBox();var c=b.body.getBox();var d=e.width;var f=Math.max(c.y,e.y);var a=c.y+c.height-f;this.flag_bypasspluginsync=true;this.setPagePosition(e.x,f);this.setSize(d,a);this.flag_bypasspluginsync=false;if(this.plugin){if(!this.plugin.useroptions){this.plugin.useroptions={}}this.plugin.useroptions.maximized=true}this.fireEvent("maximize",this)}return this},restore:function(){this.flag_bypasspluginsync=true;this.constructor.superclass.restore.call(this);this.flag_bypasspluginsync=false;if(this.plugin&&this.plugin.useroptions){delete this.plugin.useroptions.maximized;if(biogps.isEmptyObject(this.plugin.useroptions)){this.plugin.useroptions=null}}},close:function(b){if(b&&b.bypass_confirmation){if(b.suspend_events){this.suspendEvents()}this.constructor.superclass.close.call(this);if(b.suspend_events){this.resumeEvents()}}else{var a=Ext.MessageBox.confirm("Remove Plugin?",String.format('Are you sure that you want to remove <br />this plugin "{0}" from your layout? <br /><br /> Remember to click "options-->Save" to make it PERMANENT.',this.title),function(c){if(c=="yes"){if(b&&b.suspend_events){this.suspendEvents()}this.constructor.superclass.close.call(this);if(b&&b.suspend_events){this.resumeEvents()}}},this)}},focus:Ext.emptyFn,fixHeaderText:function(){var b=this.header.down("span.x-window-header-text");var a=b.getTextWidth();var d=this.species_button?this.species_button.el:this.tools.gear;var c=d.getX()-2-b.getX()-5;if(a>c){b.setStyle({display:"block",overflow:"hidden"});b.setWidth(c);Ext.QuickTips.register({target:b,text:this.title,dismissDelay:0})}else{b.setStyle({display:"inline",overflow:"visible"});b.setWidth(a);Ext.QuickTips.unregister(b)}},showError:function(a){this.items.clear();this.body.update(a)},_loadContent:function(){switch(this.plugin.type){case"div":var a=this.body.getUpdater();a.on({beforeupdate:this.showLoading,update:function(){this.fireEvent("contentload")},options:{single:true},scope:this});this.items.clear();if(this.html){a.update(this.html)}else{if(this.url){var b,c;b=this.url+"&container="+this.body.id;if(b.startsWith("http://")){c=b.startsWith("http://plugins.gnf.org/")||b.startsWith("http://plugins-dev.gnf.org/");if(this.plugin.options.securityAware){b+="&host="+location.host}b="/utils/proxy?url="+b.replace(/&/g,"%26");if(this.plugin.options.securityAware){b+="&secure=1"}}else{c=true}a.update({url:b,scripts:c})}else{a.update("HTML content is not available!")}}break;case"iframe":this.setSrc(this.url);break}},loadContent:function(){if(this.plugin.url){this.showLoading();this.url=this.plugin.geturl(this.gene);this.updateCurrentSpecies();if(this.url){if(this.plugin.type=="iframe"&&this.plugin.options.securityAware&&!this.plugin.is_secure_cookie_set()){this.plugin.on("secure_cookie_set",function(){this._loadContent()},this,{single:true});this.plugin.set_secure_cookie()}else{this._loadContent()}}else{var a=this.gene.getEntryGene();var b=String.format("This plugin is not available for this gene: {0}({1}, {2})",a.Symbol,this.gene.EntrySpecies,this.gene.EntryGeneID);this.showError(b);this.fireEvent("contentload")}}else{var b="This plugin {0}(id: {1}) is not loaded correctly.                            Either you have deleted it already or you don't have the privilege to access it.                           <br /><br />If this is your own layout, you might want to remove it from this layout by closing this plugin window.</p>";this.showError(String.format(b,this.plugin.title?'"'+this.plugin.title+'"':"",this.plugin.id))}if(this.plugin.title){this.setTitle(this.plugin.title);this.fixHeaderText()}},showLoading:function(){this.setIconClass("icon-loading")},onContentLoad:function(){this.setIconClass("icon-home")},refresh:function(){this.loadContent()},syncSize:function(){if(this.plugin&&!this.maximized&&!this.collapsed){Ext.apply(this.plugin,this.getSize())}},syncLocation:function(){if(this.plugin&&!this.maximized&&!this.collapsed){var a=this.getPosition(local=true);Ext.apply(this.plugin,{left:a[0],top:a[1]})}},update:function(a){if(a.width!=null&&a.height!=null){this.setSize(parseInt(a.width),parseInt(a.height))}if(a.top!=null&&a.left!=null){var d=this.container.getAnchorXY();var c=d[0]+parseInt(a.left);var b=d[1]+parseInt(a.top);this.getPositionEl().moveTo(c,b,a.animate);if(!a.animate){this.fireEvent("move",this,c,b)}}if(a.minimized&&!this.collapsed){this.collapse()}if(a.maximized&&!this.maximized){this.maximize()}},getLayoutData:function(){var a=this.plugin.getPositioning();var b={id:this.plugin.id,left:a.left,top:a.top,height:a.height,width:a.width};if(this.plugin.useroptions){b.useroptions=this.plugin.useroptions}if(this.plugin&&this.plugin.runtimeoptions&&this.plugin.runtimeoptions.currentSpecies){if(!b.useroptions){b.useroptions={}}b.useroptions.currentSpecies=this.plugin.runtimeoptions.currentSpecies}return b},toggleFrame:function(){},showOptionMenu:function(c){if(!c.menu){var b=function(e){e.tip=new Ext.ToolTip({target:e.getEl().getAttribute("id"),delegate:".x-menu-item",trackMouse:true,renderTo:document.body,text:"text",listeners:{beforeshow:function d(g){var f=e.ownerCt.findById(g.triggerElement.id);if(!f.initialConfig.qtip){return false}g.body.dom.innerHTML=f.initialConfig.qtip}}})};var a=new Ext.menu.Menu();a.add({text:"Open in browser",qtip:"Open this plugin in a new browser window",iconCls:"icon-pagego",handler:function(){window.open(this.url)},scope:this,listeners:{afterrender:b}});a.add({text:"Plugin details",qtip:"Show plugin details",iconCls:"icon-info",handler:function(){this.showInfo(c)},scope:this,listeners:{afterrender:b}});a.add({text:"Refresh",iconCls:"icon-refresh",qtip:"Refresh this plugin",handler:function(d,e){this.refresh()},scope:this,listeners:{afterrender:b}});a.add({text:"Flag plugin",qtip:"Flag as broken or inappropriate",iconCls:"icon-flag",handler:function(){this.flagit()},scope:this,listeners:{afterrender:b}});c.menu=a}c.menu.show(c)},showInfo:function(a){var b=new Ext.Template('<table width="100%">','<tr><td class="genesummary_head" colspan="2">Plugin details:<br></td></tr>','<tr><td class="genesummary_name">Title:</td><td class="genesummary_text">{title}</td></tr>','<tr><td class="genesummary_name">ID:</td><td class="genesummary_text">{id}</td></tr>','<tr><td class="genesummary_name">URL:</td><td class="genesummary_text"><div style="width:100%; overflow:auto;">{realurl}</div></td></tr>','<tr><td class="genesummary_name">URL tpl:</td><td class="genesummary_text"><div style="width:100%; overflow:auto;">[<a href="{url}" target="_blank">mouse over to see</a>]</div></td></tr>','<tr><td class="genesummary_name">Type:</td><td class="genesummary_text">{type}</td></tr>','<tr><td class="genesummary_name">Registered by:</td><td class="genesummary_text">{author}</td></tr>','<tr><td class="genesummary_name">Description:</td><td class="genesummary_text">{description}</td></tr>',"</table>").compile();if(this.infopanel){this.infopanel.destroy();this.infopanel=null;return}a=a||this.tools.help;this.infopanel=new Ext.Panel({id:this.id+"_infopanel",layout:"fit",floating:true,renderTo:this.el,width:250,html:b.apply(Ext.apply({realurl:this.url?'[<a href="'+this.url+'" target="_blank">open in a new window</a>]':"NA"},this.plugin)),frame:true,buttonAlign:"center",buttons:[{text:"OK",handler:function(){this.infopanel.destroy();this.infopanel=null},scope:this}]});this.infopanel.on("show",function(){this.infopanel.el.alignTo(a,"tr-br",[0,7])},this);this.infopanel.show()},sameAs:function(a){return((this.plugin.id==a.id))},flagit:function(){if(this.plugin){this.plugin.showFlagAsInappropriateForm(this.el)}},isOverlapWith:function(c,e){var b=this.getBox(local=true);var a=c.getBox(local=true);if(e){console.log(b.x+b.width,a.x,b.x+b.width>a.x,a.x+a.width,b.x,a.x+a.width>b.x,b.y+b.height,a.y,b.y+b.height>a.y,a.y+a.height,b.y,a.y+a.height>b.y)}if(((b.x+b.width>a.x&&a.x+a.width>b.x)&&(b.y+b.height>a.y&&a.y+a.height>b.y))){return true}else{return false}},getPositionNextTo:function(c,e){var d=this.getBox(local=true);var f=c.getBox(local=true);var b=f.x+f.width+5;var a=f.y;if(b+d.width>e){b=0;a=f.y+f.height+5}return{x:b,y:a}},renderSpeciesSelector:function(){var e,a,c;if(this.plugin){e=this.plugin.getAvailableSpecies(this.gene,applyuseroptions=true);if(e.length>0){a=new Ext.menu.Menu();var d=this;var b=Math.round(Math.random()*100,0).toString();biogps.AVAILABLE_SPECIES.each(function(f){a.add({text:f.capitalize(),checked:false,disabled:e.indexOf(f)==-1,group:b+"_selectedspecies",handler:d.onSpeciesSwitch,scope:d})});c=new Ext.Button({text:"",menu:a,cls:"x-tool-species"});c.on("click",function(f){f.showMenu()});c.on("mouseover",function(g){var f=Ext.fly(Ext.DomQuery.selectNode("span.x-tool-species-label",g.getEl().dom));if(f){f.addClass("x-tool-species-label-over")}},this);c.on("mouseout",function(g){var f=Ext.fly(Ext.DomQuery.selectNode("span.x-tool-species-label",g.getEl().dom));if(f){f.removeClass("x-tool-species-label-over")}},this);c.render(this.header);this.species_menu=a;this.species_button=c}}},onSpeciesSwitch:function(b,a){if(!b.checked){var c=b.text.toLowerCase();if(this.plugin){this.plugin.runtimeoptions=this.plugin.runtimeoptions||{};this.plugin.runtimeoptions.currentSpecies=c;this.loadContent();this.fireEvent("speciesswitch",this)}}},updateCurrentSpecies:function(){if(this.species_button&&this.species_menu){var c=this.plugin.current_species;var a={human:'<span class="x-tool-species-label">Species:&nbsp;Hs&nbsp;</span>',mouse:'<span class="x-tool-species-label">Species:&nbsp;Mm</span>',rat:'<span class="x-tool-species-label">Species:&nbsp;Rn</span>',drosophila:'<span class="x-tool-species-label">Species:&nbsp;Dm</span>',"c. elegans":'<span class="x-tool-species-label">Species:&nbsp;Ce</span>',zebrafish:'<span class="x-tool-species-label">Species:&nbsp;Dr</span>',arabidopsis:'<span class="x-tool-species-label">Species:&nbsp;At</span>'};this.species_button.setText(a[c]);for(var b=0;b<this.species_menu.items.length;b++){var d=this.species_menu.items.get(b);d.setChecked(d.text.toLowerCase()==c)}}}});Ext.reg("biogpsportlet",biogps.Portlet);biogps.GeneReportMgr=Ext.apply(new Ext.util.MixedCollection(),{rendered:false,populateGeneListPanel:false,register:function(){for(var a=0,b;b=arguments[a];a++){this.add(b)}},unregister:function(){for(var a=0,b;b=arguments[a];a++){this.remove(this.lookup(b))}},lookup:function(a){return typeof a=="object"?a:this.get(a)},getGeneidList:function(){var a=[];this.each(function(b){a.push(b.geneid)});return(a)},makeTitle:function(){var a="";if(this.length==1){a=this.getReport(0).title}else{if(this.length>1){var b=[];this.each(function(c){b.push(c.gene.getEntryGene().Symbol)});a=b.join(" , ")}}return(a)},getReport:function(a){return this.get(a)},collapseQuickLists:function(){this.each(function(a){a.grp_tbar.quickPluginBox.collapse()})},updateAll:function(){this.each(function(a){a.updatePage(true)})},refreshAll:function(){if(biogps.centerTab.activeTab.id!="report_panel"){biogps.centerTab.setActiveTab("report_panel")}this.each(function(a){a.grp_tbar.createLayoutMenu();a.renderPage()})},refreshLayout:function(a){this.each(function(b){if(b){if(b.grlayout.layout_id==a.layout_id){if(biogps.centerTab.activeTab.id=="report_panel"){b.refresh(updateonly=true)}else{b.need_refresh=true}}}})},refreshMarked:function(){this.each(function(a){if(a&&a.need_refresh){a.refresh(updateonly=true);a.need_refresh=false;delete a.need_refresh}})},removeAll:function(){biogps.portletGroup.each(function(a){a.close({bypass_confirmation:true,suspend_events:true})});this.each(function(a){a.destroy()});this.clear();this.populateGeneListPanel=false},markLayoutChanged:function(){this.each(function(a){if(a.grp_tbar){a.grp_tbar.layoutmenu_need_sync=true}})},bindLayoutMgr:function(){biogps.clearListeners(biogps.LayoutMgr,"layoutloaded");biogps.LayoutMgr.on("layoutloaded",function(){biogps.GeneReportMgr.refreshAll()})},render:function(g,f){if(biogps.LayoutMgr.layoutloading){var d=new Ext.util.DelayedTask();d.delay(100,function(){this.render(g,f)},this)}else{this.removeAll();this.rendered=false;if(biogps.genelist_panel.genelist_node&&biogps.genelist_panel.genelist_node.childNodes.length==0){this.populateGeneListPanel=true}Ext.fly(f).dom.innerHTML="";for(var b=0;b<g.length;b++){var e=new biogps.GeneReportPage({geneid:g[b]});e.render(Ext.fly(f).dom);this.register(e)}this.bindLayoutMgr();var c=new Ext.util.TaskRunner();var a={run:function(l){var j=true;for(var k=0;k<this.length;k++){var h=this.getReport(k);if(!(h&&h.rendered)){j=false;break}}if(j){this.rendered=true;biogps.Messenger.fireEvent("genereportrendered");c.stop(a)}},scope:this,interval:50};c.start(a)}}});biogps.renderGeneReport=function(g,d,f){var a=Ext.getCmp(g);var b=a.getEl();var e=Ext.getCmp(d);if(!a){a=Ext.getBody().createChild({tag:"div",id:g});e.add({contentEl:g,title:"Gene Report",layout:"fit",closable:true,autoScroll:true});e.doLayout();biogps.centerTab.suspendEvents();e.setActiveTab(e.items.getCount()-1);biogps.centerTab.resumeEvents()}else{a.enable()}biogps.centerTab.suspendEvents();e.setActiveTab(g);biogps.centerTab.resumeEvents();var c=new Ext.LoadMask(e.getEl(),{msg:"Rendering..."});c.show();biogps.GeneReportMgr.render(f,"reportpanel");c.hide();c.destroy()};biogps.renderGeneReport2=function(a,d){d=d?d:false;if(isArray(a)){var c=a}else{var c=[a]}if(!d){var b="goto=genereport&id="+c.join(",");if(b==Ext.History.getToken()){biogps.renderGeneReport("report_panel","center_panel",c)}else{Ext.History.add(b)}}else{biogps.renderGeneReport("report_panel","center_panel",c)}};biogps.GeneReportToolbar=function(a){this.grp=null;Ext.apply(this,a);this.initLayoutMenu();this.initOptionMenu();this.geneTitle=new Ext.Toolbar.TextItem({text:" ",cls:"gene-report-title"});this.notification=new Ext.Toolbar.TextItem({text:" "});this.layout_icon=new Ext.Toolbar.TextItem({text:" "});this.quickPluginBox=new biogps.PluginQuickAdd({grp:this.grp});biogps.GeneReportToolbar.superclass.constructor.call(this,{cls:"gene-report-header",items:[this.geneTitle,"->",this.notification,this.layout_icon,"current layout:"," ",this.layoutbutton,"|"," ",{text:"options",menu:this.optionmenu},this.quickPluginBox]});this.layoutmenu_need_sync=false};Ext.extend(biogps.GeneReportToolbar,Ext.Toolbar,{initLayoutMenu:function(){this.layoutmenu=new Ext.menu.Menu();this.layoutmenu.on("beforeshow",function(){if(this.layoutmenu_need_sync){this.createLayoutMenu();this.layoutmenu_need_sync=false}},this);if(this.grp&&this.grp.grlayout&&this.grp.grlayout.layout_name){var a=this.grp.grlayout.layout_name}else{var a="click to select"}this.layoutbutton=new Ext.Toolbar.Button({text:String.format("<b>{0}</b>",a),menu:this.layoutmenu});this.createLayoutMenu()},initOptionMenu:function(){this.optionmenu=new Ext.menu.Menu({items:[{text:"Tile windows",handler:function(){this.grp.tilePluginWindows("area")},scope:this},{text:"Tile windows (compact)",handler:function(){this.grp.tilePluginWindows_compact()},scope:this},{text:"Open all in browser",handler:function(){this.grp.openAllInBrowser()},scope:this},{text:"Refresh/Revert",handler:function(){this.grp.refresh()},scope:this},{text:"Save",id:"lmenu_save",handler:function(){this.grp.saveCurrentLayout()},scope:this},{text:"Save as new...",id:"lmenu_saveas",handler:function(){this.grp.saveAsNewLayout()},scope:this}]});this.optionmenu.on("beforeshow",function(){if(biogps.usrMgr.is_anonymoususer){this.optionmenu.items.get("lmenu_saveas").disable()}else{this.optionmenu.items.get("lmenu_saveas").enable()}if(biogps.usrMgr.is_anonymoususer||(this.grp&&this.grp.grlayout.isSharedLayout())){this.optionmenu.items.get("lmenu_save").disable()}else{this.optionmenu.items.get("lmenu_save").enable()}},this)},createLayoutMenu:function(){if(!this.layoutmenu){return}this.layoutmenu.removeAll();this.layoutmenu.add('<b class="menu-title">My layouts:</b>');var a=[];var c=0;var d;for(var b=0;b<biogps.LayoutMgr.availableLayouts.length;b++){d=biogps.LayoutMgr.availableLayouts[b];if(d.is_shared){a.push(d)}else{this.layoutmenu.add({text:d.layout_name,checked:(biogps.LayoutMgr.currentLayout!=null&&(d.id==biogps.LayoutMgr.currentLayout.id)),value:d.id,group:"selectedlayout",checkHandler:this.onLayoutSwitch,scope:this});c+=1}}if(c==0){this.layoutmenu.add({text:"you don't have any yet",disabled:true})}if(a.length>0){this.layoutmenu.add('<b class="menu-title">Shared layouts:</b>');for(var b=0;b<a.length;b++){d=a[b];this.layoutmenu.add({text:d.layout_name,checked:(biogps.LayoutMgr.currentLayout!=null&&d.id==biogps.LayoutMgr.currentLayout.id),value:d.id,group:"selectedlayout",checkHandler:this.onLayoutSwitch,scope:this})}}},updateLayoutMenu:function(){biogps.LayoutMgr.reloadAvailableLayout()},setLayoutName:function(a){this.layoutbutton.setText(String.format("<b>{0}</b>",a))},setGeneTitle:function(a){if(a.length>60){a=a.substring(0,55)+"..."}if(this.geneTitle.rendered){this.geneTitle.setText(a)}else{this.geneTitle.on("render",function(){this.setGeneTitle(a)},this,{single:true})}},notify:function(a){if(a.startsWith("Error")){a='<font color="red">'+a+"</font>"}if(this.notification.rendered){this.notification.setText(a)}else{this.notification.on("render",function(){this.notify(a)},this,{single:true})}},setLayoutIcon:function(a,b){if(this.layout_icon.rendered){this.layout_icon.el.addClass(a);Ext.QuickTips.register({target:this.layout_icon.el,text:b,dismissDelay:0})}else{this.layout_icon.on("render",function(){this.setLayoutIcon(a,b)},this,{single:true})}},removeLayoutIcon:function(a){if(this.layout_icon.rendered){this.layout_icon.setText("");this.layout_icon.el.removeClass(a);Ext.QuickTips.unregister(this.layout_icon.el)}},onLayoutSwitch:function(b,a){if(a){this.grp.switchLayout(b.value)}}});biogps.GeneReportPage=function(a){this.title="";this.gene=null;this.geneid=null;this.grlayout=biogps.LayoutMgr.currentLayout;this.showframe=true;Ext.apply(this,a);this.id="grp_"+this.geneid,this.globalPortletIndex=0;this.addEvents({load:true});this.portlets=new Array();this.reportRendered=false;this.layout_modified_icon="icon-layout-alert";this.flag_donotsynclayout=false;this.flag_bypassclosecallback=false;this.gene=new biogps.Gene({id:this.geneid});this.grp_tbar=new biogps.GeneReportToolbar({grp:this,id:this.id+"_tbar"});biogps.GeneReportPage.superclass.constructor.call(this,{border:true,cls:"gene-report-page",autoWidth:true,height:100,deferredRender:true,autoScroll:this.showframe,autoEl:true,tbar:this.grp_tbar});this.on("render",this.renderPage,this);this.store=new Ext.data.JsonStore({url:"/service/getgeneidentifiers/?geneid="+this.geneid+"&format=json",fields:[],autoLoad:true});this.store.on("beforeload",this.showLoading,this);this.store.on("load",function(b){this.gene=Ext.apply(this.gene,b.reader.jsonData);this.addTabs();if(biogps.GeneReportMgr.populateGeneListPanel){var d=this.gene.getEntryGene();if(d){var c={};c.id=d.EntrezGene||d.EnsemblGene;if(c.id){c.name=d.Description||"";c.symbol=d.Symbol||"";biogps.genelist_panel.addGene({id:c.id,symbol:c.symbol,name:c.name,text:c.symbol},true,true)}}}},this);this.store.on("loadexception",biogps.ajaxfailure,this)};Ext.extend(biogps.GeneReportPage,Ext.Panel,{showLoading:function(){this.add({title:"Please wait...",id:"tmp_loading",height:100});this.loadmask=new Ext.LoadMask(this.getEl(),{msg:"Loading..."});this.loadmask.show()},removeLoading:function(){if(this.loadmask){this.loadmask.hide();this.loadmask.disable();this.remove("tmp_loading",true)}},addTabs:function(){if(this.gene){if(biogps.LayoutMgr.layoutloading){var b=new Ext.util.DelayedTask();b.delay(100,function(){this.addTabs()},this)}else{this.removeLoading();var d=this.gene.getEntryGene();var c=d.Symbol;var a=d.Description||"no description";if(a.length>100){a=a.substring(0,96)+"..."}var e=String.format("{0} ({1})",(c||this.geneid),a);this.setTitle(e);this.grp_tbar.setGeneTitle(e);this.doLayout()}}},checkLayout:function(){if(!this.grlayout){this.grp_tbar.notify("Error: This layout is not available! Please select another one using the layout menu on the right side.");return false}else{if(!this.grlayout.layout_data||this.grlayout.layout_data.length==0){this.grp_tbar.notify("Error: This layout does not contain any plugin. Please select another one using the layout menu on the right side.");return false}}return true},setInitialCanvasHeight:function(){var c;var d=0;for(var b=0;b<this.grlayout.layout_data.length;b++){c=new biogps.Plugin(this.grlayout.layout_data[b]);if(c.hasPositioning()){var a=parseInt(c.top);d=Math.max(d,a+c.height)}}this.height=d+120;this.setCanvasHeight(this.height)},createNewPortlet:function(c){var d;var b=!c.hasPositioning();var a="win_"+this.geneid+"_"+this.globalPortletIndex.toString();this.globalPortletIndex++;d=new biogps.Portlet({id:a,plugin:c,gene:this.gene,x:c.left,y:c.top,width:c.width,height:c.height,renderTo:this.body.id});d.show();d.on("resize",this.onPortletResize,this);d.on("move",this.onPortletMove,this);d.on("close",this.onPortletRemove,this);d.on("maximize",this.onPortletToggleMaximize,this);d.on("restore",this.onPortletToggleMaximize,this);d.on("speciesswitch",function(e){this.syncLayout()},this);d.firsttime=b;return d},postPageRendered:function(){this.updateSize();this.grp_tbar.setLayoutName(this.grlayout.layout_name);if(this.portlets.length==0){this.grp_tbar.notify("Error: This layout does not contain any plugin.");return}else{this.grp_tbar.notify("")}this.placeFirstTimePlugin();this.reportRendered=true;this.flag_donotsynclayout=false;if(this.grlayout.layout_modified){this.markLayoutModified()}else{this.markLayoutSaved()}var a=new Ext.util.DelayedTask(function(){this.flag_donotsynclayout=true;this.portlets.each(function(b){if(b.plugin.useroptions&&b.plugin.useroptions.maximized){b.maximize()}});this.flag_donotsynclayout=false},this);a.delay(500);_gaq.push(["_trackPageview","/gene/"+this.geneid.toString()]);_gaq.push(["_trackEvent","BioGPS","GeneReport",this.geneid.toString()])},renderPage:function(){if(!this.gene.getEntryGene()){var e=new Ext.util.DelayedTask();e.delay(100,function(){this.renderPage()},this)}else{this.cleanPage();this.grlayout=biogps.LayoutMgr.currentLayout;if(this.checkLayout()==false){return}this.globalPortletIndex=0;var d;var f;var a;this.setInitialCanvasHeight();this.portlets=[];var c=false;for(var b=0;b<this.grlayout.layout_data.length;b++){d=new biogps.Plugin(this.grlayout.layout_data[b]);f=this.createNewPortlet(d);this.portlets.push(f)}this.postPageRendered()}},updatePage:function(c){this.reportRendered=false;this.flag_donotsynclayout=true;var h=new Array(),f,d,e,g,b,a;this.setInitialCanvasHeight();for(d=0;d<this.portlets.length;d++){delete this.portlets[d].keep_flag}for(e=0;e<this.grlayout.layout_data.length;e++){b=new biogps.Plugin(this.grlayout.layout_data[e]);b.existed_flag=false;for(d=0;d<this.portlets.length;d++){f=this.portlets[d];if(!f.removed&&f.sameAs(b)&&!f.keep_flag){if(!c){if(!Ext.isIE6){b.animate={duration:0.35,callback:function(i){this.updateSize();var j=Ext.getCmp(i.id);j.syncSize();j.syncLocation()},scope:this}}f.update(b);f.loadContent()}f.keep_flag=true;h.push(f);b.existed_flag=true;break}}if(!b.existed_flag){g=this.createNewPortlet(b);h.push(g)}}for(d=0;d<this.portlets.length;d++){f=this.portlets[d];if(!f.keep_flag){f.close({bypass_confirmation:true,suspend_events:true});f=null;delete f}}this.portlets=h;this.postPageRendered()},cleanPage:function(){for(var a=0;a<this.portlets.length;a++){this.portlets[a].close({bypass_confirmation:true,suspend_events:true})}this.portlets=[];this.body.dom.innerHTML="";this.reportRendered=false},setCanvasHeight:function(a){this.setHeight(a)},updateSize:function(){var b;this.doLayout();var d=0;for(var a=0;a<this.portlets.length;a++){b=this.portlets[a];if(b.removed){continue}var c=b.getBox(local=true);if(c.y==0&&c.height==0){c=b.plugin.getPositioning();c.y=c.top}d=Math.max(d,c.y+c.height)}d=d+100;this.setCanvasHeight(d)},onPortletResize:function(a){if(Ext.isIE&&a.xtype!="biogpsportlet"){return}this.updateSize();this.syncLayout()},onPortletMove:function(a){this.updateSize();this.syncLayout()},onPortletToggleMaximize:function(a){this.syncLayout()},onPortletRemove:function(b){if(!this.flag_bypassclosecallback){var a=this.portlets.indexOf(b);this.portlets.remove(b);if(this.grlayout.layout_data[a].id==b.plugin.id){this.grlayout.layout_data.remove(this.grlayout.layout_data[a])}this.updateSize();this.syncLayout()}},refresh:function(a){this.reloadLayoutData({refreshRender:true,updateonly:a})},getBiogpsLayout:function(a){if(a&&a.positionOnly){this.grlayout.layout_data=this.getLayoutData()}else{var c=[];for(var b=0;b<this.portlets.length;b++){if(!this.portlets[b].removed){c.push(this.portlets[b].plugin)}}this.grlayout.layout_data=c}return this.grlayout},getLayoutData:function(){var b=[];for(var a=0;a<this.portlets.length;a++){if(!this.portlets[a].removed){b.push(this.portlets[a].getLayoutData())}}return b},syncLayout:function(){if(!this.flag_donotsynclayout&&this.grlayout.id==biogps.LayoutMgr.currentLayout.id){biogps.LayoutMgr.currentLayout=this.getBiogpsLayout();this.markLayoutModified()}},markLayoutModified:function(){var a="Layout has been modified.<br /> ";if(biogps.usrMgr.is_anonymoususer){a+="You need to login to save the changes."}else{if(biogps.LayoutMgr.currentLayout.isMyLayout()){a+='To save changes, click "options"-&gt;"Save".'}else{a+='To save changes, click "options"-&gt;"Save as new..."'}}a+='<br />To revert the changes, click "options"-&gt;"Refresh/Revert".';biogps.LayoutMgr.currentLayout.layout_modified=true;this.grp_tbar.setLayoutIcon(this.layout_modified_icon,a)},markLayoutSaved:function(){biogps.LayoutMgr.currentLayout.layout_modified=false;this.grp_tbar.removeLayoutIcon(this.layout_modified_icon)},reloadLayoutData:function(a){biogps.LayoutMgr.on("currentlayoutloaded",function(){biogps.clearListeners(biogps.LayoutMgr,"currentlayoutloaded");this.grlayout=biogps.LayoutMgr.currentLayout;if(a&&a.refreshRender){if(a.updateonly){this.updatePage()}else{this.renderPage()}}},this);biogps.LayoutMgr.loadLayout(this.grlayout.id);var c=new Ext.util.MixedCollection();c.addAll(biogps.LayoutMgr.availableLayouts);var b=c.get(this.grlayout.id);if(b){b.load()}delete c},saveCurrentLayout:function(a){a=a||{};if(!this.grlayout||biogps.require_user_logged_in()==false){return}var b=this.getBiogpsLayout({positionOnly:true});if(b.layout_data.length==0&&!a.saveEmptyLayout&&!a.quiet){var c=false;Ext.MessageBox.confirm("Save an empty Layout?",String.format('The layout "{0}" you are trying to save does not contain any plugin. Click "Yes" to save it anyway?',b.layout_name),function(d){if(d=="yes"){this.saveCurrentLayout({saveEmptyLayout:true})}},this);return}b.on("saved",function(d){this.reloadLayoutData();this.markLayoutSaved();if(!a.quiet){this.body.unmask();this.body.mask(String.format('Layout "{0}" saved!',biogps.LayoutMgr.currentLayout.layout_name));var e=this.body;setTimeout(function(){e.unmask()},1000)}},this);b.on("savefailed",function(e){if(a.quiet){return}if(e.error=="Layout does not exist."){var d=Ext.MessageBox.confirm("Save as a new Layout?",String.format('The layout "{0}" you are trying to save does not exist (likely this is a shared layout from others), but you can save a copy of this layout to your profile. Continue?',biogps.LayoutMgr.currentLayout.layout_name),function(f){if(f=="yes"){this.saveAsNewLayout()}},this)}else{Ext.MessageBox.alert("Error",String.format('Saving Layout failed with the error message: <br><br>"{0}"',(e.error||"[None]")))}this.body.unmask()},this);b.save()},saveAsNewLayout:function(a){if(!this.grlayout||biogps.require_user_logged_in()==false){return}var c=this.getLayoutData();biogps.layoutsavewin=new Ext.Window({title:"Save current layout",layout:"fit",width:320,labelWidth:200,modal:true,autoHeight:true,stateful:false,plain:true,grp:this,listeners:{show:{buffer:10,fn:function(e){e.items.get(0).items.get(0).focus();var d=new Ext.KeyMap(e.getEl(),[{key:13,stopEvent:true,fn:b,scope:this.grp},{key:27,stopEvent:true,fn:function(){biogps.layoutsavewin.close();delete biogps.layoutsavewin}}])}}},items:new Ext.FormPanel({id:"layoutsaveform",labelWidth:120,autoHeight:true,bodyStyle:"padding:5px 5px 5px 5px",border:false,items:[{xtype:"textfield",anchor:"90%",fieldLabel:"Name your layout",id:"layoutsaveform_name",name:"layout_name",allowBlank:false}],buttons:[{text:"Save",handler:b,scope:this},{text:"Cancel",handler:function(){biogps.layoutsavewin.close();delete biogps.layoutsavewin}}]})});biogps.layoutsavewin.show(this.grp_tbar.optionmenu.el);biogps.layoutsavewin.focus();function b(){if(!(Ext.getCmp("layoutsaveform_name").isValid())){Ext.MessageBox.show({title:"Error",msg:"Missing or wrong input layout name! Correct and try again.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});Ext.getCmp("layoutsaveform").form.reset()}else{biogps.layoutsavewin.body.mask("Saving layout...");Ext.getCmp("layoutsaveform").getForm().submit({url:"/layout/add/",params:{layout_data:Ext.util.JSON.encode(c),description:this.grlayout.description},method:"POST",scope:this,success:function(e,f){if(f.result.success){var d=Ext.getCmp("layoutsaveform_name").getValue();biogps.layoutsavewin.body.unmask();biogps.layoutsavewin.body.mask(String.format('Layout "{0}" saved!',d));this.grp_tbar.updateLayoutMenu();var g=f.result.layout_id;this.switchLayout(g);setTimeout(function(){biogps.layoutsavewin.body.unmask();biogps.layoutsavewin.close()},1000)}else{biogps.layoutsavewin.body.unmask();biogps.formfailure(f,"Saving Layout failed! Try again.",function(){if(biogps.layoutsavewin){biogps.layoutsavewin.items.get(0).form.reset()}biogps.layoutsavewin.items.get(0).items.get(0).focus()})}},failure:function(d,e){biogps.layoutsavewin.body.unmask();biogps.formfailure(e,"Saving Layout failed! Try again.",function(){Ext.getCmp("layoutsaveform").form.reset();Ext.getCmp("layoutsaveform").items.get(0).focus()})}})}}},onLayoutSwitch:function(b,a){if(a){this.switchLayout(b.value)}},switchLayout:function(a){biogps.LayoutMgr.on("currentlayoutloaded",function(){biogps.clearListeners(biogps.LayoutMgr,"currentlayoutloaded");this.grlayout=biogps.LayoutMgr.currentLayout;this.updatePage()},this);biogps.LayoutMgr.loadLayout(a);biogps.usrMgr.profile.defaultlayout=a;if(!biogps.usrMgr.is_anonymoususer){biogps.usrMgr.saveUserProfile()}},placeFirstTimePlugin:function(){var h=this.body.getHeight();var g=0;for(var f=0;f<this.portlets.length;f++){if(this.portlets[f].firsttime){h+=this.portlets[f].getBox(true).height;g+=1}}if(g==this.portlets.length){this.tilePluginWindows();for(var f=0;f<this.portlets.length;f++){this.portlets[f].firsttime=false}}else{this.setCanvasHeight(h);var d=this.body.getWidth();for(var f=0;f<this.portlets.length;f++){if(this.portlets[f].firsttime){for(var e=0;e<this.portlets.length;e++){if(!this.portlets[e].firsttime){var l=this.portlets[f].getPositionNextTo(this.portlets[e],d);this.portlets[f].update({top:l.y,left:l.x});var a=false;for(var c=0;c<this.portlets.length;c++){if(e!=c&&!this.portlets[c].firsttime&&this.portlets[f].isOverlapWith(this.portlets[c])){a=true;break}}if(!a){this.portlets[f].firsttime=false;break}}}}}this.updateSize()}if(g>0){var b=new Ext.util.DelayedTask(function(){this.saveCurrentLayout({quiet:true})},this);b.delay(2000)}},tilePluginWindows_compact:function(a){var c=350;var e=250;for(var d=0;d<this.portlets.length;d++){this.portlets[d].update({width:c,height:e})}this.setCanvasHeight(e*this.portlets.length);this.portlets[0].update({top:0,left:0});var b=this.body.getWidth();var f;for(var d=1;d<this.portlets.length;d++){f=this.portlets[d].getPositionNextTo(this.portlets[d-1],b);this.portlets[d].update({top:f.y,left:f.x})}this.updateSize()},tilePluginWindows:function(c){var g=0;for(var f=0;f<this.portlets.length;f++){g+=this.portlets[f].getBox().height}this.setCanvasHeight(g);var a=[];if(c=="area"){var l=[];var k;for(var f=0;f<this.portlets.length;f++){k=this.portlets[f].getBox();l.push([-1*k.width*k.height,f,this.portlets[f].plugin.title])}l=l.sort(function(j,i){return(j[0]-i[0])});for(var f=0;f<l.length;f++){a.push(l[f][1])}}else{for(var f=0;f<this.portlets.length;f++){a.push(f)}}this.portlets[a[0]].update({top:0,left:0});var d=this.body.getWidth();var h;var e;for(var f=1;f<a.length;f++){e=a[f];h=this.portlets[a[f]].getPositionNextTo(this.portlets[a[f-1]],d);this.portlets[a[f]].update({top:h.y,left:h.x})}this.updateSize()},openAllInBrowser:function(b){var c;if(!b&&this.portlets.length>=3){Ext.MessageBox.confirm("Confirmation",String.format('You are about to open {0} plugins in separate browser windows or tabs. Click "Yes" to continue.',this.portlets.length),function(d){if(d=="yes"){this.openAllInBrowser(true)}},this)}else{for(var a=0;a<this.portlets.length;a++){c=this.portlets[a];if(c.url){window.open(c.url)}}}}});Ext.reg("grpage",biogps.GeneReportPage);biogps.renderMainUI=function(){Ext.form.Field.prototype.msgTarget="side";setTimeout(function(){Ext.get("loading").hide();Ext.get("loading-mask").fadeOut({remove:false})},0);biogps.mainUI_init();biogps.genelist_panel=new biogps.GeneListPanel();biogps.genelist_panel.on("geneclicked",function(b){biogps.renderGeneReport2([b.id])});biogps.geneset_panel=new biogps.GeneSetPanel();var a=new Ext.Viewport({layout:"border",items:[new Ext.BoxComponent({region:"north",el:"header",height:32}),{region:"south",contentEl:"south",id:"log_panel",split:true,height:21,minSize:5,maxSize:200,collapsible:true,collapsed:false,frame:false,header:false,collapseMode:"mini",title:"South",margins:"0 0 0 0"},{region:"west",id:"west-panel",title:"Current Gene List",split:true,width:185,minSize:100,maxSize:400,collapsible:true,collapseMode:"mini",margins:"0 0 0 5",layout:"border",layoutConfig:{animate:true},items:[biogps.genelist_panel,biogps.geneset_panel]},new Ext.TabPanel({region:"center",id:"center_panel",deferredRender:false,enableTabScroll:true,activeTab:0,defaults:{autoScroll:true},items:[{contentEl:"searchpanel",id:"search_panel",title:"Search",autoScroll:true},{contentEl:"resultpanel",name:"result_panel",id:"result_panel",title:"Search Result",layout:"fit",disabled:true,autoScroll:true},{contentEl:"reportpanel",id:"report_panel",bodyCssClass:"report_panel_back",layout:"fit",disabled:true,title:"Gene Report",autoScroll:true}]})]});biogps.centerTab=Ext.getCmp("center_panel");biogps.centerTab.on("tabchange",function(d,b){switch(b.id){case"search_panel":Ext.History.add("goto=search");break;case"result_panel":Ext.History.add("goto=searchresult");break;case"report_panel":var c=biogps.GeneReportMgr.getGeneidList();if(c.length>0){Ext.History.add("goto=genereport&id="+c.join(","))}biogps.GeneReportMgr.refreshMarked();break;case"infotab_help":Ext.History.add("goto=help");break;case"infotab_faq":Ext.History.add("goto=faq");break;case"infotab_downloads":Ext.History.add("goto=downloads");break;case"infotab_about":Ext.History.add("goto=about");break;case"infotab_terms":Ext.History.add("goto=terms");break;case"pluginbrowse_panel":if(biogps.currentLibrary){biogps.currentLibrary.hash_history()}else{Ext.History.add("goto=pluginlibrary")}break;case"mystuff_panel":Ext.History.add("goto=mystuff");break}},this);biogps.renderSearchForm("searchpanel");biogps.renderFeedBox(Ext.getCmp("col_info").body);biogps.renderTipBox(Ext.getCmp("col_info").body);biogps.mainUI_postinit()};Ext.onReady(function(){if(Ext.get("history-form")){if(window.coreDispatcher&&!coreDispatcher.showWelcome){Ext.get("welcome").hide()}biogps.init();biogps.renderMainUI()}});